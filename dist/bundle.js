/*! For license information please see bundle.js.LICENSE.txt */
(()=>{"use strict";var t={d:(e,n)=>{for(var r in n)t.o(n,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:n[r]})}};t.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),t.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),t.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},t.d({},{qd:()=>Eu});var e={};t.r(e),t.d(e,{Decoder:()=>Ll,Encoder:()=>Ol,PacketType:()=>Nl,protocol:()=>Dl});const n=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let s=t.charCodeAt(r);s<128?e[n++]=s:s<2048?(e[n++]=s>>6|192,e[n++]=63&s|128):55296==(64512&s)&&r+1<t.length&&56320==(64512&t.charCodeAt(r+1))?(s=65536+((1023&s)<<10)+(1023&t.charCodeAt(++r)),e[n++]=s>>18|240,e[n++]=s>>12&63|128,e[n++]=s>>6&63|128,e[n++]=63&s|128):(e[n++]=s>>12|224,e[n++]=s>>6&63|128,e[n++]=63&s|128)}return e},r={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let e=0;e<t.length;e+=3){const s=t[e],i=e+1<t.length,o=i?t[e+1]:0,a=e+2<t.length,c=a?t[e+2]:0,l=s>>2,u=(3&s)<<4|o>>4;let h=(15&o)<<2|c>>6,d=63&c;a||(d=64,i||(h=64)),r.push(n[l],n[u],n[h],n[d])}return r.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(n(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):function(t){const e=[];let n=0,r=0;for(;n<t.length;){const s=t[n++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=t[n++];e[r++]=String.fromCharCode((31&s)<<6|63&i)}else if(s>239&&s<365){const i=((7&s)<<18|(63&t[n++])<<12|(63&t[n++])<<6|63&t[n++])-65536;e[r++]=String.fromCharCode(55296+(i>>10)),e[r++]=String.fromCharCode(56320+(1023&i))}else{const i=t[n++],o=t[n++];e[r++]=String.fromCharCode((15&s)<<12|(63&i)<<6|63&o)}}return e.join("")}(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let e=0;e<t.length;){const i=n[t.charAt(e++)],o=e<t.length?n[t.charAt(e)]:0;++e;const a=e<t.length?n[t.charAt(e)]:64;++e;const c=e<t.length?n[t.charAt(e)]:64;if(++e,null==i||null==o||null==a||null==c)throw new s;const l=i<<2|o>>4;if(r.push(l),64!==a){const t=o<<4&240|a>>2;if(r.push(t),64!==c){const t=a<<6&192|c;r.push(t)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class s extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const i=function(t){return function(t){const e=n(t);return r.encodeByteArray(e,!0)}(t).replace(/\./g,"")},o=()=>{try{return function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==t.g)return t.g;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__||(()=>{if("undefined"==typeof process)return;const t="MISSING_ENV_VAR".__FIREBASE_DEFAULTS__;return t?JSON.parse(t):void 0})()||(()=>{if("undefined"==typeof document)return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(t){return}const e=t&&function(t){try{return r.decodeString(t,!0)}catch(t){console.error("base64Decode failed: ",t)}return null}(t[1]);return e&&JSON.parse(e)})()}catch(t){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`)}},a=()=>{var t;return null===(t=o())||void 0===t?void 0:t.config};class c{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}wrapCallback(t){return(e,n)=>{e?this.reject(e):this.resolve(n),"function"==typeof t&&(this.promise.catch((()=>{})),1===t.length?t(e):t(e,n))}}}class l extends Error{constructor(t,e,n){super(e),this.code=t,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,l.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,u.prototype.create)}}class u{constructor(t,e,n){this.service=t,this.serviceName=e,this.errors=n}create(t,...e){const n=e[0]||{},r=`${this.service}/${t}`,s=this.errors[t],i=s?function(t,e){return t.replace(h,((t,n)=>{const r=e[n];return null!=r?String(r):`<${n}?>`}))}(s,n):"Error",o=`${this.serviceName}: ${i} (${r}).`;return new l(r,o,n)}}const h=/\{\$([^}]+)}/g;function d(t,e){if(t===e)return!0;const n=Object.keys(t),r=Object.keys(e);for(const s of n){if(!r.includes(s))return!1;const n=t[s],i=e[s];if(f(n)&&f(i)){if(!d(n,i))return!1}else if(n!==i)return!1}for(const t of r)if(!n.includes(t))return!1;return!0}function f(t){return null!==t&&"object"==typeof t}function p(t){return t&&t._delegate?t._delegate:t}class g{constructor(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}const m="[DEFAULT]";class y{constructor(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){const t=new c;if(this.instancesDeferred.set(e,t),this.isInitialized(e)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:e});n&&t.resolve(n)}catch(t){}}return this.instancesDeferred.get(e).promise}getImmediate(t){var e;const n=this.normalizeInstanceIdentifier(null==t?void 0:t.identifier),r=null!==(e=null==t?void 0:t.optional)&&void 0!==e&&e;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(r)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(t){if(r)return null;throw t}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,this.shouldAutoInitialize()){if(function(t){return"EAGER"===t.instantiationMode}(t))try{this.getOrInitializeService({instanceIdentifier:m})}catch(t){}for(const[t,e]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(t);try{const t=this.getOrInitializeService({instanceIdentifier:n});e.resolve(t)}catch(t){}}}}clearInstance(t=m){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter((t=>"INTERNAL"in t)).map((t=>t.INTERNAL.delete())),...t.filter((t=>"_delete"in t)).map((t=>t._delete()))])}isComponentSet(){return null!=this.component}isInitialized(t=m){return this.instances.has(t)}getOptions(t=m){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:e={}}=t,n=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:n,options:e});for(const[t,e]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(t)&&e.resolve(r);return r}onInit(t,e){var n;const r=this.normalizeInstanceIdentifier(e),s=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;s.add(t),this.onInitCallbacks.set(r,s);const i=this.instances.get(r);return i&&t(i,r),()=>{s.delete(t)}}invokeOnInitCallbacks(t,e){const n=this.onInitCallbacks.get(e);if(n)for(const r of n)try{r(t,e)}catch(t){}}getOrInitializeService({instanceIdentifier:t,options:e={}}){let n=this.instances.get(t);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(r=t,r===m?void 0:r),options:e}),this.instances.set(t,n),this.instancesOptions.set(t,e),this.invokeOnInitCallbacks(n,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,n)}catch(t){}var r;return n||null}normalizeInstanceIdentifier(t=m){return this.component?this.component.multipleInstances?t:m:t}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class v{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const e=this.getProvider(t.name);if(e.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);e.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const e=new y(t,this);return this.providers.set(t,e),e}getProviders(){return Array.from(this.providers.values())}}const b=[];var w;!function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"}(w||(w={}));const E={debug:w.DEBUG,verbose:w.VERBOSE,info:w.INFO,warn:w.WARN,error:w.ERROR,silent:w.SILENT},_=w.INFO,C={[w.DEBUG]:"log",[w.VERBOSE]:"log",[w.INFO]:"info",[w.WARN]:"warn",[w.ERROR]:"error"},T=(t,e,...n)=>{if(e<t.logLevel)return;const r=(new Date).toISOString(),s=C[e];if(!s)throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`);console[s](`[${r}]  ${t.name}:`,...n)};class S{constructor(t){this.name=t,this._logLevel=_,this._logHandler=T,this._userLogHandler=null,b.push(this)}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in w))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel="string"==typeof t?E[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,w.DEBUG,...t),this._logHandler(this,w.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,w.VERBOSE,...t),this._logHandler(this,w.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,w.INFO,...t),this._logHandler(this,w.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,w.WARN,...t),this._logHandler(this,w.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,w.ERROR,...t),this._logHandler(this,w.ERROR,...t)}}let k,x;const I=new WeakMap,A=new WeakMap,R=new WeakMap,D=new WeakMap,N=new WeakMap;let O={get(t,e,n){if(t instanceof IDBTransaction){if("done"===e)return A.get(t);if("objectStoreNames"===e)return t.objectStoreNames||R.get(t);if("store"===e)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return L(t[e])},set:(t,e,n)=>(t[e]=n,!0),has:(t,e)=>t instanceof IDBTransaction&&("done"===e||"store"===e)||e in t};function P(t){return"function"==typeof t?(e=t)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(x||(x=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(M(this),t),L(I.get(this))}:function(...t){return L(e.apply(M(this),t))}:function(t,...n){const r=e.call(M(this),t,...n);return R.set(r,t.sort?t.sort():[t]),L(r)}:(t instanceof IDBTransaction&&function(t){if(A.has(t))return;const e=new Promise(((e,n)=>{const r=()=>{t.removeEventListener("complete",s),t.removeEventListener("error",i),t.removeEventListener("abort",i)},s=()=>{e(),r()},i=()=>{n(t.error||new DOMException("AbortError","AbortError")),r()};t.addEventListener("complete",s),t.addEventListener("error",i),t.addEventListener("abort",i)}));A.set(t,e)}(t),n=t,(k||(k=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some((t=>n instanceof t))?new Proxy(t,O):t);var e,n}function L(t){if(t instanceof IDBRequest)return function(t){const e=new Promise(((e,n)=>{const r=()=>{t.removeEventListener("success",s),t.removeEventListener("error",i)},s=()=>{e(L(t.result)),r()},i=()=>{n(t.error),r()};t.addEventListener("success",s),t.addEventListener("error",i)}));return e.then((e=>{e instanceof IDBCursor&&I.set(e,t)})).catch((()=>{})),N.set(e,t),e}(t);if(D.has(t))return D.get(t);const e=P(t);return e!==t&&(D.set(t,e),N.set(e,t)),e}const M=t=>N.get(t),F=["get","getKey","getAll","getAllKeys","count"],U=["put","add","delete","clear"],B=new Map;function V(t,e){if(!(t instanceof IDBDatabase)||e in t||"string"!=typeof e)return;if(B.get(e))return B.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,s=U.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!s&&!F.includes(n))return;const i=async function(t,...e){const i=this.transaction(t,s?"readwrite":"readonly");let o=i.store;return r&&(o=o.index(e.shift())),(await Promise.all([o[n](...e),s&&i.done]))[0]};return B.set(e,i),i}var q;q=O,O={...q,get:(t,e,n)=>V(t,e)||q.get(t,e,n),has:(t,e)=>!!V(t,e)||q.has(t,e)};class j{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map((t=>{if(function(t){const e=t.getComponent();return"VERSION"===(null==e?void 0:e.type)}(t)){const e=t.getImmediate();return`${e.library}/${e.version}`}return null})).filter((t=>t)).join(" ")}}const $="@firebase/app",z="0.10.17",K=new S("@firebase/app"),H="@firebase/app-compat",G="@firebase/analytics-compat",W="@firebase/analytics",Q="@firebase/app-check-compat",Y="@firebase/app-check",X="@firebase/auth",J="@firebase/auth-compat",Z="@firebase/database",tt="@firebase/data-connect",et="@firebase/database-compat",nt="@firebase/functions",rt="@firebase/functions-compat",st="@firebase/installations",it="@firebase/installations-compat",ot="@firebase/messaging",at="@firebase/messaging-compat",ct="@firebase/performance",lt="@firebase/performance-compat",ut="@firebase/remote-config",ht="@firebase/remote-config-compat",dt="@firebase/storage",ft="@firebase/storage-compat",pt="@firebase/firestore",gt="@firebase/vertexai",mt="@firebase/firestore-compat",yt="firebase",vt="[DEFAULT]",bt={[$]:"fire-core",[H]:"fire-core-compat",[W]:"fire-analytics",[G]:"fire-analytics-compat",[Y]:"fire-app-check",[Q]:"fire-app-check-compat",[X]:"fire-auth",[J]:"fire-auth-compat",[Z]:"fire-rtdb",[tt]:"fire-data-connect",[et]:"fire-rtdb-compat",[nt]:"fire-fn",[rt]:"fire-fn-compat",[st]:"fire-iid",[it]:"fire-iid-compat",[ot]:"fire-fcm",[at]:"fire-fcm-compat",[ct]:"fire-perf",[lt]:"fire-perf-compat",[ut]:"fire-rc",[ht]:"fire-rc-compat",[dt]:"fire-gcs",[ft]:"fire-gcs-compat",[pt]:"fire-fst",[mt]:"fire-fst-compat",[gt]:"fire-vertex","fire-js":"fire-js",[yt]:"fire-js-all"},wt=new Map,Et=new Map,_t=new Map;function Ct(t,e){try{t.container.addComponent(e)}catch(n){K.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function Tt(t){const e=t.name;if(_t.has(e))return K.debug(`There were multiple attempts to register component ${e}.`),!1;_t.set(e,t);for(const e of wt.values())Ct(e,t);for(const e of Et.values())Ct(e,t);return!0}const St=new u("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class kt{constructor(t,e,n){this._isDeleted=!1,this._options=Object.assign({},t),this._config=Object.assign({},e),this._name=e.name,this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new g("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw St.create("app-deleted",{appName:this._name})}}function xt(t,e={}){let n=t;"object"!=typeof e&&(e={name:e});const r=Object.assign({name:vt,automaticDataCollectionEnabled:!1},e),s=r.name;if("string"!=typeof s||!s)throw St.create("bad-app-name",{appName:String(s)});if(n||(n=a()),!n)throw St.create("no-options");const i=wt.get(s);if(i){if(d(n,i.options)&&d(r,i.config))return i;throw St.create("duplicate-app",{appName:s})}const o=new v(s);for(const t of _t.values())o.addComponent(t);const c=new kt(n,r,o);return wt.set(s,c),c}function It(t,e,n){var r;let s=null!==(r=bt[t])&&void 0!==r?r:t;n&&(s+=`-${n}`);const i=s.match(/\s|\//),o=e.match(/\s|\//);if(i||o){const t=[`Unable to register library "${s}" with version "${e}":`];return i&&t.push(`library name "${s}" contains illegal characters (whitespace or "/")`),i&&o&&t.push("and"),o&&t.push(`version name "${e}" contains illegal characters (whitespace or "/")`),void K.warn(t.join(" "))}Tt(new g(`${s}-version`,(()=>({library:s,version:e})),"VERSION"))}const At="firebase-heartbeat-store";let Rt=null;function Dt(){return Rt||(Rt=function(t,e,{blocked:n,upgrade:r,blocking:s,terminated:i}={}){const o=indexedDB.open(t,e),a=L(o);return r&&o.addEventListener("upgradeneeded",(t=>{r(L(o.result),t.oldVersion,t.newVersion,L(o.transaction),t)})),n&&o.addEventListener("blocked",(t=>n(t.oldVersion,t.newVersion,t))),a.then((t=>{i&&t.addEventListener("close",(()=>i())),s&&t.addEventListener("versionchange",(t=>s(t.oldVersion,t.newVersion,t)))})).catch((()=>{})),a}("firebase-heartbeat-database",1,{upgrade:(t,e)=>{if(0===e)try{t.createObjectStore(At)}catch(t){console.warn(t)}}}).catch((t=>{throw St.create("idb-open",{originalErrorMessage:t.message})}))),Rt}async function Nt(t,e){try{const n=(await Dt()).transaction(At,"readwrite"),r=n.objectStore(At);await r.put(e,Ot(t)),await n.done}catch(t){if(t instanceof l)K.warn(t.message);else{const e=St.create("idb-set",{originalErrorMessage:null==t?void 0:t.message});K.warn(e.message)}}}function Ot(t){return`${t.name}!${t.options.appId}`}class Pt{constructor(t){this.container=t,this._heartbeatsCache=null;const e=this.container.getProvider("app").getImmediate();this._storage=new Mt(e),this._heartbeatsCachePromise=this._storage.read().then((t=>(this._heartbeatsCache=t,t)))}async triggerHeartbeat(){var t,e;try{const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=Lt();if(null==(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)&&(this._heartbeatsCache=await this._heartbeatsCachePromise,null==(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)))return;if(this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some((t=>t.date===r)))return;return this._heartbeatsCache.heartbeats.push({date:r,agent:n}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter((t=>{const e=new Date(t.date).valueOf();return Date.now()-e<=2592e6})),this._storage.overwrite(this._heartbeatsCache)}catch(t){K.warn(t)}}async getHeartbeatsHeader(){var t;try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null==(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)||0===this._heartbeatsCache.heartbeats.length)return"";const e=Lt(),{heartbeatsToSend:n,unsentEntries:r}=function(t,e=1024){const n=[];let r=t.slice();for(const s of t){const t=n.find((t=>t.agent===s.agent));if(t){if(t.dates.push(s.date),Ft(n)>e){t.dates.pop();break}}else if(n.push({agent:s.agent,dates:[s.date]}),Ft(n)>e){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}(this._heartbeatsCache.heartbeats),s=i(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=e,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(t){return K.warn(t),""}}}function Lt(){return(new Date).toISOString().substring(0,10)}class Mt{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!function(){try{return"object"==typeof indexedDB}catch(t){return!1}}()&&new Promise(((t,e)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),n||self.indexedDB.deleteDatabase(r),t(!0)},s.onupgradeneeded=()=>{n=!1},s.onerror=()=>{var t;e((null===(t=s.error)||void 0===t?void 0:t.message)||"")}}catch(t){e(t)}})).then((()=>!0)).catch((()=>!1))}async read(){if(await this._canUseIndexedDBPromise){const t=await async function(t){try{const e=(await Dt()).transaction(At),n=await e.objectStore(At).get(Ot(t));return await e.done,n}catch(t){if(t instanceof l)K.warn(t.message);else{const e=St.create("idb-get",{originalErrorMessage:null==t?void 0:t.message});K.warn(e.message)}}}(this.app);return(null==t?void 0:t.heartbeats)?t:{heartbeats:[]}}return{heartbeats:[]}}async overwrite(t){var e;if(await this._canUseIndexedDBPromise){const n=await this.read();return Nt(this.app,{lastSentHeartbeatDate:null!==(e=t.lastSentHeartbeatDate)&&void 0!==e?e:n.lastSentHeartbeatDate,heartbeats:t.heartbeats})}}async add(t){var e;if(await this._canUseIndexedDBPromise){const n=await this.read();return Nt(this.app,{lastSentHeartbeatDate:null!==(e=t.lastSentHeartbeatDate)&&void 0!==e?e:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...t.heartbeats]})}}}function Ft(t){return i(JSON.stringify({version:2,heartbeats:t})).length}Tt(new g("platform-logger",(t=>new j(t)),"PRIVATE")),Tt(new g("heartbeat",(t=>new Pt(t)),"PRIVATE")),It($,z,""),It($,z,"esm2017"),It("fire-js",""),It("firebase","11.1.0","app");var Ut,Bt,Vt="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},qt={};(function(){var t;function e(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}function n(t,e,n){n||(n=0);var r=Array(16);if("string"==typeof e)for(var s=0;16>s;++s)r[s]=e.charCodeAt(n++)|e.charCodeAt(n++)<<8|e.charCodeAt(n++)<<16|e.charCodeAt(n++)<<24;else for(s=0;16>s;++s)r[s]=e[n++]|e[n++]<<8|e[n++]<<16|e[n++]<<24;e=t.g[0],n=t.g[1],s=t.g[2];var i=t.g[3],o=e+(i^n&(s^i))+r[0]+3614090360&4294967295;o=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=n+(o<<7&4294967295|o>>>25))+((o=i+(s^e&(n^s))+r[1]+3905402710&4294967295)<<12&4294967295|o>>>20))+((o=s+(n^i&(e^n))+r[2]+606105819&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^s&(i^e))+r[3]+3250441966&4294967295)<<22&4294967295|o>>>10))+((o=e+(i^n&(s^i))+r[4]+4118548399&4294967295)<<7&4294967295|o>>>25))+((o=i+(s^e&(n^s))+r[5]+1200080426&4294967295)<<12&4294967295|o>>>20))+((o=s+(n^i&(e^n))+r[6]+2821735955&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^s&(i^e))+r[7]+4249261313&4294967295)<<22&4294967295|o>>>10))+((o=e+(i^n&(s^i))+r[8]+1770035416&4294967295)<<7&4294967295|o>>>25))+((o=i+(s^e&(n^s))+r[9]+2336552879&4294967295)<<12&4294967295|o>>>20))+((o=s+(n^i&(e^n))+r[10]+4294925233&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^s&(i^e))+r[11]+2304563134&4294967295)<<22&4294967295|o>>>10))+((o=e+(i^n&(s^i))+r[12]+1804603682&4294967295)<<7&4294967295|o>>>25))+((o=i+(s^e&(n^s))+r[13]+4254626195&4294967295)<<12&4294967295|o>>>20))+((o=s+(n^i&(e^n))+r[14]+2792965006&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^s&(i^e))+r[15]+1236535329&4294967295)<<22&4294967295|o>>>10))+((o=e+(s^i&(n^s))+r[1]+4129170786&4294967295)<<5&4294967295|o>>>27))+((o=i+(n^s&(e^n))+r[6]+3225465664&4294967295)<<9&4294967295|o>>>23))+((o=s+(e^n&(i^e))+r[11]+643717713&4294967295)<<14&4294967295|o>>>18))+((o=n+(i^e&(s^i))+r[0]+3921069994&4294967295)<<20&4294967295|o>>>12))+((o=e+(s^i&(n^s))+r[5]+3593408605&4294967295)<<5&4294967295|o>>>27))+((o=i+(n^s&(e^n))+r[10]+38016083&4294967295)<<9&4294967295|o>>>23))+((o=s+(e^n&(i^e))+r[15]+3634488961&4294967295)<<14&4294967295|o>>>18))+((o=n+(i^e&(s^i))+r[4]+3889429448&4294967295)<<20&4294967295|o>>>12))+((o=e+(s^i&(n^s))+r[9]+568446438&4294967295)<<5&4294967295|o>>>27))+((o=i+(n^s&(e^n))+r[14]+3275163606&4294967295)<<9&4294967295|o>>>23))+((o=s+(e^n&(i^e))+r[3]+4107603335&4294967295)<<14&4294967295|o>>>18))+((o=n+(i^e&(s^i))+r[8]+1163531501&4294967295)<<20&4294967295|o>>>12))+((o=e+(s^i&(n^s))+r[13]+2850285829&4294967295)<<5&4294967295|o>>>27))+((o=i+(n^s&(e^n))+r[2]+4243563512&4294967295)<<9&4294967295|o>>>23))+((o=s+(e^n&(i^e))+r[7]+1735328473&4294967295)<<14&4294967295|o>>>18))+((o=n+(i^e&(s^i))+r[12]+2368359562&4294967295)<<20&4294967295|o>>>12))+((o=e+(n^s^i)+r[5]+4294588738&4294967295)<<4&4294967295|o>>>28))+((o=i+(e^n^s)+r[8]+2272392833&4294967295)<<11&4294967295|o>>>21))+((o=s+(i^e^n)+r[11]+1839030562&4294967295)<<16&4294967295|o>>>16))+((o=n+(s^i^e)+r[14]+4259657740&4294967295)<<23&4294967295|o>>>9))+((o=e+(n^s^i)+r[1]+2763975236&4294967295)<<4&4294967295|o>>>28))+((o=i+(e^n^s)+r[4]+1272893353&4294967295)<<11&4294967295|o>>>21))+((o=s+(i^e^n)+r[7]+4139469664&4294967295)<<16&4294967295|o>>>16))+((o=n+(s^i^e)+r[10]+3200236656&4294967295)<<23&4294967295|o>>>9))+((o=e+(n^s^i)+r[13]+681279174&4294967295)<<4&4294967295|o>>>28))+((o=i+(e^n^s)+r[0]+3936430074&4294967295)<<11&4294967295|o>>>21))+((o=s+(i^e^n)+r[3]+3572445317&4294967295)<<16&4294967295|o>>>16))+((o=n+(s^i^e)+r[6]+76029189&4294967295)<<23&4294967295|o>>>9))+((o=e+(n^s^i)+r[9]+3654602809&4294967295)<<4&4294967295|o>>>28))+((o=i+(e^n^s)+r[12]+3873151461&4294967295)<<11&4294967295|o>>>21))+((o=s+(i^e^n)+r[15]+530742520&4294967295)<<16&4294967295|o>>>16))+((o=n+(s^i^e)+r[2]+3299628645&4294967295)<<23&4294967295|o>>>9))+((o=e+(s^(n|~i))+r[0]+4096336452&4294967295)<<6&4294967295|o>>>26))+((o=i+(n^(e|~s))+r[7]+1126891415&4294967295)<<10&4294967295|o>>>22))+((o=s+(e^(i|~n))+r[14]+2878612391&4294967295)<<15&4294967295|o>>>17))+((o=n+(i^(s|~e))+r[5]+4237533241&4294967295)<<21&4294967295|o>>>11))+((o=e+(s^(n|~i))+r[12]+1700485571&4294967295)<<6&4294967295|o>>>26))+((o=i+(n^(e|~s))+r[3]+2399980690&4294967295)<<10&4294967295|o>>>22))+((o=s+(e^(i|~n))+r[10]+4293915773&4294967295)<<15&4294967295|o>>>17))+((o=n+(i^(s|~e))+r[1]+2240044497&4294967295)<<21&4294967295|o>>>11))+((o=e+(s^(n|~i))+r[8]+1873313359&4294967295)<<6&4294967295|o>>>26))+((o=i+(n^(e|~s))+r[15]+4264355552&4294967295)<<10&4294967295|o>>>22))+((o=s+(e^(i|~n))+r[6]+2734768916&4294967295)<<15&4294967295|o>>>17))+((o=n+(i^(s|~e))+r[13]+1309151649&4294967295)<<21&4294967295|o>>>11))+((i=(e=n+((o=e+(s^(n|~i))+r[4]+4149444226&4294967295)<<6&4294967295|o>>>26))+((o=i+(n^(e|~s))+r[11]+3174756917&4294967295)<<10&4294967295|o>>>22))^((s=i+((o=s+(e^(i|~n))+r[2]+718787259&4294967295)<<15&4294967295|o>>>17))|~e))+r[9]+3951481745&4294967295,t.g[0]=t.g[0]+e&4294967295,t.g[1]=t.g[1]+(s+(o<<21&4294967295|o>>>11))&4294967295,t.g[2]=t.g[2]+s&4294967295,t.g[3]=t.g[3]+i&4294967295}function r(t,e){this.h=e;for(var n=[],r=!0,s=t.length-1;0<=s;s--){var i=0|t[s];r&&i==e||(n[s]=i,r=!1)}this.g=n}!function(t,e){function n(){}n.prototype=e.prototype,t.D=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.C=function(t,n,r){for(var s=Array(arguments.length-2),i=2;i<arguments.length;i++)s[i-2]=arguments[i];return e.prototype[n].apply(t,s)}}(e,(function(){this.blockSize=-1})),e.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0},e.prototype.u=function(t,e){void 0===e&&(e=t.length);for(var r=e-this.blockSize,s=this.B,i=this.h,o=0;o<e;){if(0==i)for(;o<=r;)n(this,t,o),o+=this.blockSize;if("string"==typeof t){for(;o<e;)if(s[i++]=t.charCodeAt(o++),i==this.blockSize){n(this,s),i=0;break}}else for(;o<e;)if(s[i++]=t[o++],i==this.blockSize){n(this,s),i=0;break}}this.h=i,this.o+=e},e.prototype.v=function(){var t=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);t[0]=128;for(var e=1;e<t.length-8;++e)t[e]=0;var n=8*this.o;for(e=t.length-8;e<t.length;++e)t[e]=255&n,n/=256;for(this.u(t),t=Array(16),e=n=0;4>e;++e)for(var r=0;32>r;r+=8)t[n++]=this.g[e]>>>r&255;return t};var s={};function i(t){return-128<=t&&128>t?function(t){var e=s;return Object.prototype.hasOwnProperty.call(e,t)?e[t]:e[t]=function(t){return new r([0|t],0>t?-1:0)}(t)}(t):new r([0|t],0>t?-1:0)}function o(t){if(isNaN(t)||!isFinite(t))return a;if(0>t)return d(o(-t));for(var e=[],n=1,s=0;t>=n;s++)e[s]=t/n|0,n*=4294967296;return new r(e,0)}var a=i(0),c=i(1),l=i(16777216);function u(t){if(0!=t.h)return!1;for(var e=0;e<t.g.length;e++)if(0!=t.g[e])return!1;return!0}function h(t){return-1==t.h}function d(t){for(var e=t.g.length,n=[],s=0;s<e;s++)n[s]=~t.g[s];return new r(n,~t.h).add(c)}function f(t,e){return t.add(d(e))}function p(t,e){for(;(65535&t[e])!=t[e];)t[e+1]+=t[e]>>>16,t[e]&=65535,e++}function g(t,e){this.g=t,this.h=e}function m(t,e){if(u(e))throw Error("division by zero");if(u(t))return new g(a,a);if(h(t))return e=m(d(t),e),new g(d(e.g),d(e.h));if(h(e))return e=m(t,d(e)),new g(d(e.g),e.h);if(30<t.g.length){if(h(t)||h(e))throw Error("slowDivide_ only works with positive integers.");for(var n=c,r=e;0>=r.l(t);)n=y(n),r=y(r);var s=v(n,1),i=v(r,1);for(r=v(r,2),n=v(n,2);!u(r);){var l=i.add(r);0>=l.l(t)&&(s=s.add(n),i=l),r=v(r,1),n=v(n,1)}return e=f(t,s.j(e)),new g(s,e)}for(s=a;0<=t.l(e);){for(n=Math.max(1,Math.floor(t.m()/e.m())),r=48>=(r=Math.ceil(Math.log(n)/Math.LN2))?1:Math.pow(2,r-48),l=(i=o(n)).j(e);h(l)||0<l.l(t);)l=(i=o(n-=r)).j(e);u(i)&&(i=c),s=s.add(i),t=f(t,l)}return new g(s,t)}function y(t){for(var e=t.g.length+1,n=[],s=0;s<e;s++)n[s]=t.i(s)<<1|t.i(s-1)>>>31;return new r(n,t.h)}function v(t,e){var n=e>>5;e%=32;for(var s=t.g.length-n,i=[],o=0;o<s;o++)i[o]=0<e?t.i(o+n)>>>e|t.i(o+n+1)<<32-e:t.i(o+n);return new r(i,t.h)}(t=r.prototype).m=function(){if(h(this))return-d(this).m();for(var t=0,e=1,n=0;n<this.g.length;n++){var r=this.i(n);t+=(0<=r?r:4294967296+r)*e,e*=4294967296}return t},t.toString=function(t){if(2>(t=t||10)||36<t)throw Error("radix out of range: "+t);if(u(this))return"0";if(h(this))return"-"+d(this).toString(t);for(var e=o(Math.pow(t,6)),n=this,r="";;){var s=m(n,e).g,i=((0<(n=f(n,s.j(e))).g.length?n.g[0]:n.h)>>>0).toString(t);if(u(n=s))return i+r;for(;6>i.length;)i="0"+i;r=i+r}},t.i=function(t){return 0>t?0:t<this.g.length?this.g[t]:this.h},t.l=function(t){return h(t=f(this,t))?-1:u(t)?0:1},t.abs=function(){return h(this)?d(this):this},t.add=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],s=0,i=0;i<=e;i++){var o=s+(65535&this.i(i))+(65535&t.i(i)),a=(o>>>16)+(this.i(i)>>>16)+(t.i(i)>>>16);s=a>>>16,o&=65535,a&=65535,n[i]=a<<16|o}return new r(n,-2147483648&n[n.length-1]?-1:0)},t.j=function(t){if(u(this)||u(t))return a;if(h(this))return h(t)?d(this).j(d(t)):d(d(this).j(t));if(h(t))return d(this.j(d(t)));if(0>this.l(l)&&0>t.l(l))return o(this.m()*t.m());for(var e=this.g.length+t.g.length,n=[],s=0;s<2*e;s++)n[s]=0;for(s=0;s<this.g.length;s++)for(var i=0;i<t.g.length;i++){var c=this.i(s)>>>16,f=65535&this.i(s),g=t.i(i)>>>16,m=65535&t.i(i);n[2*s+2*i]+=f*m,p(n,2*s+2*i),n[2*s+2*i+1]+=c*m,p(n,2*s+2*i+1),n[2*s+2*i+1]+=f*g,p(n,2*s+2*i+1),n[2*s+2*i+2]+=c*g,p(n,2*s+2*i+2)}for(s=0;s<e;s++)n[s]=n[2*s+1]<<16|n[2*s];for(s=e;s<2*e;s++)n[s]=0;return new r(n,0)},t.A=function(t){return m(this,t).h},t.and=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],s=0;s<e;s++)n[s]=this.i(s)&t.i(s);return new r(n,this.h&t.h)},t.or=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],s=0;s<e;s++)n[s]=this.i(s)|t.i(s);return new r(n,this.h|t.h)},t.xor=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],s=0;s<e;s++)n[s]=this.i(s)^t.i(s);return new r(n,this.h^t.h)},e.prototype.digest=e.prototype.v,e.prototype.reset=e.prototype.s,e.prototype.update=e.prototype.u,Bt=qt.Md5=e,r.prototype.add=r.prototype.add,r.prototype.multiply=r.prototype.j,r.prototype.modulo=r.prototype.A,r.prototype.compare=r.prototype.l,r.prototype.toNumber=r.prototype.m,r.prototype.toString=r.prototype.toString,r.prototype.getBits=r.prototype.i,r.fromNumber=o,r.fromString=function t(e,n){if(0==e.length)throw Error("number format error: empty string");if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if("-"==e.charAt(0))return d(t(e.substring(1),n));if(0<=e.indexOf("-"))throw Error('number format error: interior "-" character');for(var r=o(Math.pow(n,8)),s=a,i=0;i<e.length;i+=8){var c=Math.min(8,e.length-i),l=parseInt(e.substring(i,i+c),n);8>c?(c=o(Math.pow(n,c)),s=s.j(c).add(o(l))):s=(s=s.j(r)).add(o(l))}return s},Ut=qt.Integer=r}).apply(void 0!==Vt?Vt:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var jt,$t,zt,Kt,Ht,Gt,Wt,Qt,Yt="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},Xt={};(function(){var t,e="function"==typeof Object.defineProperties?Object.defineProperty:function(t,e,n){return t==Array.prototype||t==Object.prototype||(t[e]=n.value),t},n=function(t){t=["object"==typeof globalThis&&globalThis,t,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof Yt&&Yt];for(var e=0;e<t.length;++e){var n=t[e];if(n&&n.Math==Math)return n}throw Error("Cannot find global object")}(this);!function(t,r){if(r)t:{var s=n;t=t.split(".");for(var i=0;i<t.length-1;i++){var o=t[i];if(!(o in s))break t;s=s[o]}(r=r(i=s[t=t[t.length-1]]))!=i&&null!=r&&e(s,t,{configurable:!0,writable:!0,value:r})}}("Array.prototype.values",(function(t){return t||function(){return function(t,e){t instanceof String&&(t+="");var n=0,r=!1,s={next:function(){if(!r&&n<t.length){var s=n++;return{value:e(0,t[s]),done:!1}}return r=!0,{done:!0,value:void 0}}};return s[Symbol.iterator]=function(){return s},s}(this,(function(t,e){return e}))}}));var r=r||{},s=this||self;function i(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function o(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}function a(t,e,n){return t.call.apply(t.bind,arguments)}function c(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function l(t,e,n){return(l=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?a:c).apply(null,arguments)}function u(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function h(t,e){function n(){}n.prototype=e.prototype,t.aa=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.Qb=function(t,n,r){for(var s=Array(arguments.length-2),i=2;i<arguments.length;i++)s[i-2]=arguments[i];return e.prototype[n].apply(t,s)}}function d(t){const e=t.length;if(0<e){const n=Array(e);for(let r=0;r<e;r++)n[r]=t[r];return n}return[]}function f(t,e){for(let e=1;e<arguments.length;e++){const n=arguments[e];if(i(n)){const e=t.length||0,r=n.length||0;t.length=e+r;for(let s=0;s<r;s++)t[e+s]=n[s]}else t.push(n)}}function p(t){return/^[\s\xa0]*$/.test(t)}function g(){var t=s.navigator;return t&&(t=t.userAgent)?t:""}function m(t){return m[" "](t),t}m[" "]=function(){};var y=!(-1==g().indexOf("Gecko")||-1!=g().toLowerCase().indexOf("webkit")&&-1==g().indexOf("Edge")||-1!=g().indexOf("Trident")||-1!=g().indexOf("MSIE")||-1!=g().indexOf("Edge"));function v(t,e,n){for(const r in t)e.call(n,t[r],r,t)}function b(t){const e={};for(const n in t)e[n]=t[n];return e}const w="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function E(t,e){let n,r;for(let e=1;e<arguments.length;e++){for(n in r=arguments[e],r)t[n]=r[n];for(let e=0;e<w.length;e++)n=w[e],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function _(t){var e=1;t=t.split(":");const n=[];for(;0<e&&t.length;)n.push(t.shift()),e--;return t.length&&n.push(t.join(":")),n}function C(t){s.setTimeout((()=>{throw t}),0)}function T(){var t=A;let e=null;return t.g&&(e=t.g,t.g=t.g.next,t.g||(t.h=null),e.next=null),e}var S=new class{constructor(t,e){this.i=t,this.j=e,this.h=0,this.g=null}get(){let t;return 0<this.h?(this.h--,t=this.g,this.g=t.next,t.next=null):t=this.i(),t}}((()=>new k),(t=>t.reset()));class k{constructor(){this.next=this.g=this.h=null}set(t,e){this.h=t,this.g=e,this.next=null}reset(){this.next=this.g=this.h=null}}let x,I=!1,A=new class{constructor(){this.h=this.g=null}add(t,e){const n=S.get();n.set(t,e),this.h?this.h.next=n:this.g=n,this.h=n}},R=()=>{const t=s.Promise.resolve(void 0);x=()=>{t.then(D)}};var D=()=>{for(var t;t=T();){try{t.h.call(t.g)}catch(t){C(t)}var e=S;e.j(t),100>e.h&&(e.h++,t.next=e.g,e.g=t)}I=!1};function N(){this.s=this.s,this.C=this.C}function O(t,e){this.type=t,this.g=this.target=e,this.defaultPrevented=!1}N.prototype.s=!1,N.prototype.ma=function(){this.s||(this.s=!0,this.N())},N.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},O.prototype.h=function(){this.defaultPrevented=!0};var P=function(){if(!s.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{const t=()=>{};s.addEventListener("test",t,e),s.removeEventListener("test",t,e)}catch(t){}return t}();function L(t,e){if(O.call(this,t?t.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.g=e,e=t.relatedTarget){if(y){t:{try{m(e.nodeName);var s=!0;break t}catch(t){}s=!1}s||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:M[t.pointerType]||"",this.state=t.state,this.i=t,t.defaultPrevented&&L.aa.h.call(this)}}h(L,O);var M={2:"touch",3:"pen",4:"mouse"};L.prototype.h=function(){L.aa.h.call(this);var t=this.i;t.preventDefault?t.preventDefault():t.returnValue=!1};var F="closure_listenable_"+(1e6*Math.random()|0),U=0;function B(t,e,n,r,s){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.ha=s,this.key=++U,this.da=this.fa=!1}function V(t){t.da=!0,t.listener=null,t.proxy=null,t.src=null,t.ha=null}function q(t){this.src=t,this.g={},this.h=0}function j(t,e){var n=e.type;if(n in t.g){var r,s=t.g[n],i=Array.prototype.indexOf.call(s,e,void 0);(r=0<=i)&&Array.prototype.splice.call(s,i,1),r&&(V(e),0==t.g[n].length&&(delete t.g[n],t.h--))}}function $(t,e,n,r){for(var s=0;s<t.length;++s){var i=t[s];if(!i.da&&i.listener==e&&i.capture==!!n&&i.ha==r)return s}return-1}q.prototype.add=function(t,e,n,r,s){var i=t.toString();(t=this.g[i])||(t=this.g[i]=[],this.h++);var o=$(t,e,r,s);return-1<o?(e=t[o],n||(e.fa=!1)):((e=new B(e,this.src,i,!!r,s)).fa=n,t.push(e)),e};var z="closure_lm_"+(1e6*Math.random()|0),K={};function H(t,e,n,r,s){if(r&&r.once)return W(t,e,n,r,s);if(Array.isArray(e)){for(var i=0;i<e.length;i++)H(t,e[i],n,r,s);return null}return n=et(n),t&&t[F]?t.K(e,n,o(r)?!!r.capture:!!r,s):G(t,e,n,!1,r,s)}function G(t,e,n,r,s,i){if(!e)throw Error("Invalid event type");var a=o(s)?!!s.capture:!!s,c=Z(t);if(c||(t[z]=c=new q(t)),(n=c.add(e,n,r,a,i)).proxy)return n;if(r=function(){const t=J;return function e(n){return t.call(e.src,e.listener,n)}}(),n.proxy=r,r.src=t,r.listener=n,t.addEventListener)P||(s=a),void 0===s&&(s=!1),t.addEventListener(e.toString(),r,s);else if(t.attachEvent)t.attachEvent(X(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function W(t,e,n,r,s){if(Array.isArray(e)){for(var i=0;i<e.length;i++)W(t,e[i],n,r,s);return null}return n=et(n),t&&t[F]?t.L(e,n,o(r)?!!r.capture:!!r,s):G(t,e,n,!0,r,s)}function Q(t,e,n,r,s){if(Array.isArray(e))for(var i=0;i<e.length;i++)Q(t,e[i],n,r,s);else r=o(r)?!!r.capture:!!r,n=et(n),t&&t[F]?(t=t.i,(e=String(e).toString())in t.g&&-1<(n=$(i=t.g[e],n,r,s))&&(V(i[n]),Array.prototype.splice.call(i,n,1),0==i.length&&(delete t.g[e],t.h--))):t&&(t=Z(t))&&(e=t.g[e.toString()],t=-1,e&&(t=$(e,n,r,s)),(n=-1<t?e[t]:null)&&Y(n))}function Y(t){if("number"!=typeof t&&t&&!t.da){var e=t.src;if(e&&e[F])j(e.i,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(X(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Z(e))?(j(n,t),0==n.h&&(n.src=null,e[z]=null)):V(t)}}}function X(t){return t in K?K[t]:K[t]="on"+t}function J(t,e){if(t.da)t=!0;else{e=new L(e,this);var n=t.listener,r=t.ha||t.src;t.fa&&Y(t),t=n.call(r,e)}return t}function Z(t){return(t=t[z])instanceof q?t:null}var tt="__closure_events_fn_"+(1e9*Math.random()>>>0);function et(t){return"function"==typeof t?t:(t[tt]||(t[tt]=function(e){return t.handleEvent(e)}),t[tt])}function nt(){N.call(this),this.i=new q(this),this.M=this,this.F=null}function rt(t,e){var n,r=t.F;if(r)for(n=[];r;r=r.F)n.push(r);if(t=t.M,r=e.type||e,"string"==typeof e)e=new O(e,t);else if(e instanceof O)e.target=e.target||t;else{var s=e;E(e=new O(r,t),s)}if(s=!0,n)for(var i=n.length-1;0<=i;i--){var o=e.g=n[i];s=st(o,r,!0,e)&&s}if(s=st(o=e.g=t,r,!0,e)&&s,s=st(o,r,!1,e)&&s,n)for(i=0;i<n.length;i++)s=st(o=e.g=n[i],r,!1,e)&&s}function st(t,e,n,r){if(!(e=t.i.g[String(e)]))return!0;e=e.concat();for(var s=!0,i=0;i<e.length;++i){var o=e[i];if(o&&!o.da&&o.capture==n){var a=o.listener,c=o.ha||o.src;o.fa&&j(t.i,o),s=!1!==a.call(c,r)&&s}}return s&&!r.defaultPrevented}function it(t,e,n){if("function"==typeof t)n&&(t=l(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=l(t.handleEvent,t)}return 2147483647<Number(e)?-1:s.setTimeout(t,e||0)}function ot(t){t.g=it((()=>{t.g=null,t.i&&(t.i=!1,ot(t))}),t.l);const e=t.h;t.h=null,t.m.apply(null,e)}h(nt,N),nt.prototype[F]=!0,nt.prototype.removeEventListener=function(t,e,n,r){Q(this,t,e,n,r)},nt.prototype.N=function(){if(nt.aa.N.call(this),this.i){var t,e=this.i;for(t in e.g){for(var n=e.g[t],r=0;r<n.length;r++)V(n[r]);delete e.g[t],e.h--}}this.F=null},nt.prototype.K=function(t,e,n,r){return this.i.add(String(t),e,!1,n,r)},nt.prototype.L=function(t,e,n,r){return this.i.add(String(t),e,!0,n,r)};class at extends N{constructor(t,e){super(),this.m=t,this.l=e,this.h=null,this.i=!1,this.g=null}j(t){this.h=arguments,this.g?this.i=!0:ot(this)}N(){super.N(),this.g&&(s.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ct(t){N.call(this),this.h=t,this.g={}}h(ct,N);var lt=[];function ut(t){v(t.g,(function(t,e){this.g.hasOwnProperty(e)&&Y(t)}),t),t.g={}}ct.prototype.N=function(){ct.aa.N.call(this),ut(this)},ct.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var ht=s.JSON.stringify,dt=s.JSON.parse,ft=class{stringify(t){return s.JSON.stringify(t,void 0)}parse(t){return s.JSON.parse(t,void 0)}};function pt(){}function gt(t){return t.h||(t.h=t.i())}function mt(){}pt.prototype.h=null;var yt={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function vt(){O.call(this,"d")}function bt(){O.call(this,"c")}h(vt,O),h(bt,O);var wt={},Et=null;function _t(){return Et=Et||new nt}function Ct(t){O.call(this,wt.La,t)}function Tt(t){const e=_t();rt(e,new Ct(e))}function St(t,e){O.call(this,wt.STAT_EVENT,t),this.stat=e}function kt(t){const e=_t();rt(e,new St(e,t))}function xt(t,e){O.call(this,wt.Ma,t),this.size=e}function It(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return s.setTimeout((function(){t()}),e)}function At(){this.g=!0}function Rt(t,e,n,r){t.info((function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.g)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var r=n[t];if(!(2>r.length)){var s=r[1];if(Array.isArray(s)&&!(1>s.length)){var i=s[0];if("noop"!=i&&"stop"!=i&&"close"!=i)for(var o=1;o<s.length;o++)s[o]=""}}}return ht(n)}catch(t){return e}}(t,n)+(r?" "+r:"")}))}wt.La="serverreachability",h(Ct,O),wt.STAT_EVENT="statevent",h(St,O),wt.Ma="timingevent",h(xt,O),At.prototype.xa=function(){this.g=!1},At.prototype.info=function(){};var Dt,Nt={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Ot={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"};function Pt(){}function Lt(t,e,n,r){this.j=t,this.i=e,this.l=n,this.R=r||1,this.U=new ct(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Mt}function Mt(){this.i=null,this.g="",this.h=!1}h(Pt,pt),Pt.prototype.g=function(){return new XMLHttpRequest},Pt.prototype.i=function(){return{}},Dt=new Pt;var Ft={},Ut={};function Bt(t,e,n){t.L=1,t.v=Ee(me(e)),t.m=n,t.P=!0,Vt(t,null)}function Vt(t,e){t.F=Date.now(),Zt(t),t.A=me(t.v);var n=t.A,r=t.R;Array.isArray(r)||(r=[String(r)]),Le(n.i,"t",r),t.C=0,n=t.j.J,t.h=new Mt,t.g=Cn(t.j,n?e:null,!t.m),0<t.O&&(t.M=new at(l(t.Y,t,t.g),t.O)),e=t.U,n=t.g,r=t.ca;var s="readystatechange";Array.isArray(s)||(s&&(lt[0]=s.toString()),s=lt);for(var i=0;i<s.length;i++){var o=H(n,s[i],r||e.handleEvent,!1,e.h||e);if(!o)break;e.g[o.key]=o}e=t.H?b(t.H):{},t.m?(t.u||(t.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.g.ea(t.A,t.u,t.m,e)):(t.u="GET",t.g.ea(t.A,t.u,null,e)),Tt(),function(t,e,n,r,s,i){t.info((function(){if(t.g)if(i)for(var o="",a=i.split("&"),c=0;c<a.length;c++){var l=a[c].split("=");if(1<l.length){var u=l[0];l=l[1];var h=u.split("_");o=2<=h.length&&"type"==h[1]?o+(u+"=")+l+"&":o+(u+"=redacted&")}}else o=null;else o=i;return"XMLHTTP REQ ("+r+") [attempt "+s+"]: "+e+"\n"+n+"\n"+o}))}(t.i,t.u,t.A,t.l,t.R,t.m)}function qt(t){return!!t.g&&"GET"==t.u&&2!=t.L&&t.j.Ca}function Jt(t,e){var n=t.C,r=e.indexOf("\n",n);return-1==r?Ut:(n=Number(e.substring(n,r)),isNaN(n)?Ft:(r+=1)+n>e.length?Ut:(e=e.slice(r,r+n),t.C=r+n,e))}function Zt(t){t.S=Date.now()+t.I,te(t,t.I)}function te(t,e){if(null!=t.B)throw Error("WatchDog timer not null");t.B=It(l(t.ba,t),e)}function ee(t){t.B&&(s.clearTimeout(t.B),t.B=null)}function ne(t){0==t.j.G||t.J||vn(t.j,t)}function re(t){ee(t);var e=t.M;e&&"function"==typeof e.ma&&e.ma(),t.M=null,ut(t.U),t.g&&(e=t.g,t.g=null,e.abort(),e.ma())}function se(t,e){try{var n=t.j;if(0!=n.G&&(n.g==t||le(n.h,t)))if(!t.K&&le(n.h,t)&&3==n.G){try{var r=n.Da.g.parse(e)}catch(t){r=null}if(Array.isArray(r)&&3==r.length){var s=r;if(0==s[0]){t:if(!n.u){if(n.g){if(!(n.g.F+3e3<t.F))break t;yn(n),an(n)}pn(n),kt(18)}}else n.za=s[1],0<n.za-n.T&&37500>s[2]&&n.F&&0==n.v&&!n.C&&(n.C=It(l(n.Za,n),6e3));if(1>=ce(n.h)&&n.ca){try{n.ca()}catch(t){}n.ca=void 0}}else wn(n,11)}else if((t.K||n.g==t)&&yn(n),!p(e))for(s=n.Da.g.parse(e),e=0;e<s.length;e++){let l=s[e];if(n.T=l[0],l=l[1],2==n.G)if("c"==l[0]){n.K=l[1],n.ia=l[2];const e=l[3];null!=e&&(n.la=e,n.j.info("VER="+n.la));const s=l[4];null!=s&&(n.Aa=s,n.j.info("SVER="+n.Aa));const u=l[5];null!=u&&"number"==typeof u&&0<u&&(r=1.5*u,n.L=r,n.j.info("backChannelRequestTimeoutMs_="+r)),r=n;const h=t.g;if(h){const t=h.g?h.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(t){var i=r.h;i.g||-1==t.indexOf("spdy")&&-1==t.indexOf("quic")&&-1==t.indexOf("h2")||(i.j=i.l,i.g=new Set,i.h&&(ue(i,i.h),i.h=null))}if(r.D){const t=h.g?h.g.getResponseHeader("X-HTTP-Session-Id"):null;t&&(r.ya=t,we(r.I,r.D,t))}}n.G=3,n.l&&n.l.ua(),n.ba&&(n.R=Date.now()-t.F,n.j.info("Handshake RTT: "+n.R+"ms"));var o=t;if((r=n).qa=_n(r,r.J?r.ia:null,r.W),o.K){he(r.h,o);var a=o,c=r.L;c&&(a.I=c),a.B&&(ee(a),Zt(a)),r.g=o}else fn(r);0<n.i.length&&ln(n)}else"stop"!=l[0]&&"close"!=l[0]||wn(n,7);else 3==n.G&&("stop"==l[0]||"close"==l[0]?"stop"==l[0]?wn(n,7):on(n):"noop"!=l[0]&&n.l&&n.l.ta(l),n.v=0)}Tt()}catch(t){}}Lt.prototype.ca=function(t){t=t.target;const e=this.M;e&&3==en(t)?e.j():this.Y(t)},Lt.prototype.Y=function(t){try{if(t==this.g)t:{const d=en(this.g);var e=this.g.Ba();if(this.g.Z(),!(3>d)&&(3!=d||this.g&&(this.h.h||this.g.oa()||nn(this.g)))){this.J||4!=d||7==e||Tt(),ee(this);var n=this.g.Z();this.X=n;e:if(qt(this)){var r=nn(this.g);t="";var i=r.length,o=4==en(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){re(this),ne(this);var a="";break e}this.h.i=new s.TextDecoder}for(e=0;e<i;e++)this.h.h=!0,t+=this.h.i.decode(r[e],{stream:!(o&&e==i-1)});r.length=0,this.h.g+=t,this.C=0,a=this.h.g}else a=this.g.oa();if(this.o=200==n,function(t,e,n,r,s,i,o){t.info((function(){return"XMLHTTP RESP ("+r+") [ attempt "+s+"]: "+e+"\n"+n+"\n"+i+" "+o}))}(this.i,this.u,this.A,this.l,this.R,d,n),this.o){if(this.T&&!this.K){e:{if(this.g){var c,l=this.g;if((c=l.g?l.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!p(c)){var u=c;break e}}u=null}if(!(n=u)){this.o=!1,this.s=3,kt(12),re(this),ne(this);break t}Rt(this.i,this.l,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,se(this,n)}if(this.P){let t;for(n=!0;!this.J&&this.C<a.length;){if(t=Jt(this,a),t==Ut){4==d&&(this.s=4,kt(14),n=!1),Rt(this.i,this.l,null,"[Incomplete Response]");break}if(t==Ft){this.s=4,kt(15),Rt(this.i,this.l,a,"[Invalid Chunk]"),n=!1;break}Rt(this.i,this.l,t,null),se(this,t)}if(qt(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=d||0!=a.length||this.h.h||(this.s=1,kt(16),n=!1),this.o=this.o&&n,n){if(0<a.length&&!this.W){this.W=!0;var h=this.j;h.g==this&&h.ba&&!h.M&&(h.j.info("Great, no buffering proxy detected. Bytes received: "+a.length),gn(h),h.M=!0,kt(11))}}else Rt(this.i,this.l,a,"[Invalid Chunked Response]"),re(this),ne(this)}else Rt(this.i,this.l,a,null),se(this,a);4==d&&re(this),this.o&&!this.J&&(4==d?vn(this.j,this):(this.o=!1,Zt(this)))}else(function(t){const e={};t=(t.g&&2<=en(t)&&t.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<t.length;r++){if(p(t[r]))continue;var n=_(t[r]);const s=n[0];if("string"!=typeof(n=n[1]))continue;n=n.trim();const i=e[s]||[];e[s]=i,i.push(n)}!function(t,e){for(const n in t)e.call(void 0,t[n],n,t)}(e,(function(t){return t.join(", ")}))})(this.g),400==n&&0<a.indexOf("Unknown SID")?(this.s=3,kt(12)):(this.s=0,kt(13)),re(this),ne(this)}}}catch(t){}},Lt.prototype.cancel=function(){this.J=!0,re(this)},Lt.prototype.ba=function(){this.B=null;const t=Date.now();0<=t-this.S?(function(t,e){t.info((function(){return"TIMEOUT: "+e}))}(this.i,this.A),2!=this.L&&(Tt(),kt(17)),re(this),this.s=2,ne(this)):te(this,this.S-t)};var ie=class{constructor(t,e){this.g=t,this.map=e}};function oe(t){this.l=t||10,t=s.PerformanceNavigationTiming?0<(t=s.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(s.chrome&&s.chrome.loadTimes&&s.chrome.loadTimes()&&s.chrome.loadTimes().wasFetchedViaSpdy),this.j=t?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function ae(t){return!!t.h||!!t.g&&t.g.size>=t.j}function ce(t){return t.h?1:t.g?t.g.size:0}function le(t,e){return t.h?t.h==e:!!t.g&&t.g.has(e)}function ue(t,e){t.g?t.g.add(e):t.h=e}function he(t,e){t.h&&t.h==e?t.h=null:t.g&&t.g.has(e)&&t.g.delete(e)}function de(t){if(null!=t.h)return t.i.concat(t.h.D);if(null!=t.g&&0!==t.g.size){let e=t.i;for(const n of t.g.values())e=e.concat(n.D);return e}return d(t.i)}function fe(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(i(t)||"string"==typeof t)Array.prototype.forEach.call(t,e,void 0);else for(var n=function(t){if(t.na&&"function"==typeof t.na)return t.na();if(!t.V||"function"!=typeof t.V){if("undefined"!=typeof Map&&t instanceof Map)return Array.from(t.keys());if(!("undefined"!=typeof Set&&t instanceof Set)){if(i(t)||"string"==typeof t){var e=[];t=t.length;for(var n=0;n<t;n++)e.push(n);return e}e=[],n=0;for(const r in t)e[n++]=r;return e}}}(t),r=function(t){if(t.V&&"function"==typeof t.V)return t.V();if("undefined"!=typeof Map&&t instanceof Map||"undefined"!=typeof Set&&t instanceof Set)return Array.from(t.values());if("string"==typeof t)return t.split("");if(i(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t),s=r.length,o=0;o<s;o++)e.call(void 0,r[o],n&&n[o],t)}oe.prototype.cancel=function(){if(this.i=de(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const t of this.g.values())t.cancel();this.g.clear()}};var pe=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function ge(t){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,t instanceof ge){this.h=t.h,ye(this,t.j),this.o=t.o,this.g=t.g,ve(this,t.s),this.l=t.l;var e=t.i,n=new De;n.i=e.i,e.g&&(n.g=new Map(e.g),n.h=e.h),be(this,n),this.m=t.m}else t&&(e=String(t).match(pe))?(this.h=!1,ye(this,e[1]||"",!0),this.o=_e(e[2]||""),this.g=_e(e[3]||"",!0),ve(this,e[4]),this.l=_e(e[5]||"",!0),be(this,e[6]||"",!0),this.m=_e(e[7]||"")):(this.h=!1,this.i=new De(null,this.h))}function me(t){return new ge(t)}function ye(t,e,n){t.j=n?_e(e,!0):e,t.j&&(t.j=t.j.replace(/:$/,""))}function ve(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.s=e}else t.s=null}function be(t,e,n){e instanceof De?(t.i=e,function(t,e){e&&!t.j&&(Ne(t),t.i=null,t.g.forEach((function(t,e){var n=e.toLowerCase();e!=n&&(Oe(this,e),Le(this,n,t))}),t)),t.j=e}(t.i,t.h)):(n||(e=Ce(e,Ae)),t.i=new De(e,t.h))}function we(t,e,n){t.i.set(e,n)}function Ee(t){return we(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),t}function _e(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function Ce(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,Te),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function Te(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}ge.prototype.toString=function(){var t=[],e=this.j;e&&t.push(Ce(e,ke,!0),":");var n=this.g;return(n||"file"==e)&&(t.push("//"),(e=this.o)&&t.push(Ce(e,ke,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.s)&&t.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&t.push("/"),t.push(Ce(n,"/"==n.charAt(0)?Ie:xe,!0))),(n=this.i.toString())&&t.push("?",n),(n=this.m)&&t.push("#",Ce(n,Re)),t.join("")};var Se,ke=/[#\/\?@]/g,xe=/[#\?:]/g,Ie=/[#\?]/g,Ae=/[#\?@]/g,Re=/#/g;function De(t,e){this.h=this.g=null,this.i=t||null,this.j=!!e}function Ne(t){t.g||(t.g=new Map,t.h=0,t.i&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),s=null;if(0<=r){var i=t[n].substring(0,r);s=t[n].substring(r+1)}else i=t[n];e(i,s?decodeURIComponent(s.replace(/\+/g," ")):"")}}}(t.i,(function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)})))}function Oe(t,e){Ne(t),e=Me(t,e),t.g.has(e)&&(t.i=null,t.h-=t.g.get(e).length,t.g.delete(e))}function Pe(t,e){return Ne(t),e=Me(t,e),t.g.has(e)}function Le(t,e,n){Oe(t,e),0<n.length&&(t.i=null,t.g.set(Me(t,e),d(n)),t.h+=n.length)}function Me(t,e){return e=String(e),t.j&&(e=e.toLowerCase()),e}function Fe(t,e,n,r,s){try{s&&(s.onload=null,s.onerror=null,s.onabort=null,s.ontimeout=null),r(n)}catch(t){}}function Ue(){this.g=new ft}function Be(t,e,n){const r=n||"";try{fe(t,(function(t,n){let s=t;o(t)&&(s=ht(t)),e.push(r+n+"="+encodeURIComponent(s))}))}catch(t){throw e.push(r+"type="+encodeURIComponent("_badmap")),t}}function Ve(t){this.l=t.Ub||null,this.j=t.eb||!1}function qe(t,e){nt.call(this),this.D=t,this.o=e,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}function je(t){t.j.read().then(t.Pa.bind(t)).catch(t.ga.bind(t))}function $e(t){t.readyState=4,t.l=null,t.j=null,t.v=null,ze(t)}function ze(t){t.onreadystatechange&&t.onreadystatechange.call(t)}function Ke(t){let e="";return v(t,(function(t,n){e+=n,e+=":",e+=t,e+="\r\n"})),e}function He(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}r||(n=Ke(n),"string"==typeof t?null!=n&&encodeURIComponent(String(n)):we(t,e,n))}function Ge(t){nt.call(this),this.headers=new Map,this.o=t||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}(t=De.prototype).add=function(t,e){Ne(this),this.i=null,t=Me(this,t);var n=this.g.get(t);return n||this.g.set(t,n=[]),n.push(e),this.h+=1,this},t.forEach=function(t,e){Ne(this),this.g.forEach((function(n,r){n.forEach((function(n){t.call(e,n,r,this)}),this)}),this)},t.na=function(){Ne(this);const t=Array.from(this.g.values()),e=Array.from(this.g.keys()),n=[];for(let r=0;r<e.length;r++){const s=t[r];for(let t=0;t<s.length;t++)n.push(e[r])}return n},t.V=function(t){Ne(this);let e=[];if("string"==typeof t)Pe(this,t)&&(e=e.concat(this.g.get(Me(this,t))));else{t=Array.from(this.g.values());for(let n=0;n<t.length;n++)e=e.concat(t[n])}return e},t.set=function(t,e){return Ne(this),this.i=null,Pe(this,t=Me(this,t))&&(this.h-=this.g.get(t).length),this.g.set(t,[e]),this.h+=1,this},t.get=function(t,e){return t&&0<(t=this.V(t)).length?String(t[0]):e},t.toString=function(){if(this.i)return this.i;if(!this.g)return"";const t=[],e=Array.from(this.g.keys());for(var n=0;n<e.length;n++){var r=e[n];const i=encodeURIComponent(String(r)),o=this.V(r);for(r=0;r<o.length;r++){var s=i;""!==o[r]&&(s+="="+encodeURIComponent(String(o[r]))),t.push(s)}}return this.i=t.join("&")},h(Ve,pt),Ve.prototype.g=function(){return new qe(this.l,this.j)},Ve.prototype.i=(Se={},function(){return Se}),h(qe,nt),(t=qe.prototype).open=function(t,e){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.B=t,this.A=e,this.readyState=1,ze(this)},t.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.u,method:this.B,credentials:this.m,cache:void 0};t&&(e.body=t),(this.D||s).fetch(new Request(this.A,e)).then(this.Sa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch((()=>{})),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,$e(this)),this.readyState=0},t.Sa=function(t){if(this.g&&(this.l=t,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=t.headers,this.readyState=2,ze(this)),this.g&&(this.readyState=3,ze(this),this.g)))if("arraybuffer"===this.responseType)t.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(void 0!==s.ReadableStream&&"body"in t){if(this.j=t.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;je(this)}else t.text().then(this.Ra.bind(this),this.ga.bind(this))},t.Pa=function(t){if(this.g){if(this.o&&t.value)this.response.push(t.value);else if(!this.o){var e=t.value?t.value:new Uint8Array(0);(e=this.v.decode(e,{stream:!t.done}))&&(this.response=this.responseText+=e)}t.done?$e(this):ze(this),3==this.readyState&&je(this)}},t.Ra=function(t){this.g&&(this.response=this.responseText=t,$e(this))},t.Qa=function(t){this.g&&(this.response=t,$e(this))},t.ga=function(){this.g&&$e(this)},t.setRequestHeader=function(t,e){this.u.append(t,e)},t.getResponseHeader=function(t){return this.h&&this.h.get(t.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";const t=[],e=this.h.entries();for(var n=e.next();!n.done;)n=n.value,t.push(n[0]+": "+n[1]),n=e.next();return t.join("\r\n")},Object.defineProperty(qe.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(t){this.m=t?"include":"same-origin"}}),h(Ge,nt);var We=/^https?$/i,Qe=["POST","PUT"];function Ye(t,e){t.h=!1,t.g&&(t.j=!0,t.g.abort(),t.j=!1),t.l=e,t.m=5,Xe(t),Ze(t)}function Xe(t){t.A||(t.A=!0,rt(t,"complete"),rt(t,"error"))}function Je(t){if(t.h&&void 0!==r&&(!t.v[1]||4!=en(t)||2!=t.Z()))if(t.u&&4==en(t))it(t.Ea,0,t);else if(rt(t,"readystatechange"),4==en(t)){t.h=!1;try{const r=t.Z();t:switch(r){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break t;default:e=!1}var n;if(!(n=e)){var i;if(i=0===r){var o=String(t.D).match(pe)[1]||null;!o&&s.self&&s.self.location&&(o=s.self.location.protocol.slice(0,-1)),i=!We.test(o?o.toLowerCase():"")}n=i}if(n)rt(t,"complete"),rt(t,"success");else{t.m=6;try{var a=2<en(t)?t.g.statusText:""}catch(t){a=""}t.l=a+" ["+t.Z()+"]",Xe(t)}}finally{Ze(t)}}}function Ze(t,e){if(t.g){tn(t);const n=t.g,r=t.v[0]?()=>{}:null;t.g=null,t.v=null,e||rt(t,"ready");try{n.onreadystatechange=r}catch(t){}}}function tn(t){t.I&&(s.clearTimeout(t.I),t.I=null)}function en(t){return t.g?t.g.readyState:0}function nn(t){try{if(!t.g)return null;if("response"in t.g)return t.g.response;switch(t.H){case"":case"text":return t.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in t.g)return t.g.mozResponseArrayBuffer}return null}catch(t){return null}}function rn(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function sn(t){this.Aa=0,this.i=[],this.j=new At,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=rn("failFast",!1,t),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=rn("baseRetryDelayMs",5e3,t),this.cb=rn("retryDelaySeedMs",1e4,t),this.Wa=rn("forwardChannelMaxRetries",2,t),this.wa=rn("forwardChannelRequestTimeoutMs",2e4,t),this.pa=t&&t.xmlHttpFactory||void 0,this.Xa=t&&t.Tb||void 0,this.Ca=t&&t.useFetchStreams||!1,this.L=void 0,this.J=t&&t.supportsCrossDomainXhr||!1,this.K="",this.h=new oe(t&&t.concurrentRequestLimit),this.Da=new Ue,this.P=t&&t.fastHandshake||!1,this.O=t&&t.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=t&&t.Rb||!1,t&&t.xa&&this.j.xa(),t&&t.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&t&&t.detectBufferingProxy||!1,this.ja=void 0,t&&t.longPollingTimeout&&0<t.longPollingTimeout&&(this.ja=t.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}function on(t){if(cn(t),3==t.G){var e=t.U++,n=me(t.I);if(we(n,"SID",t.K),we(n,"RID",e),we(n,"TYPE","terminate"),hn(t,n),(e=new Lt(t,t.j,e)).L=2,e.v=Ee(me(n)),n=!1,s.navigator&&s.navigator.sendBeacon)try{n=s.navigator.sendBeacon(e.v.toString(),"")}catch(t){}!n&&s.Image&&((new Image).src=e.v,n=!0),n||(e.g=Cn(e.j,null),e.g.ea(e.v)),e.F=Date.now(),Zt(e)}En(t)}function an(t){t.g&&(gn(t),t.g.cancel(),t.g=null)}function cn(t){an(t),t.u&&(s.clearTimeout(t.u),t.u=null),yn(t),t.h.cancel(),t.s&&("number"==typeof t.s&&s.clearTimeout(t.s),t.s=null)}function ln(t){if(!ae(t.h)&&!t.s){t.s=!0;var e=t.Ga;x||R(),I||(x(),I=!0),A.add(e,t),t.B=0}}function un(t,e){var n;n=e?e.l:t.U++;const r=me(t.I);we(r,"SID",t.K),we(r,"RID",n),we(r,"AID",t.T),hn(t,r),t.m&&t.o&&He(r,t.m,t.o),n=new Lt(t,t.j,n,t.B+1),null===t.m&&(n.H=t.o),e&&(t.i=e.D.concat(t.i)),e=dn(t,n,1e3),n.I=Math.round(.5*t.wa)+Math.round(.5*t.wa*Math.random()),ue(t.h,n),Bt(n,r,e)}function hn(t,e){t.H&&v(t.H,(function(t,n){we(e,n,t)})),t.l&&fe({},(function(t,n){we(e,n,t)}))}function dn(t,e,n){n=Math.min(t.i.length,n);var r=t.l?l(t.l.Na,t.l,t):null;t:{var s=t.i;let e=-1;for(;;){const t=["count="+n];-1==e?0<n?(e=s[0].g,t.push("ofs="+e)):e=0:t.push("ofs="+e);let i=!0;for(let o=0;o<n;o++){let n=s[o].g;const a=s[o].map;if(n-=e,0>n)e=Math.max(0,s[o].g-100),i=!1;else try{Be(a,t,"req"+n+"_")}catch(t){r&&r(a)}}if(i){r=t.join("&");break t}}}return t=t.i.splice(0,n),e.D=t,r}function fn(t){if(!t.g&&!t.u){t.Y=1;var e=t.Fa;x||R(),I||(x(),I=!0),A.add(e,t),t.v=0}}function pn(t){return!(t.g||t.u||3<=t.v||(t.Y++,t.u=It(l(t.Fa,t),bn(t,t.v)),t.v++,0))}function gn(t){null!=t.A&&(s.clearTimeout(t.A),t.A=null)}function mn(t){t.g=new Lt(t,t.j,"rpc",t.Y),null===t.m&&(t.g.H=t.o),t.g.O=0;var e=me(t.qa);we(e,"RID","rpc"),we(e,"SID",t.K),we(e,"AID",t.T),we(e,"CI",t.F?"0":"1"),!t.F&&t.ja&&we(e,"TO",t.ja),we(e,"TYPE","xmlhttp"),hn(t,e),t.m&&t.o&&He(e,t.m,t.o),t.L&&(t.g.I=t.L);var n=t.g;t=t.ia,n.L=1,n.v=Ee(me(e)),n.m=null,n.P=!0,Vt(n,t)}function yn(t){null!=t.C&&(s.clearTimeout(t.C),t.C=null)}function vn(t,e){var n=null;if(t.g==e){yn(t),gn(t),t.g=null;var r=2}else{if(!le(t.h,e))return;n=e.D,he(t.h,e),r=1}if(0!=t.G)if(e.o)if(1==r){n=e.m?e.m.length:0,e=Date.now()-e.F;var s=t.B;rt(r=_t(),new xt(r,n)),ln(t)}else fn(t);else if(3==(s=e.s)||0==s&&0<e.X||!(1==r&&function(t,e){return!(ce(t.h)>=t.h.j-(t.s?1:0)||(t.s?(t.i=e.D.concat(t.i),0):1==t.G||2==t.G||t.B>=(t.Va?0:t.Wa)||(t.s=It(l(t.Ga,t,e),bn(t,t.B)),t.B++,0)))}(t,e)||2==r&&pn(t)))switch(n&&0<n.length&&(e=t.h,e.i=e.i.concat(n)),s){case 1:wn(t,5);break;case 4:wn(t,10);break;case 3:wn(t,6);break;default:wn(t,2)}}function bn(t,e){let n=t.Ta+Math.floor(Math.random()*t.cb);return t.isActive()||(n*=2),n*e}function wn(t,e){if(t.j.info("Error code "+e),2==e){var n=l(t.fb,t),r=t.Xa;const e=!r;r=new ge(r||"//www.google.com/images/cleardot.gif"),s.location&&"http"==s.location.protocol||ye(r,"https"),Ee(r),e?function(t,e){const n=new At;if(s.Image){const r=new Image;r.onload=u(Fe,n,"TestLoadImage: loaded",!0,e,r),r.onerror=u(Fe,n,"TestLoadImage: error",!1,e,r),r.onabort=u(Fe,n,"TestLoadImage: abort",!1,e,r),r.ontimeout=u(Fe,n,"TestLoadImage: timeout",!1,e,r),s.setTimeout((function(){r.ontimeout&&r.ontimeout()}),1e4),r.src=t}else e(!1)}(r.toString(),n):function(t,e){new At;const n=new AbortController,r=setTimeout((()=>{n.abort(),Fe(0,0,!1,e)}),1e4);fetch(t,{signal:n.signal}).then((t=>{clearTimeout(r),t.ok?Fe(0,0,!0,e):Fe(0,0,!1,e)})).catch((()=>{clearTimeout(r),Fe(0,0,!1,e)}))}(r.toString(),n)}else kt(2);t.G=0,t.l&&t.l.sa(e),En(t),cn(t)}function En(t){if(t.G=0,t.ka=[],t.l){const e=de(t.h);0==e.length&&0==t.i.length||(f(t.ka,e),f(t.ka,t.i),t.h.i.length=0,d(t.i),t.i.length=0),t.l.ra()}}function _n(t,e,n){var r=n instanceof ge?me(n):new ge(n);if(""!=r.g)e&&(r.g=e+"."+r.g),ve(r,r.s);else{var i=s.location;r=i.protocol,e=e?e+"."+i.hostname:i.hostname,i=+i.port;var o=new ge(null);r&&ye(o,r),e&&(o.g=e),i&&ve(o,i),n&&(o.l=n),r=o}return n=t.D,e=t.ya,n&&e&&we(r,n,e),we(r,"VER",t.la),hn(t,r),r}function Cn(t,e,n){if(e&&!t.J)throw Error("Can't create secondary domain capable XhrIo object.");return(e=t.Ca&&!t.pa?new Ge(new Ve({eb:n})):new Ge(t.pa)).Ha(t.J),e}function Tn(){}function Sn(){}function kn(t,e){nt.call(this),this.g=new sn(e),this.l=t,this.h=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.g.o=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.va&&(t?t["X-WebChannel-Client-Profile"]=e.va:t={"X-WebChannel-Client-Profile":e.va}),this.g.S=t,(t=e&&e.Sb)&&!p(t)&&(this.g.m=t),this.v=e&&e.supportsCrossDomainXhr||!1,this.u=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!p(e)&&(this.g.D=e,null!==(t=this.h)&&e in t&&e in(t=this.h)&&delete t[e]),this.j=new An(this)}function xn(t){vt.call(this),t.__headers__&&(this.headers=t.__headers__,this.statusCode=t.__status__,delete t.__headers__,delete t.__status__);var e=t.__sm__;if(e){t:{for(const n in e){t=n;break t}t=void 0}(this.i=t)&&(t=this.i,e=null!==e&&t in e?e[t]:void 0),this.data=e}else this.data=t}function In(){bt.call(this),this.status=1}function An(t){this.g=t}(t=Ge.prototype).Ha=function(t){this.J=t},t.ea=function(t,e,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+t);e=e?e.toUpperCase():"GET",this.D=t,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Dt.g(),this.v=this.o?gt(this.o):gt(Dt),this.g.onreadystatechange=l(this.Ea,this);try{this.B=!0,this.g.open(e,String(t),!0),this.B=!1}catch(t){return void Ye(this,t)}if(t=n||"",n=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var i in r)n.set(i,r[i]);else{if("function"!=typeof r.keys||"function"!=typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const t of r.keys())n.set(t,r.get(t))}r=Array.from(n.keys()).find((t=>"content-type"==t.toLowerCase())),i=s.FormData&&t instanceof s.FormData,!(0<=Array.prototype.indexOf.call(Qe,e,void 0))||r||i||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[t,e]of n)this.g.setRequestHeader(t,e);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{tn(this),this.u=!0,this.g.send(t),this.u=!1}catch(t){Ye(this,t)}},t.abort=function(t){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=t||7,rt(this,"complete"),rt(this,"abort"),Ze(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Ze(this,!0)),Ge.aa.N.call(this)},t.Ea=function(){this.s||(this.B||this.u||this.j?Je(this):this.bb())},t.bb=function(){Je(this)},t.isActive=function(){return!!this.g},t.Z=function(){try{return 2<en(this)?this.g.status:-1}catch(t){return-1}},t.oa=function(){try{return this.g?this.g.responseText:""}catch(t){return""}},t.Oa=function(t){if(this.g){var e=this.g.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),dt(e)}},t.Ba=function(){return this.m},t.Ka=function(){return"string"==typeof this.l?this.l:String(this.l)},(t=sn.prototype).la=8,t.G=1,t.connect=function(t,e,n,r){kt(0),this.W=t,this.H=e||{},n&&void 0!==r&&(this.H.OSID=n,this.H.OAID=r),this.F=this.X,this.I=_n(this,null,this.W),ln(this)},t.Ga=function(t){if(this.s)if(this.s=null,1==this.G){if(!t){this.U=Math.floor(1e5*Math.random()),t=this.U++;const s=new Lt(this,this.j,t);let i=this.o;if(this.S&&(i?(i=b(i),E(i,this.S)):i=this.S),null!==this.m||this.O||(s.H=i,i=null),this.P)t:{for(var e=0,n=0;n<this.i.length;n++){var r=this.i[n];if(void 0===(r="__data__"in r.map&&"string"==typeof(r=r.map.__data__)?r.length:void 0))break;if(4096<(e+=r)){e=n;break t}if(4096===e||n===this.i.length-1){e=n+1;break t}}e=1e3}else e=1e3;e=dn(this,s,e),we(n=me(this.I),"RID",t),we(n,"CVER",22),this.D&&we(n,"X-HTTP-Session-Id",this.D),hn(this,n),i&&(this.O?e="headers="+encodeURIComponent(String(Ke(i)))+"&"+e:this.m&&He(n,this.m,i)),ue(this.h,s),this.Ua&&we(n,"TYPE","init"),this.P?(we(n,"$req",e),we(n,"SID","null"),s.T=!0,Bt(s,n,null)):Bt(s,n,e),this.G=2}}else 3==this.G&&(t?un(this,t):0==this.i.length||ae(this.h)||un(this))},t.Fa=function(){if(this.u=null,mn(this),this.ba&&!(this.M||null==this.g||0>=this.R)){var t=2*this.R;this.j.info("BP detection timer enabled: "+t),this.A=It(l(this.ab,this),t)}},t.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,kt(10),an(this),mn(this))},t.Za=function(){null!=this.C&&(this.C=null,an(this),pn(this),kt(19))},t.fb=function(t){t?(this.j.info("Successfully pinged google.com"),kt(2)):(this.j.info("Failed to ping google.com"),kt(1))},t.isActive=function(){return!!this.l&&this.l.isActive(this)},(t=Tn.prototype).ua=function(){},t.ta=function(){},t.sa=function(){},t.ra=function(){},t.isActive=function(){return!0},t.Na=function(){},Sn.prototype.g=function(t,e){return new kn(t,e)},h(kn,nt),kn.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},kn.prototype.close=function(){on(this.g)},kn.prototype.o=function(t){var e=this.g;if("string"==typeof t){var n={};n.__data__=t,t=n}else this.u&&((n={}).__data__=ht(t),t=n);e.i.push(new ie(e.Ya++,t)),3==e.G&&ln(e)},kn.prototype.N=function(){this.g.l=null,delete this.j,on(this.g),delete this.g,kn.aa.N.call(this)},h(xn,vt),h(In,bt),h(An,Tn),An.prototype.ua=function(){rt(this.g,"a")},An.prototype.ta=function(t){rt(this.g,new xn(t))},An.prototype.sa=function(t){rt(this.g,new In)},An.prototype.ra=function(){rt(this.g,"b")},Sn.prototype.createWebChannel=Sn.prototype.g,kn.prototype.send=kn.prototype.o,kn.prototype.open=kn.prototype.m,kn.prototype.close=kn.prototype.close,Qt=Xt.createWebChannelTransport=function(){return new Sn},Wt=Xt.getStatEventTarget=function(){return _t()},Gt=Xt.Event=wt,Ht=Xt.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Nt.NO_ERROR=0,Nt.TIMEOUT=8,Nt.HTTP_ERROR=6,Kt=Xt.ErrorCode=Nt,Ot.COMPLETE="complete",zt=Xt.EventType=Ot,mt.EventType=yt,yt.OPEN="a",yt.CLOSE="b",yt.ERROR="c",yt.MESSAGE="d",nt.prototype.listen=nt.prototype.K,$t=Xt.WebChannel=mt,Xt.FetchXmlHttpFactory=Ve,Ge.prototype.listenOnce=Ge.prototype.L,Ge.prototype.getLastError=Ge.prototype.Ka,Ge.prototype.getLastErrorCode=Ge.prototype.Ba,Ge.prototype.getStatus=Ge.prototype.Z,Ge.prototype.getResponseJson=Ge.prototype.Oa,Ge.prototype.getResponseText=Ge.prototype.oa,Ge.prototype.send=Ge.prototype.ea,Ge.prototype.setWithCredentials=Ge.prototype.Ha,jt=Xt.XhrIo=Ge}).apply(void 0!==Yt?Yt:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});const Jt="@firebase/firestore";class Zt{constructor(t){this.uid=t}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}Zt.UNAUTHENTICATED=new Zt(null),Zt.GOOGLE_CREDENTIALS=new Zt("google-credentials-uid"),Zt.FIRST_PARTY=new Zt("first-party-uid"),Zt.MOCK_USER=new Zt("mock-user");let te="11.0.2";const ee=new S("@firebase/firestore");function ne(){return ee.logLevel}function re(t,...e){if(ee.logLevel<=w.DEBUG){const n=e.map(oe);ee.debug(`Firestore (${te}): ${t}`,...n)}}function se(t,...e){if(ee.logLevel<=w.ERROR){const n=e.map(oe);ee.error(`Firestore (${te}): ${t}`,...n)}}function ie(t,...e){if(ee.logLevel<=w.WARN){const n=e.map(oe);ee.warn(`Firestore (${te}): ${t}`,...n)}}function oe(t){if("string"==typeof t)return t;try{return function(t){return JSON.stringify(t)}(t)}catch(e){return t}}function ae(t="Unexpected state"){const e=`FIRESTORE (${te}) INTERNAL ASSERTION FAILED: `+t;throw se(e),new Error(e)}function ce(t,e){t||ae()}function le(t,e){return t}const ue={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class he extends l{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class de{constructor(){this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}}class fe{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}}class pe{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable((()=>e(Zt.UNAUTHENTICATED)))}shutdown(){}}class ge{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable((()=>e(this.token.user)))}shutdown(){this.changeListener=null}}class me{constructor(t){this.t=t,this.currentUser=Zt.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){ce(void 0===this.o);let n=this.i;const r=t=>this.i!==n?(n=this.i,e(t)):Promise.resolve();let s=new de;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new de,t.enqueueRetryable((()=>r(this.currentUser)))};const i=()=>{const e=s;t.enqueueRetryable((async()=>{await e.promise,await r(this.currentUser)}))},o=t=>{re("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=t,this.o&&(this.auth.addAuthTokenListener(this.o),i())};this.t.onInit((t=>o(t))),setTimeout((()=>{if(!this.auth){const t=this.t.getImmediate({optional:!0});t?o(t):(re("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new de)}}),0),i()}getToken(){const t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then((e=>this.i!==t?(re("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):e?(ce("string"==typeof e.accessToken),new fe(e.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const t=this.auth&&this.auth.getUid();return ce(null===t||"string"==typeof t),new Zt(t)}}class ye{constructor(t,e,n){this.l=t,this.h=e,this.P=n,this.type="FirstParty",this.user=Zt.FIRST_PARTY,this.T=new Map}I(){return this.P?this.P():null}get headers(){this.T.set("X-Goog-AuthUser",this.l);const t=this.I();return t&&this.T.set("Authorization",t),this.h&&this.T.set("X-Goog-Iam-Authorization-Token",this.h),this.T}}class ve{constructor(t,e,n){this.l=t,this.h=e,this.P=n}getToken(){return Promise.resolve(new ye(this.l,this.h,this.P))}start(t,e){t.enqueueRetryable((()=>e(Zt.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class be{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class we{constructor(t){this.A=t,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(t,e){ce(void 0===this.o);const n=t=>{null!=t.error&&re("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${t.error.message}`);const n=t.token!==this.R;return this.R=t.token,re("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?e(t.token):Promise.resolve()};this.o=e=>{t.enqueueRetryable((()=>n(e)))};const r=t=>{re("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=t,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit((t=>r(t))),setTimeout((()=>{if(!this.appCheck){const t=this.A.getImmediate({optional:!0});t?r(t):re("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then((t=>t?(ce("string"==typeof t.token),this.R=t.token,new be(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function Ee(t){const e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(let e=0;e<t;e++)n[e]=Math.floor(256*Math.random());return n}class _e{static newId(){const t=62*Math.floor(256/62);let e="";for(;e.length<20;){const n=Ee(40);for(let r=0;r<n.length;++r)e.length<20&&n[r]<t&&(e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(n[r]%62))}return e}}function Ce(t,e){return t<e?-1:t>e?1:0}function Te(t,e,n){return t.length===e.length&&t.every(((t,r)=>n(t,e[r])))}class Se{static now(){return Se.fromMillis(Date.now())}static fromDate(t){return Se.fromMillis(t.getTime())}static fromMillis(t){const e=Math.floor(t/1e3),n=Math.floor(1e6*(t-1e3*e));return new Se(e,n)}constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new he(ue.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new he(ue.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new he(ue.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new he(ue.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(t){return this.seconds===t.seconds?Ce(this.nanoseconds,t.nanoseconds):Ce(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class ke{static fromTimestamp(t){return new ke(t)}static min(){return new ke(new Se(0,0))}static max(){return new ke(new Se(253402300799,999999999))}constructor(t){this.timestamp=t}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class xe{constructor(t,e,n){void 0===e?e=0:e>t.length&&ae(),void 0===n?n=t.length-e:n>t.length-e&&ae(),this.segments=t,this.offset=e,this.len=n}get length(){return this.len}isEqual(t){return 0===xe.comparator(this,t)}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof xe?t.forEach((t=>{e.push(t)})):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=void 0===t?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return 0===this.length}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){const n=Math.min(t.length,e.length);for(let r=0;r<n;r++){const n=t.get(r),s=e.get(r);if(n<s)return-1;if(n>s)return 1}return t.length<e.length?-1:t.length>e.length?1:0}}class Ie extends xe{construct(t,e,n){return new Ie(t,e,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...t){const e=[];for(const n of t){if(n.indexOf("//")>=0)throw new he(ue.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);e.push(...n.split("/").filter((t=>t.length>0)))}return new Ie(e)}static emptyPath(){return new Ie([])}}const Ae=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Re extends xe{construct(t,e,n){return new Re(t,e,n)}static isValidIdentifier(t){return Ae.test(t)}canonicalString(){return this.toArray().map((t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Re.isValidIdentifier(t)||(t="`"+t+"`"),t))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new Re(["__name__"])}static fromServerFormat(t){const e=[];let n="",r=0;const s=()=>{if(0===n.length)throw new he(ue.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(n),n=""};let i=!1;for(;r<t.length;){const e=t[r];if("\\"===e){if(r+1===t.length)throw new he(ue.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const e=t[r+1];if("\\"!==e&&"."!==e&&"`"!==e)throw new he(ue.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=e,r+=2}else"`"===e?(i=!i,r++):"."!==e||i?(n+=e,r++):(s(),r++)}if(s(),i)throw new he(ue.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new Re(e)}static emptyPath(){return new Re([])}}class De{constructor(t){this.path=t}static fromPath(t){return new De(Ie.fromString(t))}static fromName(t){return new De(Ie.fromString(t).popFirst(5))}static empty(){return new De(Ie.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return null!==t&&0===Ie.comparator(this.path,t.path)}toString(){return this.path.toString()}static comparator(t,e){return Ie.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new De(new Ie(t.slice()))}}function Ne(t){return new Oe(t.readTime,t.key,-1)}class Oe{constructor(t,e,n){this.readTime=t,this.documentKey=e,this.largestBatchId=n}static min(){return new Oe(ke.min(),De.empty(),-1)}static max(){return new Oe(ke.max(),De.empty(),-1)}}function Pe(t,e){let n=t.readTime.compareTo(e.readTime);return 0!==n?n:(n=De.comparator(t.documentKey,e.documentKey),0!==n?n:Ce(t.largestBatchId,e.largestBatchId))}class Le{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((t=>t()))}}async function Me(t){if(t.code!==ue.FAILED_PRECONDITION||"The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab."!==t.message)throw t;re("LocalStore","Unexpectedly lost primary lease")}class Fe{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&ae(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new Fe(((n,r)=>{this.nextCallback=e=>{this.wrapSuccess(t,e).next(n,r)},this.catchCallback=t=>{this.wrapFailure(e,t).next(n,r)}}))}toPromise(){return new Promise(((t,e)=>{this.next(t,e)}))}wrapUserFunction(t){try{const e=t();return e instanceof Fe?e:Fe.resolve(e)}catch(t){return Fe.reject(t)}}wrapSuccess(t,e){return t?this.wrapUserFunction((()=>t(e))):Fe.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction((()=>t(e))):Fe.reject(e)}static resolve(t){return new Fe(((e,n)=>{e(t)}))}static reject(t){return new Fe(((e,n)=>{n(t)}))}static waitFor(t){return new Fe(((e,n)=>{let r=0,s=0,i=!1;t.forEach((t=>{++r,t.next((()=>{++s,i&&s===r&&e()}),(t=>n(t)))})),i=!0,s===r&&e()}))}static or(t){let e=Fe.resolve(!1);for(const n of t)e=e.next((t=>t?Fe.resolve(t):n()));return e}static forEach(t,e){const n=[];return t.forEach(((t,r)=>{n.push(e.call(this,t,r))})),this.waitFor(n)}static mapArray(t,e){return new Fe(((n,r)=>{const s=t.length,i=new Array(s);let o=0;for(let a=0;a<s;a++){const c=a;e(t[c]).next((t=>{i[c]=t,++o,o===s&&n(i)}),(t=>r(t)))}}))}static doWhile(t,e){return new Fe(((n,r)=>{const s=()=>{!0===t()?e().next((()=>{s()}),r):n()};s()}))}}function Ue(t){return"IndexedDbTransactionError"===t.name}class Be{constructor(t,e){this.previousValue=t,e&&(e.sequenceNumberHandler=t=>this.ie(t),this.se=t=>e.writeSequenceNumber(t))}ie(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.se&&this.se(t),t}}function Ve(t){return null==t}function qe(t){return 0===t&&1/t==-1/0}function je(t,e){let n=e;const r=t.length;for(let e=0;e<r;e++){const r=t.charAt(e);switch(r){case"\0":n+="";break;case"":n+="";break;default:n+=r}}return n}function $e(t){return t+""}Be.oe=-1;function ze(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Ke(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function He(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}class Ge{constructor(t,e){this.comparator=t,this.root=e||Qe.EMPTY}insert(t,e){return new Ge(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,Qe.BLACK,null,null))}remove(t){return new Ge(this.comparator,this.root.remove(t,this.comparator).copy(null,null,Qe.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){const n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null}indexOf(t){let e=0,n=this.root;for(;!n.isEmpty();){const r=this.comparator(t,n.key);if(0===r)return e+n.left.size;r<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal(((e,n)=>(t(e,n),!1)))}toString(){const t=[];return this.inorderTraversal(((e,n)=>(t.push(`${e}:${n}`),!1))),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new We(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new We(this.root,t,this.comparator,!1)}getReverseIterator(){return new We(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new We(this.root,t,this.comparator,!0)}}class We{constructor(t,e,n,r){this.isReverse=r,this.nodeStack=[];let s=1;for(;!t.isEmpty();)if(s=e?n(t.key,e):1,e&&r&&(s*=-1),s<0)t=this.isReverse?t.left:t.right;else{if(0===s){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class Qe{constructor(t,e,n,r,s){this.key=t,this.value=e,this.color=null!=n?n:Qe.RED,this.left=null!=r?r:Qe.EMPTY,this.right=null!=s?s:Qe.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,n,r,s){return new Qe(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=s?s:this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,n){let r=this;const s=n(t,r.key);return r=s<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===s?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return Qe.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let n,r=this;if(e(t,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(t,e),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===e(t,r.key)){if(r.right.isEmpty())return Qe.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(t,e))}return r.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,Qe.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,Qe.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw ae();if(this.right.isRed())throw ae();const t=this.left.check();if(t!==this.right.check())throw ae();return t+(this.isRed()?0:1)}}Qe.EMPTY=null,Qe.RED=!0,Qe.BLACK=!1,Qe.EMPTY=new class{constructor(){this.size=0}get key(){throw ae()}get value(){throw ae()}get color(){throw ae()}get left(){throw ae()}get right(){throw ae()}copy(t,e,n,r,s){return this}insert(t,e,n){return new Qe(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Ye{constructor(t){this.comparator=t,this.data=new Ge(this.comparator)}has(t){return null!==this.data.get(t)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal(((e,n)=>(t(e),!1)))}forEachInRange(t,e){const n=this.data.getIteratorFrom(t[0]);for(;n.hasNext();){const r=n.getNext();if(this.comparator(r.key,t[1])>=0)return;e(r.key)}}forEachWhile(t,e){let n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return}firstAfterOrEqual(t){const e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new Xe(this.data.getIterator())}getIteratorFrom(t){return new Xe(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach((t=>{e=e.add(t)})),e}isEqual(t){if(!(t instanceof Ye))return!1;if(this.size!==t.size)return!1;const e=this.data.getIterator(),n=t.data.getIterator();for(;e.hasNext();){const t=e.getNext().key,r=n.getNext().key;if(0!==this.comparator(t,r))return!1}return!0}toArray(){const t=[];return this.forEach((e=>{t.push(e)})),t}toString(){const t=[];return this.forEach((e=>t.push(e))),"SortedSet("+t.toString()+")"}copy(t){const e=new Ye(this.comparator);return e.data=t,e}}class Xe{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class Je{constructor(t){this.fields=t,t.sort(Re.comparator)}static empty(){return new Je([])}unionWith(t){let e=new Ye(Re.comparator);for(const t of this.fields)e=e.add(t);for(const n of t)e=e.add(n);return new Je(e.toArray())}covers(t){for(const e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return Te(this.fields,t.fields,((t,e)=>t.isEqual(e)))}}class Ze extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class tn{constructor(t){this.binaryString=t}static fromBase64String(t){const e=function(t){try{return atob(t)}catch(t){throw"undefined"!=typeof DOMException&&t instanceof DOMException?new Ze("Invalid base64 string: "+t):t}}(t);return new tn(e)}static fromUint8Array(t){const e=function(t){let e="";for(let n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t);return new tn(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return t=this.binaryString,btoa(t);var t}toUint8Array(){return function(t){const e=new Uint8Array(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return Ce(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}tn.EMPTY_BYTE_STRING=new tn("");const en=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function nn(t){if(ce(!!t),"string"==typeof t){let e=0;const n=en.exec(t);if(ce(!!n),n[1]){let t=n[1];t=(t+"000000000").substr(0,9),e=Number(t)}const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:rn(t.seconds),nanos:rn(t.nanos)}}function rn(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function sn(t){return"string"==typeof t?tn.fromBase64String(t):tn.fromUint8Array(t)}function on(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function an(t){const e=t.mapValue.fields.__previous_value__;return on(e)?an(e):e}function cn(t){const e=nn(t.mapValue.fields.__local_write_time__.timestampValue);return new Se(e.seconds,e.nanos)}class ln{constructor(t,e,n,r,s,i,o,a,c){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=r,this.ssl=s,this.forceLongPolling=i,this.autoDetectLongPolling=o,this.longPollingOptions=a,this.useFetchStreams=c}}class un{constructor(t,e){this.projectId=t,this.database=e||"(default)"}static empty(){return new un("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(t){return t instanceof un&&t.projectId===this.projectId&&t.database===this.database}}const hn={fields:{__type__:{stringValue:"__max__"}}};function dn(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?on(t)?4:In(t)?9007199254740991:kn(t)?10:11:ae()}function fn(t,e){if(t===e)return!0;const n=dn(t);if(n!==dn(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return cn(t).isEqual(cn(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;const n=nn(t.timestampValue),r=nn(e.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return sn(t.bytesValue).isEqual(sn(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return rn(t.geoPointValue.latitude)===rn(e.geoPointValue.latitude)&&rn(t.geoPointValue.longitude)===rn(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return rn(t.integerValue)===rn(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){const n=rn(t.doubleValue),r=rn(e.doubleValue);return n===r?qe(n)===qe(r):isNaN(n)&&isNaN(r)}return!1}(t,e);case 9:return Te(t.arrayValue.values||[],e.arrayValue.values||[],fn);case 10:case 11:return function(t,e){const n=t.mapValue.fields||{},r=e.mapValue.fields||{};if(ze(n)!==ze(r))return!1;for(const t in n)if(n.hasOwnProperty(t)&&(void 0===r[t]||!fn(n[t],r[t])))return!1;return!0}(t,e);default:return ae()}}function pn(t,e){return void 0!==(t.values||[]).find((t=>fn(t,e)))}function gn(t,e){if(t===e)return 0;const n=dn(t),r=dn(e);if(n!==r)return Ce(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return Ce(t.booleanValue,e.booleanValue);case 2:return function(t,e){const n=rn(t.integerValue||t.doubleValue),r=rn(e.integerValue||e.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(t,e);case 3:return mn(t.timestampValue,e.timestampValue);case 4:return mn(cn(t),cn(e));case 5:return Ce(t.stringValue,e.stringValue);case 6:return function(t,e){const n=sn(t),r=sn(e);return n.compareTo(r)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){const n=t.split("/"),r=e.split("/");for(let t=0;t<n.length&&t<r.length;t++){const e=Ce(n[t],r[t]);if(0!==e)return e}return Ce(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){const n=Ce(rn(t.latitude),rn(e.latitude));return 0!==n?n:Ce(rn(t.longitude),rn(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return yn(t.arrayValue,e.arrayValue);case 10:return function(t,e){var n,r,s,i;const o=t.fields||{},a=e.fields||{},c=null===(n=o.value)||void 0===n?void 0:n.arrayValue,l=null===(r=a.value)||void 0===r?void 0:r.arrayValue,u=Ce((null===(s=null==c?void 0:c.values)||void 0===s?void 0:s.length)||0,(null===(i=null==l?void 0:l.values)||void 0===i?void 0:i.length)||0);return 0!==u?u:yn(c,l)}(t.mapValue,e.mapValue);case 11:return function(t,e){if(t===hn&&e===hn)return 0;if(t===hn)return 1;if(e===hn)return-1;const n=t.fields||{},r=Object.keys(n),s=e.fields||{},i=Object.keys(s);r.sort(),i.sort();for(let t=0;t<r.length&&t<i.length;++t){const e=Ce(r[t],i[t]);if(0!==e)return e;const o=gn(n[r[t]],s[i[t]]);if(0!==o)return o}return Ce(r.length,i.length)}(t.mapValue,e.mapValue);default:throw ae()}}function mn(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return Ce(t,e);const n=nn(t),r=nn(e),s=Ce(n.seconds,r.seconds);return 0!==s?s:Ce(n.nanos,r.nanos)}function yn(t,e){const n=t.values||[],r=e.values||[];for(let t=0;t<n.length&&t<r.length;++t){const e=gn(n[t],r[t]);if(e)return e}return Ce(n.length,r.length)}function vn(t){return bn(t)}function bn(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(t){const e=nn(t);return`time(${e.seconds},${e.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?function(t){return sn(t).toBase64()}(t.bytesValue):"referenceValue"in t?function(t){return De.fromName(t).toString()}(t.referenceValue):"geoPointValue"in t?function(t){return`geo(${t.latitude},${t.longitude})`}(t.geoPointValue):"arrayValue"in t?function(t){let e="[",n=!0;for(const r of t.values||[])n?n=!1:e+=",",e+=bn(r);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){const e=Object.keys(t.fields||{}).sort();let n="{",r=!0;for(const s of e)r?r=!1:n+=",",n+=`${s}:${bn(t.fields[s])}`;return n+"}"}(t.mapValue):ae()}function wn(t){switch(dn(t)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=an(t);return e?16+wn(e):16;case 5:return 2*t.stringValue.length;case 6:return sn(t.bytesValue).approximateByteSize();case 7:return t.referenceValue.length;case 9:return function(t){return(t.values||[]).reduce(((t,e)=>t+wn(e)),0)}(t.arrayValue);case 10:case 11:return function(t){let e=0;return Ke(t.fields,((t,n)=>{e+=t.length+wn(n)})),e}(t.mapValue);default:throw ae()}}function En(t){return!!t&&"integerValue"in t}function _n(t){return!!t&&"arrayValue"in t}function Cn(t){return!!t&&"nullValue"in t}function Tn(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Sn(t){return!!t&&"mapValue"in t}function kn(t){var e,n;return"__vector__"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function xn(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&"object"==typeof t.timestampValue)return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const e={mapValue:{fields:{}}};return Ke(t.mapValue.fields,((t,n)=>e.mapValue.fields[t]=xn(n))),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=xn(t.arrayValue.values[n]);return e}return Object.assign({},t)}function In(t){return"__max__"===(((t.mapValue||{}).fields||{}).__type__||{}).stringValue}class An{constructor(t){this.value=t}static empty(){return new An({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let n=0;n<t.length-1;++n)if(e=(e.mapValue.fields||{})[t.get(n)],!Sn(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=xn(e)}setAll(t){let e=Re.emptyPath(),n={},r=[];t.forEach(((t,s)=>{if(!e.isImmediateParentOf(s)){const t=this.getFieldsMap(e);this.applyChanges(t,n,r),n={},r=[],e=s.popLast()}t?n[s.lastSegment()]=xn(t):r.push(s.lastSegment())}));const s=this.getFieldsMap(e);this.applyChanges(s,n,r)}delete(t){const e=this.field(t.popLast());Sn(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return fn(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let n=0;n<t.length;++n){let r=e.mapValue.fields[t.get(n)];Sn(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=r),e=r}return e.mapValue.fields}applyChanges(t,e,n){Ke(e,((e,n)=>t[e]=n));for(const e of n)delete t[e]}clone(){return new An(xn(this.value))}}function Rn(t){const e=[];return Ke(t.fields,((t,n)=>{const r=new Re([t]);if(Sn(n)){const t=Rn(n.mapValue).fields;if(0===t.length)e.push(r);else for(const n of t)e.push(r.child(n))}else e.push(r)})),new Je(e)}class Dn{constructor(t,e,n,r,s,i,o){this.key=t,this.documentType=e,this.version=n,this.readTime=r,this.createTime=s,this.data=i,this.documentState=o}static newInvalidDocument(t){return new Dn(t,0,ke.min(),ke.min(),ke.min(),An.empty(),0)}static newFoundDocument(t,e,n,r){return new Dn(t,1,e,ke.min(),n,r,0)}static newNoDocument(t,e){return new Dn(t,2,e,ke.min(),ke.min(),An.empty(),0)}static newUnknownDocument(t,e){return new Dn(t,3,e,ke.min(),ke.min(),An.empty(),2)}convertToFoundDocument(t,e){return!this.createTime.isEqual(ke.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=t),this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=An.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=An.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=ke.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(t){return t instanceof Dn&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new Dn(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Nn{constructor(t,e){this.position=t,this.inclusive=e}}function On(t,e,n){let r=0;for(let s=0;s<t.position.length;s++){const i=e[s],o=t.position[s];if(r=i.field.isKeyField()?De.comparator(De.fromName(o.referenceValue),n.key):gn(o,n.data.field(i.field)),"desc"===i.dir&&(r*=-1),0!==r)break}return r}function Pn(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!fn(t.position[n],e.position[n]))return!1;return!0}class Ln{constructor(t,e="asc"){this.field=t,this.dir=e}}function Mn(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}class Fn{}class Un extends Fn{constructor(t,e,n){super(),this.field=t,this.op=e,this.value=n}static create(t,e,n){return t.isKeyField()?"in"===e||"not-in"===e?this.createKeyFieldInFilter(t,e,n):new Kn(t,e,n):"array-contains"===e?new Qn(t,n):"in"===e?new Yn(t,n):"not-in"===e?new Xn(t,n):"array-contains-any"===e?new Jn(t,n):new Un(t,e,n)}static createKeyFieldInFilter(t,e,n){return"in"===e?new Hn(t,n):new Gn(t,n)}matches(t){const e=t.data.field(this.field);return"!="===this.op?null!==e&&this.matchesComparison(gn(e,this.value)):null!==e&&dn(this.value)===dn(e)&&this.matchesComparison(gn(e,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return ae()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Bn extends Fn{constructor(t,e){super(),this.filters=t,this.op=e,this.ae=null}static create(t,e){return new Bn(t,e)}matches(t){return Vn(this)?void 0===this.filters.find((e=>!e.matches(t))):void 0!==this.filters.find((e=>e.matches(t)))}getFlattenedFilters(){return null!==this.ae||(this.ae=this.filters.reduce(((t,e)=>t.concat(e.getFlattenedFilters())),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function Vn(t){return"and"===t.op}function qn(t){return function(t){for(const e of t.filters)if(e instanceof Bn)return!1;return!0}(t)&&Vn(t)}function jn(t){if(t instanceof Un)return t.field.canonicalString()+t.op.toString()+vn(t.value);if(qn(t))return t.filters.map((t=>jn(t))).join(",");{const e=t.filters.map((t=>jn(t))).join(",");return`${t.op}(${e})`}}function $n(t,e){return t instanceof Un?function(t,e){return e instanceof Un&&t.op===e.op&&t.field.isEqual(e.field)&&fn(t.value,e.value)}(t,e):t instanceof Bn?function(t,e){return e instanceof Bn&&t.op===e.op&&t.filters.length===e.filters.length&&t.filters.reduce(((t,n,r)=>t&&$n(n,e.filters[r])),!0)}(t,e):void ae()}function zn(t){return t instanceof Un?function(t){return`${t.field.canonicalString()} ${t.op} ${vn(t.value)}`}(t):t instanceof Bn?function(t){return t.op.toString()+" {"+t.getFilters().map(zn).join(" ,")+"}"}(t):"Filter"}class Kn extends Un{constructor(t,e,n){super(t,e,n),this.key=De.fromName(n.referenceValue)}matches(t){const e=De.comparator(t.key,this.key);return this.matchesComparison(e)}}class Hn extends Un{constructor(t,e){super(t,"in",e),this.keys=Wn(0,e)}matches(t){return this.keys.some((e=>e.isEqual(t.key)))}}class Gn extends Un{constructor(t,e){super(t,"not-in",e),this.keys=Wn(0,e)}matches(t){return!this.keys.some((e=>e.isEqual(t.key)))}}function Wn(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map((t=>De.fromName(t.referenceValue)))}class Qn extends Un{constructor(t,e){super(t,"array-contains",e)}matches(t){const e=t.data.field(this.field);return _n(e)&&pn(e.arrayValue,this.value)}}class Yn extends Un{constructor(t,e){super(t,"in",e)}matches(t){const e=t.data.field(this.field);return null!==e&&pn(this.value.arrayValue,e)}}class Xn extends Un{constructor(t,e){super(t,"not-in",e)}matches(t){if(pn(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const e=t.data.field(this.field);return null!==e&&!pn(this.value.arrayValue,e)}}class Jn extends Un{constructor(t,e){super(t,"array-contains-any",e)}matches(t){const e=t.data.field(this.field);return!(!_n(e)||!e.arrayValue.values)&&e.arrayValue.values.some((t=>pn(this.value.arrayValue,t)))}}class Zn{constructor(t,e=null,n=[],r=[],s=null,i=null,o=null){this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=s,this.startAt=i,this.endAt=o,this.ue=null}}function tr(t,e=null,n=[],r=[],s=null,i=null,o=null){return new Zn(t,e,n,r,s,i,o)}function er(t){const e=le(t);if(null===e.ue){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((t=>jn(t))).join(","),t+="|ob:",t+=e.orderBy.map((t=>function(t){return t.field.canonicalString()+t.dir}(t))).join(","),Ve(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((t=>vn(t))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((t=>vn(t))).join(",")),e.ue=t}return e.ue}function nr(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!Mn(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(!$n(t.filters[n],e.filters[n]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!Pn(t.startAt,e.startAt)&&Pn(t.endAt,e.endAt)}function rr(t){return De.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}class sr{constructor(t,e=null,n=[],r=[],s=null,i="F",o=null,a=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=s,this.limitType=i,this.startAt=o,this.endAt=a,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function ir(t){return new sr(t)}function or(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.explicitOrderBy.length||1===t.explicitOrderBy.length&&t.explicitOrderBy[0].field.isKeyField())}function ar(t){const e=le(t);if(null===e.ce){e.ce=[];const t=new Set;for(const n of e.explicitOrderBy)e.ce.push(n),t.add(n.field.canonicalString());const n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc",r=function(t){let e=new Ye(Re.comparator);return t.filters.forEach((t=>{t.getFlattenedFilters().forEach((t=>{t.isInequality()&&(e=e.add(t.field))}))})),e}(e);r.forEach((r=>{t.has(r.canonicalString())||r.isKeyField()||e.ce.push(new Ln(r,n))})),t.has(Re.keyField().canonicalString())||e.ce.push(new Ln(Re.keyField(),n))}return e.ce}function cr(t){const e=le(t);return e.le||(e.le=function(t,e){if("F"===t.limitType)return tr(t.path,t.collectionGroup,e,t.filters,t.limit,t.startAt,t.endAt);{e=e.map((t=>{const e="desc"===t.dir?"asc":"desc";return new Ln(t.field,e)}));const n=t.endAt?new Nn(t.endAt.position,t.endAt.inclusive):null,r=t.startAt?new Nn(t.startAt.position,t.startAt.inclusive):null;return tr(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}}(e,ar(t))),e.le}function lr(t,e,n){return new sr(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function ur(t,e){return nr(cr(t),cr(e))&&t.limitType===e.limitType}function hr(t){return`${er(cr(t))}|lt:${t.limitType}`}function dr(t){return`Query(target=${function(t){let e=t.path.canonicalString();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=`, filters: [${t.filters.map((t=>zn(t))).join(", ")}]`),Ve(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=`, orderBy: [${t.orderBy.map((t=>function(t){return`${t.field.canonicalString()} (${t.dir})`}(t))).join(", ")}]`),t.startAt&&(e+=", startAt: ",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((t=>vn(t))).join(",")),t.endAt&&(e+=", endAt: ",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((t=>vn(t))).join(",")),`Target(${e})`}(cr(t))}; limitType=${t.limitType})`}function fr(t,e){return e.isFoundDocument()&&function(t,e){const n=e.key.path;return null!==t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(n):De.isDocumentKey(t.path)?t.path.isEqual(n):t.path.isImmediateParentOf(n)}(t,e)&&function(t,e){for(const n of ar(t))if(!n.field.isKeyField()&&null===e.data.field(n.field))return!1;return!0}(t,e)&&function(t,e){for(const n of t.filters)if(!n.matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!function(t,e,n){const r=On(t,e,n);return t.inclusive?r<=0:r<0}(t.startAt,ar(t),e)||t.endAt&&!function(t,e,n){const r=On(t,e,n);return t.inclusive?r>=0:r>0}(t.endAt,ar(t),e))}(t,e)}function pr(t){return(e,n)=>{let r=!1;for(const s of ar(t)){const t=gr(s,e,n);if(0!==t)return t;r=r||s.field.isKeyField()}return 0}}function gr(t,e,n){const r=t.field.isKeyField()?De.comparator(e.key,n.key):function(t,e,n){const r=e.data.field(t),s=n.data.field(t);return null!==r&&null!==s?gn(r,s):ae()}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return ae()}}class mr{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(const[e,r]of n)if(this.equalsFn(e,t))return r}has(t){return void 0!==this.get(t)}set(t,e){const n=this.mapKeyFn(t),r=this.inner[n];if(void 0===r)return this.inner[n]=[[t,e]],void this.innerSize++;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],t))return void(r[n]=[t,e]);r.push([t,e]),this.innerSize++}delete(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],t))return 1===n.length?delete this.inner[e]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(t){Ke(this.inner,((e,n)=>{for(const[e,r]of n)t(e,r)}))}isEmpty(){return He(this.inner)}size(){return this.innerSize}}const yr=new Ge(De.comparator);function vr(){return yr}const br=new Ge(De.comparator);function wr(...t){let e=br;for(const n of t)e=e.insert(n.key,n);return e}function Er(t){let e=br;return t.forEach(((t,n)=>e=e.insert(t,n.overlayedDocument))),e}function _r(){return Tr()}function Cr(){return Tr()}function Tr(){return new mr((t=>t.toString()),((t,e)=>t.isEqual(e)))}const Sr=new Ge(De.comparator),kr=new Ye(De.comparator);function xr(...t){let e=kr;for(const n of t)e=e.add(n);return e}const Ir=new Ye(Ce);function Ar(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:qe(e)?"-0":e}}function Rr(t){return{integerValue:""+t}}function Dr(t,e){return function(t){return"number"==typeof t&&Number.isInteger(t)&&!qe(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}(e)?Rr(e):Ar(t,e)}class Nr{constructor(){this._=void 0}}function Or(t,e,n){return t instanceof Mr?function(t,e){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&on(e)&&(e=an(e)),e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof Fr?Ur(t,e):t instanceof Br?Vr(t,e):function(t,e){const n=Lr(t,e),r=jr(n)+jr(t.Pe);return En(n)&&En(t.Pe)?Rr(r):Ar(t.serializer,r)}(t,e)}function Pr(t,e,n){return t instanceof Fr?Ur(t,e):t instanceof Br?Vr(t,e):n}function Lr(t,e){return t instanceof qr?function(t){return En(t)||function(t){return!!t&&"doubleValue"in t}(t)}(e)?e:{integerValue:0}:null}class Mr extends Nr{}class Fr extends Nr{constructor(t){super(),this.elements=t}}function Ur(t,e){const n=$r(e);for(const e of t.elements)n.some((t=>fn(t,e)))||n.push(e);return{arrayValue:{values:n}}}class Br extends Nr{constructor(t){super(),this.elements=t}}function Vr(t,e){let n=$r(e);for(const e of t.elements)n=n.filter((t=>!fn(t,e)));return{arrayValue:{values:n}}}class qr extends Nr{constructor(t,e){super(),this.serializer=t,this.Pe=e}}function jr(t){return rn(t.integerValue||t.doubleValue)}function $r(t){return _n(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}class zr{constructor(t,e){this.version=t,this.transformResults=e}}class Kr{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new Kr}static exists(t){return new Kr(void 0,t)}static updateTime(t){return new Kr(t)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function Hr(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}class Gr{}function Wr(t,e){if(!t.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return t.isNoDocument()?new ss(t.key,Kr.none()):new Zr(t.key,t.data,Kr.none());{const n=t.data,r=An.empty();let s=new Ye(Re.comparator);for(let t of e.fields)if(!s.has(t)){let e=n.field(t);null===e&&t.length>1&&(t=t.popLast(),e=n.field(t)),null===e?r.delete(t):r.set(t,e),s=s.add(t)}return new ts(t.key,r,new Je(s.toArray()),Kr.none())}}function Qr(t,e,n){t instanceof Zr?function(t,e,n){const r=t.value.clone(),s=ns(t.fieldTransforms,e,n.transformResults);r.setAll(s),e.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(t,e,n):t instanceof ts?function(t,e,n){if(!Hr(t.precondition,e))return void e.convertToUnknownDocument(n.version);const r=ns(t.fieldTransforms,e,n.transformResults),s=e.data;s.setAll(es(t)),s.setAll(r),e.convertToFoundDocument(n.version,s).setHasCommittedMutations()}(t,e,n):function(t,e,n){e.convertToNoDocument(n.version).setHasCommittedMutations()}(0,e,n)}function Yr(t,e,n,r){return t instanceof Zr?function(t,e,n,r){if(!Hr(t.precondition,e))return n;const s=t.value.clone(),i=rs(t.fieldTransforms,r,e);return s.setAll(i),e.convertToFoundDocument(e.version,s).setHasLocalMutations(),null}(t,e,n,r):t instanceof ts?function(t,e,n,r){if(!Hr(t.precondition,e))return n;const s=rs(t.fieldTransforms,r,e),i=e.data;return i.setAll(es(t)),i.setAll(s),e.convertToFoundDocument(e.version,i).setHasLocalMutations(),null===n?null:n.unionWith(t.fieldMask.fields).unionWith(t.fieldTransforms.map((t=>t.field)))}(t,e,n,r):function(t,e,n){return Hr(t.precondition,e)?(e.convertToNoDocument(e.version).setHasLocalMutations(),null):n}(t,e,n)}function Xr(t,e){let n=null;for(const r of t.fieldTransforms){const t=e.data.field(r.field),s=Lr(r.transform,t||null);null!=s&&(null===n&&(n=An.empty()),n.set(r.field,s))}return n||null}function Jr(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(t,e){return void 0===t&&void 0===e||!(!t||!e)&&Te(t,e,((t,e)=>function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof Fr&&e instanceof Fr||t instanceof Br&&e instanceof Br?Te(t.elements,e.elements,fn):t instanceof qr&&e instanceof qr?fn(t.Pe,e.Pe):t instanceof Mr&&e instanceof Mr}(t.transform,e.transform)}(t,e)))}(t.fieldTransforms,e.fieldTransforms)&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class Zr extends Gr{constructor(t,e,n,r=[]){super(),this.key=t,this.value=e,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class ts extends Gr{constructor(t,e,n,r,s=[]){super(),this.key=t,this.data=e,this.fieldMask=n,this.precondition=r,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function es(t){const e=new Map;return t.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const r=t.data.field(n);e.set(n,r)}})),e}function ns(t,e,n){const r=new Map;ce(t.length===n.length);for(let s=0;s<n.length;s++){const i=t[s],o=i.transform,a=e.data.field(i.field);r.set(i.field,Pr(o,a,n[s]))}return r}function rs(t,e,n){const r=new Map;for(const s of t){const t=s.transform,i=n.data.field(s.field);r.set(s.field,Or(t,i,e))}return r}class ss extends Gr{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class is extends Gr{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class os{constructor(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(t,e){const n=e.mutationResults;for(let e=0;e<this.mutations.length;e++){const r=this.mutations[e];r.key.isEqual(t.key)&&Qr(r,t,n[e])}}applyToLocalView(t,e){for(const n of this.baseMutations)n.key.isEqual(t.key)&&(e=Yr(n,t,e,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(t.key)&&(e=Yr(n,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){const n=Cr();return this.mutations.forEach((r=>{const s=t.get(r.key),i=s.overlayedDocument;let o=this.applyToLocalView(i,s.mutatedFields);o=e.has(r.key)?null:o;const a=Wr(i,o);null!==a&&n.set(r.key,a),i.isValidDocument()||i.convertToNoDocument(ke.min())})),n}keys(){return this.mutations.reduce(((t,e)=>t.add(e.key)),xr())}isEqual(t){return this.batchId===t.batchId&&Te(this.mutations,t.mutations,((t,e)=>Jr(t,e)))&&Te(this.baseMutations,t.baseMutations,((t,e)=>Jr(t,e)))}}class as{constructor(t,e,n,r){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=r}static from(t,e,n){ce(t.mutations.length===n.length);let r=Sr;const s=t.mutations;for(let t=0;t<s.length;t++)r=r.insert(s[t].key,n[t].version);return new as(t,e,n,r)}}class cs{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return null!==t&&this.mutation===t.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class ls{constructor(t,e){this.count=t,this.unchangedNames=e}}var us,hs;function ds(t){if(void 0===t)return se("GRPC error has no .code"),ue.UNKNOWN;switch(t){case us.OK:return ue.OK;case us.CANCELLED:return ue.CANCELLED;case us.UNKNOWN:return ue.UNKNOWN;case us.DEADLINE_EXCEEDED:return ue.DEADLINE_EXCEEDED;case us.RESOURCE_EXHAUSTED:return ue.RESOURCE_EXHAUSTED;case us.INTERNAL:return ue.INTERNAL;case us.UNAVAILABLE:return ue.UNAVAILABLE;case us.UNAUTHENTICATED:return ue.UNAUTHENTICATED;case us.INVALID_ARGUMENT:return ue.INVALID_ARGUMENT;case us.NOT_FOUND:return ue.NOT_FOUND;case us.ALREADY_EXISTS:return ue.ALREADY_EXISTS;case us.PERMISSION_DENIED:return ue.PERMISSION_DENIED;case us.FAILED_PRECONDITION:return ue.FAILED_PRECONDITION;case us.ABORTED:return ue.ABORTED;case us.OUT_OF_RANGE:return ue.OUT_OF_RANGE;case us.UNIMPLEMENTED:return ue.UNIMPLEMENTED;case us.DATA_LOSS:return ue.DATA_LOSS;default:return ae()}}(hs=us||(us={}))[hs.OK=0]="OK",hs[hs.CANCELLED=1]="CANCELLED",hs[hs.UNKNOWN=2]="UNKNOWN",hs[hs.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",hs[hs.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",hs[hs.NOT_FOUND=5]="NOT_FOUND",hs[hs.ALREADY_EXISTS=6]="ALREADY_EXISTS",hs[hs.PERMISSION_DENIED=7]="PERMISSION_DENIED",hs[hs.UNAUTHENTICATED=16]="UNAUTHENTICATED",hs[hs.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",hs[hs.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",hs[hs.ABORTED=10]="ABORTED",hs[hs.OUT_OF_RANGE=11]="OUT_OF_RANGE",hs[hs.UNIMPLEMENTED=12]="UNIMPLEMENTED",hs[hs.INTERNAL=13]="INTERNAL",hs[hs.UNAVAILABLE=14]="UNAVAILABLE",hs[hs.DATA_LOSS=15]="DATA_LOSS";const fs=new Ut([4294967295,4294967295],0);function ps(t){const e=(new TextEncoder).encode(t),n=new Bt;return n.update(e),new Uint8Array(n.digest())}function gs(t){const e=new DataView(t.buffer),n=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new Ut([n,r],0),new Ut([s,i],0)]}class ms{constructor(t,e,n){if(this.bitmap=t,this.padding=e,this.hashCount=n,e<0||e>=8)throw new ys(`Invalid padding: ${e}`);if(n<0)throw new ys(`Invalid hash count: ${n}`);if(t.length>0&&0===this.hashCount)throw new ys(`Invalid hash count: ${n}`);if(0===t.length&&0!==e)throw new ys(`Invalid padding when bitmap length is 0: ${e}`);this.Te=8*t.length-e,this.Ie=Ut.fromNumber(this.Te)}Ee(t,e,n){let r=t.add(e.multiply(Ut.fromNumber(n)));return 1===r.compare(fs)&&(r=new Ut([r.getBits(0),r.getBits(1)],0)),r.modulo(this.Ie).toNumber()}de(t){return!!(this.bitmap[Math.floor(t/8)]&1<<t%8)}mightContain(t){if(0===this.Te)return!1;const e=ps(t),[n,r]=gs(e);for(let t=0;t<this.hashCount;t++){const e=this.Ee(n,r,t);if(!this.de(e))return!1}return!0}static create(t,e,n){const r=t%8==0?0:8-t%8,s=new Uint8Array(Math.ceil(t/8)),i=new ms(s,r,e);return n.forEach((t=>i.insert(t))),i}insert(t){if(0===this.Te)return;const e=ps(t),[n,r]=gs(e);for(let t=0;t<this.hashCount;t++){const e=this.Ee(n,r,t);this.Ae(e)}}Ae(t){const e=Math.floor(t/8),n=t%8;this.bitmap[e]|=1<<n}}class ys extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class vs{constructor(t,e,n,r,s){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(t,e,n){const r=new Map;return r.set(t,bs.createSynthesizedTargetChangeForCurrentChange(t,e,n)),new vs(ke.min(),r,new Ge(Ce),vr(),xr())}}class bs{constructor(t,e,n,r,s){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(t,e,n){return new bs(n,e,xr(),xr(),xr())}}class ws{constructor(t,e,n,r){this.Re=t,this.removedTargetIds=e,this.key=n,this.Ve=r}}class Es{constructor(t,e){this.targetId=t,this.me=e}}class _s{constructor(t,e,n=tn.EMPTY_BYTE_STRING,r=null){this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r}}class Cs{constructor(){this.fe=0,this.ge=ks(),this.pe=tn.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return 0!==this.fe}get be(){return this.we}De(t){t.approximateByteSize()>0&&(this.we=!0,this.pe=t)}ve(){let t=xr(),e=xr(),n=xr();return this.ge.forEach(((r,s)=>{switch(s){case 0:t=t.add(r);break;case 2:e=e.add(r);break;case 1:n=n.add(r);break;default:ae()}})),new bs(this.pe,this.ye,t,e,n)}Ce(){this.we=!1,this.ge=ks()}Fe(t,e){this.we=!0,this.ge=this.ge.insert(t,e)}Me(t){this.we=!0,this.ge=this.ge.remove(t)}xe(){this.fe+=1}Oe(){this.fe-=1,ce(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class Ts{constructor(t){this.Le=t,this.Be=new Map,this.ke=vr(),this.qe=Ss(),this.Qe=Ss(),this.Ke=new Ge(Ce)}$e(t){for(const e of t.Re)t.Ve&&t.Ve.isFoundDocument()?this.Ue(e,t.Ve):this.We(e,t.key,t.Ve);for(const e of t.removedTargetIds)this.We(e,t.key,t.Ve)}Ge(t){this.forEachTarget(t,(e=>{const n=this.ze(e);switch(t.state){case 0:this.je(e)&&n.De(t.resumeToken);break;case 1:n.Oe(),n.Se||n.Ce(),n.De(t.resumeToken);break;case 2:n.Oe(),n.Se||this.removeTarget(e);break;case 3:this.je(e)&&(n.Ne(),n.De(t.resumeToken));break;case 4:this.je(e)&&(this.He(e),n.De(t.resumeToken));break;default:ae()}}))}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.Be.forEach(((t,n)=>{this.je(n)&&e(n)}))}Je(t){const e=t.targetId,n=t.me.count,r=this.Ye(e);if(r){const s=r.target;if(rr(s))if(0===n){const t=new De(s.path);this.We(e,t,Dn.newNoDocument(t,ke.min()))}else ce(1===n);else{const r=this.Ze(e);if(r!==n){const n=this.Xe(t),s=n?this.et(n,t,r):1;if(0!==s){this.He(e);const t=2===s?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ke=this.Ke.insert(e,t)}}}}}Xe(t){const e=t.me.unchangedNames;if(!e||!e.bits)return null;const{bits:{bitmap:n="",padding:r=0},hashCount:s=0}=e;let i,o;try{i=sn(n).toUint8Array()}catch(t){if(t instanceof Ze)return ie("Decoding the base64 bloom filter in existence filter failed ("+t.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw t}try{o=new ms(i,r,s)}catch(t){return ie(t instanceof ys?"BloomFilter error: ":"Applying bloom filter failed: ",t),null}return 0===o.Te?null:o}et(t,e,n){return e.me.count===n-this.rt(t,e.targetId)?0:2}rt(t,e){const n=this.Le.getRemoteKeysForTarget(e);let r=0;return n.forEach((n=>{const s=this.Le.nt(),i=`projects/${s.projectId}/databases/${s.database}/documents/${n.path.canonicalString()}`;t.mightContain(i)||(this.We(e,n,null),r++)})),r}it(t){const e=new Map;this.Be.forEach(((n,r)=>{const s=this.Ye(r);if(s){if(n.current&&rr(s.target)){const e=new De(s.target.path);this.st(e).has(r)||this.ot(r,e)||this.We(r,e,Dn.newNoDocument(e,t))}n.be&&(e.set(r,n.ve()),n.Ce())}}));let n=xr();this.Qe.forEach(((t,e)=>{let r=!0;e.forEachWhile((t=>{const e=this.Ye(t);return!e||"TargetPurposeLimboResolution"===e.purpose||(r=!1,!1)})),r&&(n=n.add(t))})),this.ke.forEach(((e,n)=>n.setReadTime(t)));const r=new vs(t,e,this.Ke,this.ke,n);return this.ke=vr(),this.qe=Ss(),this.Qe=Ss(),this.Ke=new Ge(Ce),r}Ue(t,e){if(!this.je(t))return;const n=this.ot(t,e.key)?2:0;this.ze(t).Fe(e.key,n),this.ke=this.ke.insert(e.key,e),this.qe=this.qe.insert(e.key,this.st(e.key).add(t)),this.Qe=this.Qe.insert(e.key,this._t(e.key).add(t))}We(t,e,n){if(!this.je(t))return;const r=this.ze(t);this.ot(t,e)?r.Fe(e,1):r.Me(e),this.Qe=this.Qe.insert(e,this._t(e).delete(t)),this.Qe=this.Qe.insert(e,this._t(e).add(t)),n&&(this.ke=this.ke.insert(e,n))}removeTarget(t){this.Be.delete(t)}Ze(t){const e=this.ze(t).ve();return this.Le.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}xe(t){this.ze(t).xe()}ze(t){let e=this.Be.get(t);return e||(e=new Cs,this.Be.set(t,e)),e}_t(t){let e=this.Qe.get(t);return e||(e=new Ye(Ce),this.Qe=this.Qe.insert(t,e)),e}st(t){let e=this.qe.get(t);return e||(e=new Ye(Ce),this.qe=this.qe.insert(t,e)),e}je(t){const e=null!==this.Ye(t);return e||re("WatchChangeAggregator","Detected inactive target",t),e}Ye(t){const e=this.Be.get(t);return e&&e.Se?null:this.Le.ut(t)}He(t){this.Be.set(t,new Cs),this.Le.getRemoteKeysForTarget(t).forEach((e=>{this.We(t,e,null)}))}ot(t,e){return this.Le.getRemoteKeysForTarget(t).has(e)}}function Ss(){return new Ge(De.comparator)}function ks(){return new Ge(De.comparator)}const xs={asc:"ASCENDING",desc:"DESCENDING"},Is={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},As={and:"AND",or:"OR"};class Rs{constructor(t,e){this.databaseId=t,this.useProto3Json=e}}function Ds(t,e){return t.useProto3Json||Ve(e)?e:{value:e}}function Ns(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Os(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function Ps(t,e){return Ns(t,e.toTimestamp())}function Ls(t){return ce(!!t),ke.fromTimestamp(function(t){const e=nn(t);return new Se(e.seconds,e.nanos)}(t))}function Ms(t,e){return Fs(t,e).canonicalString()}function Fs(t,e){const n=function(t){return new Ie(["projects",t.projectId,"databases",t.database])}(t).child("documents");return void 0===e?n:n.child(e)}function Us(t){const e=Ie.fromString(t);return ce(ni(e)),e}function Bs(t,e){return Ms(t.databaseId,e.path)}function Vs(t,e){const n=Us(e);if(n.get(1)!==t.databaseId.projectId)throw new he(ue.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new he(ue.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new De($s(n))}function qs(t,e){return Ms(t.databaseId,e)}function js(t){return new Ie(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function $s(t){return ce(t.length>4&&"documents"===t.get(4)),t.popFirst(5)}function zs(t,e,n){return{name:Bs(t,e),fields:n.value.mapValue.fields}}function Ks(t,e){return{documents:[qs(t,e.path)]}}function Hs(t,e){const n={structuredQuery:{}},r=e.path;let s;null!==e.collectionGroup?(s=r,n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=qs(t,s);const i=function(t){if(0!==t.length)return ti(Bn.create(t,"and"))}(e.filters);i&&(n.structuredQuery.where=i);const o=function(t){if(0!==t.length)return t.map((t=>function(t){return{field:Js(t.field),direction:Qs(t.dir)}}(t)))}(e.orderBy);o&&(n.structuredQuery.orderBy=o);const a=Ds(t,e.limit);return null!==a&&(n.structuredQuery.limit=a),e.startAt&&(n.structuredQuery.startAt=function(t){return{before:t.inclusive,values:t.position}}(e.startAt)),e.endAt&&(n.structuredQuery.endAt=function(t){return{before:!t.inclusive,values:t.position}}(e.endAt)),{ct:n,parent:s}}function Gs(t){let e=function(t){const e=Us(t);return 4===e.length?Ie.emptyPath():$s(e)}(t.parent);const n=t.structuredQuery,r=n.from?n.from.length:0;let s=null;if(r>0){ce(1===r);const t=n.from[0];t.allDescendants?s=t.collectionId:e=e.child(t.collectionId)}let i=[];n.where&&(i=function(t){const e=Ws(t);return e instanceof Bn&&qn(e)?e.getFilters():[e]}(n.where));let o=[];n.orderBy&&(o=function(t){return t.map((t=>function(t){return new Ln(Zs(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))}(t)))}(n.orderBy));let a=null;n.limit&&(a=function(t){let e;return e="object"==typeof t?t.value:t,Ve(e)?null:e}(n.limit));let c=null;n.startAt&&(c=function(t){const e=!!t.before,n=t.values||[];return new Nn(n,e)}(n.startAt));let l=null;return n.endAt&&(l=function(t){const e=!t.before,n=t.values||[];return new Nn(n,e)}(n.endAt)),function(t,e,n,r,s,i,o,a){return new sr(t,e,n,r,s,i,o,a)}(e,s,o,i,a,"F",c,l)}function Ws(t){return void 0!==t.unaryFilter?function(t){switch(t.unaryFilter.op){case"IS_NAN":const e=Zs(t.unaryFilter.field);return Un.create(e,"==",{doubleValue:NaN});case"IS_NULL":const n=Zs(t.unaryFilter.field);return Un.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=Zs(t.unaryFilter.field);return Un.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const s=Zs(t.unaryFilter.field);return Un.create(s,"!=",{nullValue:"NULL_VALUE"});default:return ae()}}(t):void 0!==t.fieldFilter?function(t){return Un.create(Zs(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return ae()}}(t.fieldFilter.op),t.fieldFilter.value)}(t):void 0!==t.compositeFilter?function(t){return Bn.create(t.compositeFilter.filters.map((t=>Ws(t))),function(t){switch(t){case"AND":return"and";case"OR":return"or";default:return ae()}}(t.compositeFilter.op))}(t):ae()}function Qs(t){return xs[t]}function Ys(t){return Is[t]}function Xs(t){return As[t]}function Js(t){return{fieldPath:t.canonicalString()}}function Zs(t){return Re.fromServerFormat(t.fieldPath)}function ti(t){return t instanceof Un?function(t){if("=="===t.op){if(Tn(t.value))return{unaryFilter:{field:Js(t.field),op:"IS_NAN"}};if(Cn(t.value))return{unaryFilter:{field:Js(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(Tn(t.value))return{unaryFilter:{field:Js(t.field),op:"IS_NOT_NAN"}};if(Cn(t.value))return{unaryFilter:{field:Js(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Js(t.field),op:Ys(t.op),value:t.value}}}(t):t instanceof Bn?function(t){const e=t.getFilters().map((t=>ti(t)));return 1===e.length?e[0]:{compositeFilter:{op:Xs(t.op),filters:e}}}(t):ae()}function ei(t){const e=[];return t.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}function ni(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}class ri{constructor(t,e,n,r,s=ke.min(),i=ke.min(),o=tn.EMPTY_BYTE_STRING,a=null){this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=i,this.resumeToken=o,this.expectedCount=a}withSequenceNumber(t){return new ri(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,e){return new ri(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new ri(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new ri(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}}class si{constructor(t){this.ht=t}}function ii(t){const e=Gs({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?lr(e,e.limit,"L"):e}class oi{constructor(){}Et(t,e){this.dt(t,e),e.At()}dt(t,e){if("nullValue"in t)this.Rt(e,5);else if("booleanValue"in t)this.Rt(e,10),e.Vt(t.booleanValue?1:0);else if("integerValue"in t)this.Rt(e,15),e.Vt(rn(t.integerValue));else if("doubleValue"in t){const n=rn(t.doubleValue);isNaN(n)?this.Rt(e,13):(this.Rt(e,15),qe(n)?e.Vt(0):e.Vt(n))}else if("timestampValue"in t){let n=t.timestampValue;this.Rt(e,20),"string"==typeof n&&(n=nn(n)),e.ft(`${n.seconds||""}`),e.Vt(n.nanos||0)}else if("stringValue"in t)this.gt(t.stringValue,e),this.yt(e);else if("bytesValue"in t)this.Rt(e,30),e.wt(sn(t.bytesValue)),this.yt(e);else if("referenceValue"in t)this.St(t.referenceValue,e);else if("geoPointValue"in t){const n=t.geoPointValue;this.Rt(e,45),e.Vt(n.latitude||0),e.Vt(n.longitude||0)}else"mapValue"in t?In(t)?this.Rt(e,Number.MAX_SAFE_INTEGER):kn(t)?this.bt(t.mapValue,e):(this.Dt(t.mapValue,e),this.yt(e)):"arrayValue"in t?(this.vt(t.arrayValue,e),this.yt(e)):ae()}gt(t,e){this.Rt(e,25),this.Ct(t,e)}Ct(t,e){e.ft(t)}Dt(t,e){const n=t.fields||{};this.Rt(e,55);for(const t of Object.keys(n))this.gt(t,e),this.dt(n[t],e)}bt(t,e){var n,r;const s=t.fields||{};this.Rt(e,53);const i="value",o=(null===(r=null===(n=s[i].arrayValue)||void 0===n?void 0:n.values)||void 0===r?void 0:r.length)||0;this.Rt(e,15),e.Vt(rn(o)),this.gt(i,e),this.dt(s[i],e)}vt(t,e){const n=t.values||[];this.Rt(e,50);for(const t of n)this.dt(t,e)}St(t,e){this.Rt(e,37),De.fromName(t).path.forEach((t=>{this.Rt(e,60),this.Ct(t,e)}))}Rt(t,e){t.Vt(e)}yt(t){t.Vt(2)}}oi.Ft=new oi;class ai{constructor(){this.ln=new ci}addToCollectionParentIndex(t,e){return this.ln.add(e),Fe.resolve()}getCollectionParents(t,e){return Fe.resolve(this.ln.getEntries(e))}addFieldIndex(t,e){return Fe.resolve()}deleteFieldIndex(t,e){return Fe.resolve()}deleteAllFieldIndexes(t){return Fe.resolve()}createTargetIndexes(t,e){return Fe.resolve()}getDocumentsMatchingTarget(t,e){return Fe.resolve(null)}getIndexType(t,e){return Fe.resolve(0)}getFieldIndexes(t,e){return Fe.resolve([])}getNextCollectionGroupToUpdate(t){return Fe.resolve(null)}getMinOffset(t,e){return Fe.resolve(Oe.min())}getMinOffsetFromCollectionGroup(t,e){return Fe.resolve(Oe.min())}updateCollectionGroup(t,e,n){return Fe.resolve()}updateIndexEntries(t,e){return Fe.resolve()}}class ci{constructor(){this.index={}}add(t){const e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new Ye(Ie.comparator),s=!r.has(n);return this.index[e]=r.add(n),s}has(t){const e=t.lastSegment(),n=t.popLast(),r=this.index[e];return r&&r.has(n)}getEntries(t){return(this.index[t]||new Ye(Ie.comparator)).toArray()}}new Uint8Array(0);const li={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class ui{static withCacheSize(t){return new ui(t,ui.DEFAULT_COLLECTION_PERCENTILE,ui.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}}ui.DEFAULT_COLLECTION_PERCENTILE=10,ui.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,ui.DEFAULT=new ui(41943040,ui.DEFAULT_COLLECTION_PERCENTILE,ui.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),ui.DISABLED=new ui(-1,0,0);class hi{constructor(t){this.kn=t}next(){return this.kn+=2,this.kn}static qn(){return new hi(0)}static Qn(){return new hi(-1)}}function di([t,e],[n,r]){const s=Ce(t,n);return 0===s?Ce(e,r):s}class fi{constructor(t){this.Gn=t,this.buffer=new Ye(di),this.zn=0}jn(){return++this.zn}Hn(t){const e=[t,this.jn()];if(this.buffer.size<this.Gn)this.buffer=this.buffer.add(e);else{const t=this.buffer.last();di(e,t)<0&&(this.buffer=this.buffer.delete(t).add(e))}}get maxValue(){return this.buffer.last()[0]}}class pi{constructor(t,e,n){this.garbageCollector=t,this.asyncQueue=e,this.localStore=n,this.Jn=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Yn(6e4)}stop(){this.Jn&&(this.Jn.cancel(),this.Jn=null)}get started(){return null!==this.Jn}Yn(t){re("LruGarbageCollector",`Garbage collection scheduled in ${t}ms`),this.Jn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,(async()=>{this.Jn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){Ue(t)?re("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t):await Me(t)}await this.Yn(3e5)}))}}class gi{constructor(t,e){this.Zn=t,this.params=e}calculateTargetCount(t,e){return this.Zn.Xn(t).next((t=>Math.floor(e/100*t)))}nthSequenceNumber(t,e){if(0===e)return Fe.resolve(Be.oe);const n=new fi(e);return this.Zn.forEachTarget(t,(t=>n.Hn(t.sequenceNumber))).next((()=>this.Zn.er(t,(t=>n.Hn(t))))).next((()=>n.maxValue))}removeTargets(t,e,n){return this.Zn.removeTargets(t,e,n)}removeOrphanedDocuments(t,e){return this.Zn.removeOrphanedDocuments(t,e)}collect(t,e){return-1===this.params.cacheSizeCollectionThreshold?(re("LruGarbageCollector","Garbage collection skipped; disabled"),Fe.resolve(li)):this.getCacheSize(t).next((n=>n<this.params.cacheSizeCollectionThreshold?(re("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),li):this.tr(t,e)))}getCacheSize(t){return this.Zn.getCacheSize(t)}tr(t,e){let n,r,s,i,o,a,c;const l=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next((e=>(e>this.params.maximumSequenceNumbersToCollect?(re("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${e}`),r=this.params.maximumSequenceNumbersToCollect):r=e,i=Date.now(),this.nthSequenceNumber(t,r)))).next((r=>(n=r,o=Date.now(),this.removeTargets(t,n,e)))).next((e=>(s=e,a=Date.now(),this.removeOrphanedDocuments(t,n)))).next((t=>(c=Date.now(),ne()<=w.DEBUG&&re("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${i-l}ms\n\tDetermined least recently used ${r} in `+(o-i)+"ms\n"+`\tRemoved ${s} targets in `+(a-o)+"ms\n"+`\tRemoved ${t} documents in `+(c-a)+"ms\n"+`Total Duration: ${c-l}ms`),Fe.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:s,documentsRemoved:t}))))}}class mi{constructor(){this.changes=new mr((t=>t.toString()),((t,e)=>t.isEqual(e))),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,Dn.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();const n=this.changes.get(e);return void 0!==n?Fe.resolve(n):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}class yi{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}}class vi{constructor(t,e,n,r){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=n,this.indexManager=r}getDocument(t,e){let n=null;return this.documentOverlayCache.getOverlay(t,e).next((r=>(n=r,this.remoteDocumentCache.getEntry(t,e)))).next((t=>(null!==n&&Yr(n.mutation,t,Je.empty(),Se.now()),t)))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next((e=>this.getLocalViewOfDocuments(t,e,xr()).next((()=>e))))}getLocalViewOfDocuments(t,e,n=xr()){const r=_r();return this.populateOverlays(t,r,e).next((()=>this.computeViews(t,e,r,n).next((t=>{let e=wr();return t.forEach(((t,n)=>{e=e.insert(t,n.overlayedDocument)})),e}))))}getOverlayedDocuments(t,e){const n=_r();return this.populateOverlays(t,n,e).next((()=>this.computeViews(t,e,n,xr())))}populateOverlays(t,e,n){const r=[];return n.forEach((t=>{e.has(t)||r.push(t)})),this.documentOverlayCache.getOverlays(t,r).next((t=>{t.forEach(((t,n)=>{e.set(t,n)}))}))}computeViews(t,e,n,r){let s=vr();const i=Tr(),o=Tr();return e.forEach(((t,e)=>{const o=n.get(e.key);r.has(e.key)&&(void 0===o||o.mutation instanceof ts)?s=s.insert(e.key,e):void 0!==o?(i.set(e.key,o.mutation.getFieldMask()),Yr(o.mutation,e,o.mutation.getFieldMask(),Se.now())):i.set(e.key,Je.empty())})),this.recalculateAndSaveOverlays(t,s).next((t=>(t.forEach(((t,e)=>i.set(t,e))),e.forEach(((t,e)=>{var n;return o.set(t,new yi(e,null!==(n=i.get(t))&&void 0!==n?n:null))})),o)))}recalculateAndSaveOverlays(t,e){const n=Tr();let r=new Ge(((t,e)=>t-e)),s=xr();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next((t=>{for(const s of t)s.keys().forEach((t=>{const i=e.get(t);if(null===i)return;let o=n.get(t)||Je.empty();o=s.applyToLocalView(i,o),n.set(t,o);const a=(r.get(s.batchId)||xr()).add(t);r=r.insert(s.batchId,a)}))})).next((()=>{const i=[],o=r.getReverseIterator();for(;o.hasNext();){const r=o.getNext(),a=r.key,c=r.value,l=Cr();c.forEach((t=>{if(!s.has(t)){const r=Wr(e.get(t),n.get(t));null!==r&&l.set(t,r),s=s.add(t)}})),i.push(this.documentOverlayCache.saveOverlays(t,a,l))}return Fe.waitFor(i)})).next((()=>n))}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next((e=>this.recalculateAndSaveOverlays(t,e)))}getDocumentsMatchingQuery(t,e,n,r){return function(t){return De.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):function(t){return null!==t.collectionGroup}(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,n,r):this.getDocumentsMatchingCollectionQuery(t,e,n,r)}getNextDocuments(t,e,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,n,r).next((s=>{const i=r-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,n.largestBatchId,r-s.size):Fe.resolve(_r());let o=-1,a=s;return i.next((e=>Fe.forEach(e,((e,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),s.get(e)?Fe.resolve():this.remoteDocumentCache.getEntry(t,e).next((t=>{a=a.insert(e,t)}))))).next((()=>this.populateOverlays(t,e,s))).next((()=>this.computeViews(t,a,e,xr()))).next((t=>({batchId:o,changes:Er(t)})))))}))}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new De(e)).next((t=>{let e=wr();return t.isFoundDocument()&&(e=e.insert(t.key,t)),e}))}getDocumentsMatchingCollectionGroupQuery(t,e,n,r){const s=e.collectionGroup;let i=wr();return this.indexManager.getCollectionParents(t,s).next((o=>Fe.forEach(o,(o=>{const a=function(t,e){return new sr(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e,o.child(s));return this.getDocumentsMatchingCollectionQuery(t,a,n,r).next((t=>{t.forEach(((t,e)=>{i=i.insert(t,e)}))}))})).next((()=>i))))}getDocumentsMatchingCollectionQuery(t,e,n,r){let s;return this.documentOverlayCache.getOverlaysForCollection(t,e.path,n.largestBatchId).next((i=>(s=i,this.remoteDocumentCache.getDocumentsMatchingQuery(t,e,n,s,r)))).next((t=>{s.forEach(((e,n)=>{const r=n.getKey();null===t.get(r)&&(t=t.insert(r,Dn.newInvalidDocument(r)))}));let n=wr();return t.forEach(((t,r)=>{const i=s.get(t);void 0!==i&&Yr(i.mutation,r,Je.empty(),Se.now()),fr(e,r)&&(n=n.insert(t,r))})),n}))}}class bi{constructor(t){this.serializer=t,this.Tr=new Map,this.Ir=new Map}getBundleMetadata(t,e){return Fe.resolve(this.Tr.get(e))}saveBundleMetadata(t,e){return this.Tr.set(e.id,function(t){return{id:t.id,version:t.version,createTime:Ls(t.createTime)}}(e)),Fe.resolve()}getNamedQuery(t,e){return Fe.resolve(this.Ir.get(e))}saveNamedQuery(t,e){return this.Ir.set(e.name,function(t){return{name:t.name,query:ii(t.bundledQuery),readTime:Ls(t.readTime)}}(e)),Fe.resolve()}}class wi{constructor(){this.overlays=new Ge(De.comparator),this.Er=new Map}getOverlay(t,e){return Fe.resolve(this.overlays.get(e))}getOverlays(t,e){const n=_r();return Fe.forEach(e,(e=>this.getOverlay(t,e).next((t=>{null!==t&&n.set(e,t)})))).next((()=>n))}saveOverlays(t,e,n){return n.forEach(((n,r)=>{this.Tt(t,e,r)})),Fe.resolve()}removeOverlaysForBatchId(t,e,n){const r=this.Er.get(n);return void 0!==r&&(r.forEach((t=>this.overlays=this.overlays.remove(t))),this.Er.delete(n)),Fe.resolve()}getOverlaysForCollection(t,e,n){const r=_r(),s=e.length+1,i=new De(e.child("")),o=this.overlays.getIteratorFrom(i);for(;o.hasNext();){const t=o.getNext().value,i=t.getKey();if(!e.isPrefixOf(i.path))break;i.path.length===s&&t.largestBatchId>n&&r.set(t.getKey(),t)}return Fe.resolve(r)}getOverlaysForCollectionGroup(t,e,n,r){let s=new Ge(((t,e)=>t-e));const i=this.overlays.getIterator();for(;i.hasNext();){const t=i.getNext().value;if(t.getKey().getCollectionGroup()===e&&t.largestBatchId>n){let e=s.get(t.largestBatchId);null===e&&(e=_r(),s=s.insert(t.largestBatchId,e)),e.set(t.getKey(),t)}}const o=_r(),a=s.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach(((t,e)=>o.set(t,e))),!(o.size()>=r)););return Fe.resolve(o)}Tt(t,e,n){const r=this.overlays.get(n.key);if(null!==r){const t=this.Er.get(r.largestBatchId).delete(n.key);this.Er.set(r.largestBatchId,t)}this.overlays=this.overlays.insert(n.key,new cs(e,n));let s=this.Er.get(e);void 0===s&&(s=xr(),this.Er.set(e,s)),this.Er.set(e,s.add(n.key))}}class Ei{constructor(){this.sessionToken=tn.EMPTY_BYTE_STRING}getSessionToken(t){return Fe.resolve(this.sessionToken)}setSessionToken(t,e){return this.sessionToken=e,Fe.resolve()}}class _i{constructor(){this.dr=new Ye(Ci.Ar),this.Rr=new Ye(Ci.Vr)}isEmpty(){return this.dr.isEmpty()}addReference(t,e){const n=new Ci(t,e);this.dr=this.dr.add(n),this.Rr=this.Rr.add(n)}mr(t,e){t.forEach((t=>this.addReference(t,e)))}removeReference(t,e){this.gr(new Ci(t,e))}pr(t,e){t.forEach((t=>this.removeReference(t,e)))}yr(t){const e=new De(new Ie([])),n=new Ci(e,t),r=new Ci(e,t+1),s=[];return this.Rr.forEachInRange([n,r],(t=>{this.gr(t),s.push(t.key)})),s}wr(){this.dr.forEach((t=>this.gr(t)))}gr(t){this.dr=this.dr.delete(t),this.Rr=this.Rr.delete(t)}Sr(t){const e=new De(new Ie([])),n=new Ci(e,t),r=new Ci(e,t+1);let s=xr();return this.Rr.forEachInRange([n,r],(t=>{s=s.add(t.key)})),s}containsKey(t){const e=new Ci(t,0),n=this.dr.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)}}class Ci{constructor(t,e){this.key=t,this.br=e}static Ar(t,e){return De.comparator(t.key,e.key)||Ce(t.br,e.br)}static Vr(t,e){return Ce(t.br,e.br)||De.comparator(t.key,e.key)}}class Ti{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.Dr=1,this.vr=new Ye(Ci.Ar)}checkEmpty(t){return Fe.resolve(0===this.mutationQueue.length)}addMutationBatch(t,e,n,r){const s=this.Dr;this.Dr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const i=new os(s,e,n,r);this.mutationQueue.push(i);for(const e of r)this.vr=this.vr.add(new Ci(e.key,s)),this.indexManager.addToCollectionParentIndex(t,e.key.path.popLast());return Fe.resolve(i)}lookupMutationBatch(t,e){return Fe.resolve(this.Cr(e))}getNextMutationBatchAfterBatchId(t,e){const n=e+1,r=this.Fr(n),s=r<0?0:r;return Fe.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return Fe.resolve(0===this.mutationQueue.length?-1:this.Dr-1)}getAllMutationBatches(t){return Fe.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){const n=new Ci(e,0),r=new Ci(e,Number.POSITIVE_INFINITY),s=[];return this.vr.forEachInRange([n,r],(t=>{const e=this.Cr(t.br);s.push(e)})),Fe.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new Ye(Ce);return e.forEach((t=>{const e=new Ci(t,0),r=new Ci(t,Number.POSITIVE_INFINITY);this.vr.forEachInRange([e,r],(t=>{n=n.add(t.br)}))})),Fe.resolve(this.Mr(n))}getAllMutationBatchesAffectingQuery(t,e){const n=e.path,r=n.length+1;let s=n;De.isDocumentKey(s)||(s=s.child(""));const i=new Ci(new De(s),0);let o=new Ye(Ce);return this.vr.forEachWhile((t=>{const e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(o=o.add(t.br)),!0)}),i),Fe.resolve(this.Mr(o))}Mr(t){const e=[];return t.forEach((t=>{const n=this.Cr(t);null!==n&&e.push(n)})),e}removeMutationBatch(t,e){ce(0===this.Or(e.batchId,"removed")),this.mutationQueue.shift();let n=this.vr;return Fe.forEach(e.mutations,(r=>{const s=new Ci(r.key,e.batchId);return n=n.delete(s),this.referenceDelegate.markPotentiallyOrphaned(t,r.key)})).next((()=>{this.vr=n}))}Ln(t){}containsKey(t,e){const n=new Ci(e,0),r=this.vr.firstAfterOrEqual(n);return Fe.resolve(e.isEqual(r&&r.key))}performConsistencyCheck(t){return this.mutationQueue.length,Fe.resolve()}Or(t,e){return this.Fr(t)}Fr(t){return 0===this.mutationQueue.length?0:t-this.mutationQueue[0].batchId}Cr(t){const e=this.Fr(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}}class Si{constructor(t){this.Nr=t,this.docs=new Ge(De.comparator),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){const n=e.key,r=this.docs.get(n),s=r?r.size:0,i=this.Nr(e);return this.docs=this.docs.insert(n,{document:e.mutableCopy(),size:i}),this.size+=i-s,this.indexManager.addToCollectionParentIndex(t,n.path.popLast())}removeEntry(t){const e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){const n=this.docs.get(e);return Fe.resolve(n?n.document.mutableCopy():Dn.newInvalidDocument(e))}getEntries(t,e){let n=vr();return e.forEach((t=>{const e=this.docs.get(t);n=n.insert(t,e?e.document.mutableCopy():Dn.newInvalidDocument(t))})),Fe.resolve(n)}getDocumentsMatchingQuery(t,e,n,r){let s=vr();const i=e.path,o=new De(i.child("")),a=this.docs.getIteratorFrom(o);for(;a.hasNext();){const{key:t,value:{document:o}}=a.getNext();if(!i.isPrefixOf(t.path))break;t.path.length>i.length+1||Pe(Ne(o),n)<=0||(r.has(o.key)||fr(e,o))&&(s=s.insert(o.key,o.mutableCopy()))}return Fe.resolve(s)}getAllFromCollectionGroup(t,e,n,r){ae()}Lr(t,e){return Fe.forEach(this.docs,(t=>e(t)))}newChangeBuffer(t){return new ki(this)}getSize(t){return Fe.resolve(this.size)}}class ki extends mi{constructor(t){super(),this.hr=t}applyChanges(t){const e=[];return this.changes.forEach(((n,r)=>{r.isValidDocument()?e.push(this.hr.addEntry(t,r)):this.hr.removeEntry(n)})),Fe.waitFor(e)}getFromCache(t,e){return this.hr.getEntry(t,e)}getAllFromCache(t,e){return this.hr.getEntries(t,e)}}class xi{constructor(t){this.persistence=t,this.Br=new mr((t=>er(t)),nr),this.lastRemoteSnapshotVersion=ke.min(),this.highestTargetId=0,this.kr=0,this.qr=new _i,this.targetCount=0,this.Qr=hi.qn()}forEachTarget(t,e){return this.Br.forEach(((t,n)=>e(n))),Fe.resolve()}getLastRemoteSnapshotVersion(t){return Fe.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return Fe.resolve(this.kr)}allocateTargetId(t){return this.highestTargetId=this.Qr.next(),Fe.resolve(this.highestTargetId)}setTargetsMetadata(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.kr&&(this.kr=e),Fe.resolve()}Un(t){this.Br.set(t.target,t);const e=t.targetId;e>this.highestTargetId&&(this.Qr=new hi(e),this.highestTargetId=e),t.sequenceNumber>this.kr&&(this.kr=t.sequenceNumber)}addTargetData(t,e){return this.Un(e),this.targetCount+=1,Fe.resolve()}updateTargetData(t,e){return this.Un(e),Fe.resolve()}removeTargetData(t,e){return this.Br.delete(e.target),this.qr.yr(e.targetId),this.targetCount-=1,Fe.resolve()}removeTargets(t,e,n){let r=0;const s=[];return this.Br.forEach(((i,o)=>{o.sequenceNumber<=e&&null===n.get(o.targetId)&&(this.Br.delete(i),s.push(this.removeMatchingKeysForTargetId(t,o.targetId)),r++)})),Fe.waitFor(s).next((()=>r))}getTargetCount(t){return Fe.resolve(this.targetCount)}getTargetData(t,e){const n=this.Br.get(e)||null;return Fe.resolve(n)}addMatchingKeys(t,e,n){return this.qr.mr(e,n),Fe.resolve()}removeMatchingKeys(t,e,n){this.qr.pr(e,n);const r=this.persistence.referenceDelegate,s=[];return r&&e.forEach((e=>{s.push(r.markPotentiallyOrphaned(t,e))})),Fe.waitFor(s)}removeMatchingKeysForTargetId(t,e){return this.qr.yr(e),Fe.resolve()}getMatchingKeysForTargetId(t,e){const n=this.qr.Sr(e);return Fe.resolve(n)}containsKey(t,e){return Fe.resolve(this.qr.containsKey(e))}}class Ii{constructor(t,e){this.Kr={},this.overlays={},this.$r=new Be(0),this.Ur=!1,this.Ur=!0,this.Wr=new Ei,this.referenceDelegate=t(this),this.Gr=new xi(this),this.indexManager=new ai,this.remoteDocumentCache=function(t){return new Si(t)}((t=>this.referenceDelegate.zr(t))),this.serializer=new si(e),this.jr=new bi(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Ur=!1,Promise.resolve()}get started(){return this.Ur}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new wi,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let n=this.Kr[t.toKey()];return n||(n=new Ti(e,this.referenceDelegate),this.Kr[t.toKey()]=n),n}getGlobalsCache(){return this.Wr}getTargetCache(){return this.Gr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.jr}runTransaction(t,e,n){re("MemoryPersistence","Starting transaction:",t);const r=new Ai(this.$r.next());return this.referenceDelegate.Hr(),n(r).next((t=>this.referenceDelegate.Jr(r).next((()=>t)))).toPromise().then((t=>(r.raiseOnCommittedEvent(),t)))}Yr(t,e){return Fe.or(Object.values(this.Kr).map((n=>()=>n.containsKey(t,e))))}}class Ai extends Le{constructor(t){super(),this.currentSequenceNumber=t}}class Ri{constructor(t){this.persistence=t,this.Zr=new _i,this.Xr=null}static ei(t){return new Ri(t)}get ti(){if(this.Xr)return this.Xr;throw ae()}addReference(t,e,n){return this.Zr.addReference(n,e),this.ti.delete(n.toString()),Fe.resolve()}removeReference(t,e,n){return this.Zr.removeReference(n,e),this.ti.add(n.toString()),Fe.resolve()}markPotentiallyOrphaned(t,e){return this.ti.add(e.toString()),Fe.resolve()}removeTarget(t,e){this.Zr.yr(e.targetId).forEach((t=>this.ti.add(t.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(t,e.targetId).next((t=>{t.forEach((t=>this.ti.add(t.toString())))})).next((()=>n.removeTargetData(t,e)))}Hr(){this.Xr=new Set}Jr(t){const e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Fe.forEach(this.ti,(n=>{const r=De.fromPath(n);return this.ni(t,r).next((t=>{t||e.removeEntry(r,ke.min())}))})).next((()=>(this.Xr=null,e.apply(t))))}updateLimboDocument(t,e){return this.ni(t,e).next((t=>{t?this.ti.delete(e.toString()):this.ti.add(e.toString())}))}zr(t){return 0}ni(t,e){return Fe.or([()=>Fe.resolve(this.Zr.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Yr(t,e)])}}class Di{constructor(t,e){this.persistence=t,this.ri=new mr((t=>function(t){let e="";for(let n=0;n<t.length;n++)e.length>0&&(e=$e(e)),e=je(t.get(n),e);return $e(e)}(t.path)),((t,e)=>t.isEqual(e))),this.garbageCollector=function(t,e){return new gi(t,e)}(this,e)}static ei(t,e){return new Di(t,e)}Hr(){}Jr(t){return Fe.resolve()}forEachTarget(t,e){return this.persistence.getTargetCache().forEachTarget(t,e)}Xn(t){const e=this.nr(t);return this.persistence.getTargetCache().getTargetCount(t).next((t=>e.next((e=>t+e))))}nr(t){let e=0;return this.er(t,(t=>{e++})).next((()=>e))}er(t,e){return Fe.forEach(this.ri,((n,r)=>this.ir(t,n,r).next((t=>t?Fe.resolve():e(r)))))}removeTargets(t,e,n){return this.persistence.getTargetCache().removeTargets(t,e,n)}removeOrphanedDocuments(t,e){let n=0;const r=this.persistence.getRemoteDocumentCache(),s=r.newChangeBuffer();return r.Lr(t,(r=>this.ir(t,r,e).next((t=>{t||(n++,s.removeEntry(r,ke.min()))})))).next((()=>s.apply(t))).next((()=>n))}markPotentiallyOrphaned(t,e){return this.ri.set(e,t.currentSequenceNumber),Fe.resolve()}removeTarget(t,e){const n=e.withSequenceNumber(t.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(t,n)}addReference(t,e,n){return this.ri.set(n,t.currentSequenceNumber),Fe.resolve()}removeReference(t,e,n){return this.ri.set(n,t.currentSequenceNumber),Fe.resolve()}updateLimboDocument(t,e){return this.ri.set(e,t.currentSequenceNumber),Fe.resolve()}zr(t){let e=t.key.toString().length;return t.isFoundDocument()&&(e+=wn(t.data.value)),e}ir(t,e,n){return Fe.or([()=>this.persistence.Yr(t,e),()=>this.persistence.getTargetCache().containsKey(t,e),()=>{const t=this.ri.get(e);return Fe.resolve(void 0!==t&&t>n)}])}getCacheSize(t){return this.persistence.getRemoteDocumentCache().getSize(t)}}class Ni{constructor(t,e,n,r){this.targetId=t,this.fromCache=e,this.Wi=n,this.Gi=r}static zi(t,e){let n=xr(),r=xr();for(const t of e.docChanges)switch(t.type){case 0:n=n.add(t.doc.key);break;case 1:r=r.add(t.doc.key)}return new Ni(t,e.fromCache,n,r)}}class Oi{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}}class Pi{constructor(){this.ji=!1,this.Hi=!1,this.Ji=100,this.Yi=!function(){var e;const n=null===(e=o())||void 0===e?void 0:e.forceEnvironment;if("node"===n)return!0;if("browser"===n)return!1;try{return"[object process]"===Object.prototype.toString.call(t.g.process)}catch(t){return!1}}()&&navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")?8:function(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}("undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:"")>0?6:4}initialize(t,e){this.Zi=t,this.indexManager=e,this.ji=!0}getDocumentsMatchingQuery(t,e,n,r){const s={result:null};return this.Xi(t,e).next((t=>{s.result=t})).next((()=>{if(!s.result)return this.es(t,e,r,n).next((t=>{s.result=t}))})).next((()=>{if(s.result)return;const n=new Oi;return this.ts(t,e,n).next((r=>{if(s.result=r,this.Hi)return this.ns(t,e,n,r.size)}))})).next((()=>s.result))}ns(t,e,n,r){return n.documentReadCount<this.Ji?(ne()<=w.DEBUG&&re("QueryEngine","SDK will not create cache indexes for query:",dr(e),"since it only creates cache indexes for collection contains","more than or equal to",this.Ji,"documents"),Fe.resolve()):(ne()<=w.DEBUG&&re("QueryEngine","Query:",dr(e),"scans",n.documentReadCount,"local documents and returns",r,"documents as results."),n.documentReadCount>this.Yi*r?(ne()<=w.DEBUG&&re("QueryEngine","The SDK decides to create cache indexes for query:",dr(e),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,cr(e))):Fe.resolve())}Xi(t,e){if(or(e))return Fe.resolve(null);let n=cr(e);return this.indexManager.getIndexType(t,n).next((r=>0===r?null:(null!==e.limit&&1===r&&(e=lr(e,null,"F"),n=cr(e)),this.indexManager.getDocumentsMatchingTarget(t,n).next((r=>{const s=xr(...r);return this.Zi.getDocuments(t,s).next((r=>this.indexManager.getMinOffset(t,n).next((n=>{const i=this.rs(e,r);return this.ss(e,i,s,n.readTime)?this.Xi(t,lr(e,null,"F")):this.os(t,i,e,n)}))))})))))}es(t,e,n,r){return or(e)||r.isEqual(ke.min())?Fe.resolve(null):this.Zi.getDocuments(t,n).next((s=>{const i=this.rs(e,s);return this.ss(e,i,n,r)?Fe.resolve(null):(ne()<=w.DEBUG&&re("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),dr(e)),this.os(t,i,e,function(t,e){const n=t.toTimestamp().seconds,r=t.toTimestamp().nanoseconds+1,s=ke.fromTimestamp(1e9===r?new Se(n+1,0):new Se(n,r));return new Oe(s,De.empty(),e)}(r,-1)).next((t=>t)))}))}rs(t,e){let n=new Ye(pr(t));return e.forEach(((e,r)=>{fr(t,r)&&(n=n.add(r))})),n}ss(t,e,n,r){if(null===t.limit)return!1;if(n.size!==e.size)return!0;const s="F"===t.limitType?e.last():e.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(r)>0)}ts(t,e,n){return ne()<=w.DEBUG&&re("QueryEngine","Using full collection scan to execute query:",dr(e)),this.Zi.getDocumentsMatchingQuery(t,e,Oe.min(),n)}os(t,e,n,r){return this.Zi.getDocumentsMatchingQuery(t,n,r).next((t=>(e.forEach((e=>{t=t.insert(e.key,e)})),t)))}}class Li{constructor(t,e,n,r){this.persistence=t,this._s=e,this.serializer=r,this.us=new Ge(Ce),this.cs=new mr((t=>er(t)),nr),this.ls=new Map,this.hs=t.getRemoteDocumentCache(),this.Gr=t.getTargetCache(),this.jr=t.getBundleCache(),this.Ps(n)}Ps(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new vi(this.hs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.hs.setIndexManager(this.indexManager),this._s.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(e=>t.collect(e,this.us)))}}async function Mi(t,e){const n=le(t);return await n.persistence.runTransaction("Handle user change","readonly",(t=>{let r;return n.mutationQueue.getAllMutationBatches(t).next((s=>(r=s,n.Ps(e),n.mutationQueue.getAllMutationBatches(t)))).next((e=>{const s=[],i=[];let o=xr();for(const t of r){s.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}for(const t of e){i.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}return n.localDocuments.getDocuments(t,o).next((t=>({Ts:t,removedBatchIds:s,addedBatchIds:i})))}))}))}function Fi(t){const e=le(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.Gr.getLastRemoteSnapshotVersion(t)))}function Ui(t,e){const n=le(t);return n.persistence.runTransaction("Get next mutation batch","readonly",(t=>(void 0===e&&(e=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(t,e))))}async function Bi(t,e,n){const r=le(t),s=r.us.get(e),i=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",i,(t=>r.persistence.referenceDelegate.removeTarget(t,s)))}catch(t){if(!Ue(t))throw t;re("LocalStore",`Failed to update sequence numbers for target ${e}: ${t}`)}r.us=r.us.remove(e),r.cs.delete(s.target)}function Vi(t,e,n){const r=le(t);let s=ke.min(),i=xr();return r.persistence.runTransaction("Execute query","readwrite",(t=>function(t,e,n){const r=le(t),s=r.cs.get(n);return void 0!==s?Fe.resolve(r.us.get(s)):r.Gr.getTargetData(e,n)}(r,t,cr(e)).next((e=>{if(e)return s=e.lastLimboFreeSnapshotVersion,r.Gr.getMatchingKeysForTargetId(t,e.targetId).next((t=>{i=t}))})).next((()=>r._s.getDocumentsMatchingQuery(t,e,n?s:ke.min(),n?i:xr()))).next((t=>(function(t,e,n){let r=t.ls.get(e)||ke.min();n.forEach(((t,e)=>{e.readTime.compareTo(r)>0&&(r=e.readTime)})),t.ls.set(e,r)}(r,function(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}(e),t),{documents:t,ds:i})))))}class qi{constructor(){this.activeTargetIds=Ir}ps(t){this.activeTargetIds=this.activeTargetIds.add(t)}ys(t){this.activeTargetIds=this.activeTargetIds.delete(t)}gs(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class ji{constructor(){this._o=new qi,this.ao={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,n){}addLocalQueryTarget(t,e=!0){return e&&this._o.ps(t),this.ao[t]||"not-current"}updateQueryState(t,e,n){this.ao[t]=e}removeLocalQueryTarget(t){this._o.ys(t)}isLocalQueryTarget(t){return this._o.activeTargetIds.has(t)}clearQueryState(t){delete this.ao[t]}getAllActiveQueryTargets(){return this._o.activeTargetIds}isActiveQueryTarget(t){return this._o.activeTargetIds.has(t)}start(){return this._o=new qi,Promise.resolve()}handleUserChange(t,e,n){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}}class $i{uo(t){}shutdown(){}}class zi{constructor(){this.co=()=>this.lo(),this.ho=()=>this.Po(),this.To=[],this.Io()}uo(t){this.To.push(t)}shutdown(){window.removeEventListener("online",this.co),window.removeEventListener("offline",this.ho)}Io(){window.addEventListener("online",this.co),window.addEventListener("offline",this.ho)}lo(){re("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const t of this.To)t(0)}Po(){re("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const t of this.To)t(1)}static p(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let Ki=null;function Hi(){return null===Ki?Ki=268435456+Math.round(2147483648*Math.random()):Ki++,"0x"+Ki.toString(16)}const Gi={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class Wi{constructor(t){this.Eo=t.Eo,this.Ao=t.Ao}Ro(t){this.Vo=t}mo(t){this.fo=t}po(t){this.yo=t}onMessage(t){this.wo=t}close(){this.Ao()}send(t){this.Eo(t)}So(){this.Vo()}bo(){this.fo()}Do(t){this.yo(t)}vo(t){this.wo(t)}}const Qi="WebChannelConnection";class Yi extends class{get Co(){return!1}constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const e=t.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.Fo=e+"://"+t.host,this.Mo=`projects/${n}/databases/${r}`,this.xo="(default)"===this.databaseId.database?`project_id=${n}`:`project_id=${n}&database_id=${r}`}Oo(t,e,n,r,s){const i=Hi(),o=this.No(t,e.toUriEncodedString());re("RestConnection",`Sending RPC '${t}' ${i}:`,o,n);const a={"google-cloud-resource-prefix":this.Mo,"x-goog-request-params":this.xo};return this.Lo(a,r,s),this.Bo(t,o,a,n).then((e=>(re("RestConnection",`Received RPC '${t}' ${i}: `,e),e)),(e=>{throw ie("RestConnection",`RPC '${t}' ${i} failed with error: `,e,"url: ",o,"request:",n),e}))}ko(t,e,n,r,s,i){return this.Oo(t,e,n,r,s)}Lo(t,e,n){t["X-Goog-Api-Client"]="gl-js/ fire/"+te,t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach(((e,n)=>t[n]=e)),n&&n.headers.forEach(((e,n)=>t[n]=e))}No(t,e){const n=Gi[t];return`${this.Fo}/v1/${e}:${n}`}terminate(){}}{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}Bo(t,e,n,r){const s=Hi();return new Promise(((i,o)=>{const a=new jt;a.setWithCredentials(!0),a.listenOnce(zt.COMPLETE,(()=>{try{switch(a.getLastErrorCode()){case Kt.NO_ERROR:const e=a.getResponseJson();re(Qi,`XHR for RPC '${t}' ${s} received:`,JSON.stringify(e)),i(e);break;case Kt.TIMEOUT:re(Qi,`RPC '${t}' ${s} timed out`),o(new he(ue.DEADLINE_EXCEEDED,"Request time out"));break;case Kt.HTTP_ERROR:const n=a.getStatus();if(re(Qi,`RPC '${t}' ${s} failed with status:`,n,"response text:",a.getResponseText()),n>0){let t=a.getResponseJson();Array.isArray(t)&&(t=t[0]);const e=null==t?void 0:t.error;if(e&&e.status&&e.message){const t=function(t){const e=t.toLowerCase().replace(/_/g,"-");return Object.values(ue).indexOf(e)>=0?e:ue.UNKNOWN}(e.status);o(new he(t,e.message))}else o(new he(ue.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new he(ue.UNAVAILABLE,"Connection failed."));break;default:ae()}}finally{re(Qi,`RPC '${t}' ${s} completed.`)}}));const c=JSON.stringify(r);re(Qi,`RPC '${t}' ${s} sending request:`,r),a.send(e,"POST",c,n,15)}))}qo(t,e,n){const r=Hi(),s=[this.Fo,"/","google.firestore.v1.Firestore","/",t,"/channel"],i=Qt(),o=Wt(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;void 0!==c&&(a.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(a.useFetchStreams=!0),this.Lo(a.initMessageHeaders,e,n),a.encodeInitMessageHeaders=!0;const l=s.join("");re(Qi,`Creating RPC '${t}' stream ${r}: ${l}`,a);const u=i.createWebChannel(l,a);let h=!1,d=!1;const f=new Wi({Eo:e=>{d?re(Qi,`Not sending because RPC '${t}' stream ${r} is closed:`,e):(h||(re(Qi,`Opening RPC '${t}' stream ${r} transport.`),u.open(),h=!0),re(Qi,`RPC '${t}' stream ${r} sending:`,e),u.send(e))},Ao:()=>u.close()}),p=(t,e,n)=>{t.listen(e,(t=>{try{n(t)}catch(t){setTimeout((()=>{throw t}),0)}}))};return p(u,$t.EventType.OPEN,(()=>{d||(re(Qi,`RPC '${t}' stream ${r} transport opened.`),f.So())})),p(u,$t.EventType.CLOSE,(()=>{d||(d=!0,re(Qi,`RPC '${t}' stream ${r} transport closed`),f.Do())})),p(u,$t.EventType.ERROR,(e=>{d||(d=!0,ie(Qi,`RPC '${t}' stream ${r} transport errored:`,e),f.Do(new he(ue.UNAVAILABLE,"The operation could not be completed")))})),p(u,$t.EventType.MESSAGE,(e=>{var n;if(!d){const s=e.data[0];ce(!!s);const i=s,o=(null==i?void 0:i.error)||(null===(n=i[0])||void 0===n?void 0:n.error);if(o){re(Qi,`RPC '${t}' stream ${r} received error:`,o);const e=o.status;let n=function(t){const e=us[t];if(void 0!==e)return ds(e)}(e),s=o.message;void 0===n&&(n=ue.INTERNAL,s="Unknown error status: "+e+" with message "+o.message),d=!0,f.Do(new he(n,s)),u.close()}else re(Qi,`RPC '${t}' stream ${r} received:`,s),f.vo(s)}})),p(o,Gt.STAT_EVENT,(e=>{e.stat===Ht.PROXY?re(Qi,`RPC '${t}' stream ${r} detected buffering proxy`):e.stat===Ht.NOPROXY&&re(Qi,`RPC '${t}' stream ${r} detected no buffering proxy`)})),setTimeout((()=>{f.bo()}),0),f}}function Xi(){return"undefined"!=typeof document?document:null}function Ji(t){return new Rs(t,!0)}class Zi{constructor(t,e,n=1e3,r=1.5,s=6e4){this.li=t,this.timerId=e,this.Qo=n,this.Ko=r,this.$o=s,this.Uo=0,this.Wo=null,this.Go=Date.now(),this.reset()}reset(){this.Uo=0}zo(){this.Uo=this.$o}jo(t){this.cancel();const e=Math.floor(this.Uo+this.Ho()),n=Math.max(0,Date.now()-this.Go),r=Math.max(0,e-n);r>0&&re("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.Uo} ms, delay with jitter: ${e} ms, last attempt: ${n} ms ago)`),this.Wo=this.li.enqueueAfterDelay(this.timerId,r,(()=>(this.Go=Date.now(),t()))),this.Uo*=this.Ko,this.Uo<this.Qo&&(this.Uo=this.Qo),this.Uo>this.$o&&(this.Uo=this.$o)}Jo(){null!==this.Wo&&(this.Wo.skipDelay(),this.Wo=null)}cancel(){null!==this.Wo&&(this.Wo.cancel(),this.Wo=null)}Ho(){return(Math.random()-.5)*this.Uo}}class to{constructor(t,e,n,r,s,i,o,a){this.li=t,this.Yo=n,this.Zo=r,this.connection=s,this.authCredentialsProvider=i,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.Xo=0,this.e_=null,this.t_=null,this.stream=null,this.n_=0,this.r_=new Zi(t,e)}i_(){return 1===this.state||5===this.state||this.s_()}s_(){return 2===this.state||3===this.state}start(){this.n_=0,4!==this.state?this.auth():this.o_()}async stop(){this.i_()&&await this.close(0)}__(){this.state=0,this.r_.reset()}a_(){this.s_()&&null===this.e_&&(this.e_=this.li.enqueueAfterDelay(this.Yo,6e4,(()=>this.u_())))}c_(t){this.l_(),this.stream.send(t)}async u_(){if(this.s_())return this.close(0)}l_(){this.e_&&(this.e_.cancel(),this.e_=null)}h_(){this.t_&&(this.t_.cancel(),this.t_=null)}async close(t,e){this.l_(),this.h_(),this.r_.cancel(),this.Xo++,4!==t?this.r_.reset():e&&e.code===ue.RESOURCE_EXHAUSTED?(se(e.toString()),se("Using maximum backoff delay to prevent overloading the backend."),this.r_.zo()):e&&e.code===ue.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.P_(),this.stream.close(),this.stream=null),this.state=t,await this.listener.po(e)}P_(){}auth(){this.state=1;const t=this.T_(this.Xo),e=this.Xo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([t,n])=>{this.Xo===e&&this.I_(t,n)}),(e=>{t((()=>{const t=new he(ue.UNKNOWN,"Fetching auth token failed: "+e.message);return this.E_(t)}))}))}I_(t,e){const n=this.T_(this.Xo);this.stream=this.d_(t,e),this.stream.Ro((()=>{n((()=>this.listener.Ro()))})),this.stream.mo((()=>{n((()=>(this.state=2,this.t_=this.li.enqueueAfterDelay(this.Zo,1e4,(()=>(this.s_()&&(this.state=3),Promise.resolve()))),this.listener.mo())))})),this.stream.po((t=>{n((()=>this.E_(t)))})),this.stream.onMessage((t=>{n((()=>1==++this.n_?this.A_(t):this.onNext(t)))}))}o_(){this.state=5,this.r_.jo((async()=>{this.state=0,this.start()}))}E_(t){return re("PersistentStream",`close with error: ${t}`),this.stream=null,this.close(4,t)}T_(t){return e=>{this.li.enqueueAndForget((()=>this.Xo===t?e():(re("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class eo extends to{constructor(t,e,n,r,s,i){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,n,r,i),this.serializer=s}d_(t,e){return this.connection.qo("Listen",t,e)}A_(t){return this.onNext(t)}onNext(t){this.r_.reset();const e=function(t,e){let n;if("targetChange"in e){e.targetChange;const r=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:ae()}(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],i=function(t,e){return t.useProto3Json?(ce(void 0===e||"string"==typeof e),tn.fromBase64String(e||"")):(ce(void 0===e||e instanceof Buffer||e instanceof Uint8Array),tn.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(t){const e=void 0===t.code?ue.UNKNOWN:ds(t.code);return new he(e,t.message||"")}(o);n=new _s(r,s,i,a||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=Vs(t,r.document.name),i=Ls(r.document.updateTime),o=r.document.createTime?Ls(r.document.createTime):ke.min(),a=new An({mapValue:{fields:r.document.fields}}),c=Dn.newFoundDocument(s,i,o,a),l=r.targetIds||[],u=r.removedTargetIds||[];n=new ws(l,u,c.key,c)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=Vs(t,r.document),i=r.readTime?Ls(r.readTime):ke.min(),o=Dn.newNoDocument(s,i),a=r.removedTargetIds||[];n=new ws([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=Vs(t,r.document),i=r.removedTargetIds||[];n=new ws([],i,s,null)}else{if(!("filter"in e))return ae();{e.filter;const t=e.filter;t.targetId;const{count:r=0,unchangedNames:s}=t,i=new ls(r,s),o=t.targetId;n=new Es(o,i)}}return n}(this.serializer,t),n=function(t){if(!("targetChange"in t))return ke.min();const e=t.targetChange;return e.targetIds&&e.targetIds.length?ke.min():e.readTime?Ls(e.readTime):ke.min()}(t);return this.listener.R_(e,n)}V_(t){const e={};e.database=js(this.serializer),e.addTarget=function(t,e){let n;const r=e.target;if(n=rr(r)?{documents:Ks(t,r)}:{query:Hs(t,r).ct},n.targetId=e.targetId,e.resumeToken.approximateByteSize()>0){n.resumeToken=Os(t,e.resumeToken);const r=Ds(t,e.expectedCount);null!==r&&(n.expectedCount=r)}else if(e.snapshotVersion.compareTo(ke.min())>0){n.readTime=Ns(t,e.snapshotVersion.toTimestamp());const r=Ds(t,e.expectedCount);null!==r&&(n.expectedCount=r)}return n}(this.serializer,t);const n=function(t,e){const n=function(t){switch(t){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return ae()}}(e.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,t);n&&(e.labels=n),this.c_(e)}m_(t){const e={};e.database=js(this.serializer),e.removeTarget=t,this.c_(e)}}class no extends to{constructor(t,e,n,r,s,i){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",e,n,r,i),this.serializer=s}get f_(){return this.n_>0}start(){this.lastStreamToken=void 0,super.start()}P_(){this.f_&&this.g_([])}d_(t,e){return this.connection.qo("Write",t,e)}A_(t){return ce(!!t.streamToken),this.lastStreamToken=t.streamToken,ce(!t.writeResults||0===t.writeResults.length),this.listener.p_()}onNext(t){ce(!!t.streamToken),this.lastStreamToken=t.streamToken,this.r_.reset();const e=function(t,e){return t&&t.length>0?(ce(void 0!==e),t.map((t=>function(t,e){let n=t.updateTime?Ls(t.updateTime):Ls(e);return n.isEqual(ke.min())&&(n=Ls(e)),new zr(n,t.transformResults||[])}(t,e)))):[]}(t.writeResults,t.commitTime),n=Ls(t.commitTime);return this.listener.y_(n,e)}w_(){const t={};t.database=js(this.serializer),this.c_(t)}g_(t){const e={streamToken:this.lastStreamToken,writes:t.map((t=>function(t,e){let n;if(e instanceof Zr)n={update:zs(t,e.key,e.value)};else if(e instanceof ss)n={delete:Bs(t,e.key)};else if(e instanceof ts)n={update:zs(t,e.key,e.data),updateMask:ei(e.fieldMask)};else{if(!(e instanceof is))return ae();n={verify:Bs(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map((t=>function(t,e){const n=e.transform;if(n instanceof Mr)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof Fr)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof Br)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof qr)return{fieldPath:e.field.canonicalString(),increment:n.Pe};throw ae()}(0,t)))),e.precondition.isNone||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:Ps(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:ae()}(t,e.precondition)),n}(this.serializer,t)))};this.c_(e)}}class ro extends class{}{constructor(t,e,n,r){super(),this.authCredentials=t,this.appCheckCredentials=e,this.connection=n,this.serializer=r,this.S_=!1}b_(){if(this.S_)throw new he(ue.FAILED_PRECONDITION,"The client has already been terminated.")}Oo(t,e,n,r){return this.b_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([s,i])=>this.connection.Oo(t,Fs(e,n),r,s,i))).catch((t=>{throw"FirebaseError"===t.name?(t.code===ue.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new he(ue.UNKNOWN,t.toString())}))}ko(t,e,n,r,s){return this.b_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([i,o])=>this.connection.ko(t,Fs(e,n),r,i,o,s))).catch((t=>{throw"FirebaseError"===t.name?(t.code===ue.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new he(ue.UNKNOWN,t.toString())}))}terminate(){this.S_=!0,this.connection.terminate()}}class so{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.D_=0,this.v_=null,this.C_=!0}F_(){0===this.D_&&(this.M_("Unknown"),this.v_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this.v_=null,this.x_("Backend didn't respond within 10 seconds."),this.M_("Offline"),Promise.resolve()))))}O_(t){"Online"===this.state?this.M_("Unknown"):(this.D_++,this.D_>=1&&(this.N_(),this.x_(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.M_("Offline")))}set(t){this.N_(),this.D_=0,"Online"===t&&(this.C_=!1),this.M_(t)}M_(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}x_(t){const e=`Could not reach Cloud Firestore backend. ${t}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.C_?(se(e),this.C_=!1):re("OnlineStateTracker",e)}N_(){null!==this.v_&&(this.v_.cancel(),this.v_=null)}}class io{constructor(t,e,n,r,s){this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.L_=[],this.B_=new Map,this.k_=new Set,this.q_=[],this.Q_=s,this.Q_.uo((t=>{n.enqueueAndForget((async()=>{go(this)&&(re("RemoteStore","Restarting streams for network reachability change."),await async function(t){const e=le(t);e.k_.add(4),await ao(e),e.K_.set("Unknown"),e.k_.delete(4),await oo(e)}(this))}))})),this.K_=new so(n,r)}}async function oo(t){if(go(t))for(const e of t.q_)await e(!0)}async function ao(t){for(const e of t.q_)await e(!1)}function co(t,e){const n=le(t);n.B_.has(e.targetId)||(n.B_.set(e.targetId,e),po(n)?fo(n):Oo(n).s_()&&uo(n,e))}function lo(t,e){const n=le(t),r=Oo(n);n.B_.delete(e),r.s_()&&ho(n,e),0===n.B_.size&&(r.s_()?r.a_():go(n)&&n.K_.set("Unknown"))}function uo(t,e){if(t.U_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(ke.min())>0){const n=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(n)}Oo(t).V_(e)}function ho(t,e){t.U_.xe(e),Oo(t).m_(e)}function fo(t){t.U_=new Ts({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),ut:e=>t.B_.get(e)||null,nt:()=>t.datastore.serializer.databaseId}),Oo(t).start(),t.K_.F_()}function po(t){return go(t)&&!Oo(t).i_()&&t.B_.size>0}function go(t){return 0===le(t).k_.size}function mo(t){t.U_=void 0}async function yo(t){t.K_.set("Online")}async function vo(t){t.B_.forEach(((e,n)=>{uo(t,e)}))}async function bo(t,e){mo(t),po(t)?(t.K_.O_(e),fo(t)):t.K_.set("Unknown")}async function wo(t,e,n){if(t.K_.set("Online"),e instanceof _s&&2===e.state&&e.cause)try{await async function(t,e){const n=e.cause;for(const r of e.targetIds)t.B_.has(r)&&(await t.remoteSyncer.rejectListen(r,n),t.B_.delete(r),t.U_.removeTarget(r))}(t,e)}catch(n){re("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),n),await Eo(t,n)}else if(e instanceof ws?t.U_.$e(e):e instanceof Es?t.U_.Je(e):t.U_.Ge(e),!n.isEqual(ke.min()))try{const e=await Fi(t.localStore);n.compareTo(e)>=0&&await function(t,e){const n=t.U_.it(e);return n.targetChanges.forEach(((n,r)=>{if(n.resumeToken.approximateByteSize()>0){const s=t.B_.get(r);s&&t.B_.set(r,s.withResumeToken(n.resumeToken,e))}})),n.targetMismatches.forEach(((e,n)=>{const r=t.B_.get(e);if(!r)return;t.B_.set(e,r.withResumeToken(tn.EMPTY_BYTE_STRING,r.snapshotVersion)),ho(t,e);const s=new ri(r.target,e,n,r.sequenceNumber);uo(t,s)})),t.remoteSyncer.applyRemoteEvent(n)}(t,n)}catch(e){re("RemoteStore","Failed to raise snapshot:",e),await Eo(t,e)}}async function Eo(t,e,n){if(!Ue(e))throw e;t.k_.add(1),await ao(t),t.K_.set("Offline"),n||(n=()=>Fi(t.localStore)),t.asyncQueue.enqueueRetryable((async()=>{re("RemoteStore","Retrying IndexedDB access"),await n(),t.k_.delete(1),await oo(t)}))}function _o(t,e){return e().catch((n=>Eo(t,n,e)))}async function Co(t){const e=le(t),n=Po(e);let r=e.L_.length>0?e.L_[e.L_.length-1].batchId:-1;for(;To(e);)try{const t=await Ui(e.localStore,r);if(null===t){0===e.L_.length&&n.a_();break}r=t.batchId,So(e,t)}catch(t){await Eo(e,t)}ko(e)&&xo(e)}function To(t){return go(t)&&t.L_.length<10}function So(t,e){t.L_.push(e);const n=Po(t);n.s_()&&n.f_&&n.g_(e.mutations)}function ko(t){return go(t)&&!Po(t).i_()&&t.L_.length>0}function xo(t){Po(t).start()}async function Io(t){Po(t).w_()}async function Ao(t){const e=Po(t);for(const n of t.L_)e.g_(n.mutations)}async function Ro(t,e,n){const r=t.L_.shift(),s=as.from(r,e,n);await _o(t,(()=>t.remoteSyncer.applySuccessfulWrite(s))),await Co(t)}async function Do(t,e){e&&Po(t).f_&&await async function(t,e){if(function(t){return function(t){switch(t){default:return ae();case ue.CANCELLED:case ue.UNKNOWN:case ue.DEADLINE_EXCEEDED:case ue.RESOURCE_EXHAUSTED:case ue.INTERNAL:case ue.UNAVAILABLE:case ue.UNAUTHENTICATED:return!1;case ue.INVALID_ARGUMENT:case ue.NOT_FOUND:case ue.ALREADY_EXISTS:case ue.PERMISSION_DENIED:case ue.FAILED_PRECONDITION:case ue.ABORTED:case ue.OUT_OF_RANGE:case ue.UNIMPLEMENTED:case ue.DATA_LOSS:return!0}}(t)&&t!==ue.ABORTED}(e.code)){const n=t.L_.shift();Po(t).__(),await _o(t,(()=>t.remoteSyncer.rejectFailedWrite(n.batchId,e))),await Co(t)}}(t,e),ko(t)&&xo(t)}async function No(t,e){const n=le(t);n.asyncQueue.verifyOperationInProgress(),re("RemoteStore","RemoteStore received new credentials");const r=go(n);n.k_.add(3),await ao(n),r&&n.K_.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.k_.delete(3),await oo(n)}function Oo(t){return t.W_||(t.W_=function(t,e,n){const r=le(t);return r.b_(),new eo(e,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(t.datastore,t.asyncQueue,{Ro:yo.bind(null,t),mo:vo.bind(null,t),po:bo.bind(null,t),R_:wo.bind(null,t)}),t.q_.push((async e=>{e?(t.W_.__(),po(t)?fo(t):t.K_.set("Unknown")):(await t.W_.stop(),mo(t))}))),t.W_}function Po(t){return t.G_||(t.G_=function(t,e,n){const r=le(t);return r.b_(),new no(e,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(t.datastore,t.asyncQueue,{Ro:()=>Promise.resolve(),mo:Io.bind(null,t),po:Do.bind(null,t),p_:Ao.bind(null,t),y_:Ro.bind(null,t)}),t.q_.push((async e=>{e?(t.G_.__(),await Co(t)):(await t.G_.stop(),t.L_.length>0&&(re("RemoteStore",`Stopping write stream with ${t.L_.length} pending writes`),t.L_=[]))}))),t.G_}class Lo{constructor(t,e,n,r,s){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=s,this.deferred=new de,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((t=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(t,e,n,r,s){const i=Date.now()+n,o=new Lo(t,e,i,r,s);return o.start(n),o}start(t){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new he(ue.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((t=>this.deferred.resolve(t)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Mo(t,e){if(se("AsyncQueue",`${e}: ${t}`),Ue(t))return new he(ue.UNAVAILABLE,`${e}: ${t}`);throw t}class Fo{static emptySet(t){return new Fo(t.comparator)}constructor(t){this.comparator=t?(e,n)=>t(e,n)||De.comparator(e.key,n.key):(t,e)=>De.comparator(t.key,e.key),this.keyedMap=wr(),this.sortedSet=new Ge(this.comparator)}has(t){return null!=this.keyedMap.get(t)}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){const e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal(((e,n)=>(t(e),!1)))}add(t){const e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){const e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof Fo))return!1;if(this.size!==t.size)return!1;const e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();for(;e.hasNext();){const t=e.getNext().key,r=n.getNext().key;if(!t.isEqual(r))return!1}return!0}toString(){const t=[];return this.forEach((e=>{t.push(e.toString())})),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"}copy(t,e){const n=new Fo;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n}}class Uo{constructor(){this.z_=new Ge(De.comparator)}track(t){const e=t.doc.key,n=this.z_.get(e);n?0!==t.type&&3===n.type?this.z_=this.z_.insert(e,t):3===t.type&&1!==n.type?this.z_=this.z_.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.z_=this.z_.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.z_=this.z_.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.z_=this.z_.remove(e):1===t.type&&2===n.type?this.z_=this.z_.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.z_=this.z_.insert(e,{type:2,doc:t.doc}):ae():this.z_=this.z_.insert(e,t)}j_(){const t=[];return this.z_.inorderTraversal(((e,n)=>{t.push(n)})),t}}class Bo{constructor(t,e,n,r,s,i,o,a,c){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=s,this.fromCache=i,this.syncStateChanged=o,this.excludesMetadataChanges=a,this.hasCachedResults=c}static fromInitialDocuments(t,e,n,r,s){const i=[];return e.forEach((t=>{i.push({type:0,doc:t})})),new Bo(t,e,Fo.emptySet(e),i,n,r,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&ur(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;const e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(let t=0;t<e.length;t++)if(e[t].type!==n[t].type||!e[t].doc.isEqual(n[t].doc))return!1;return!0}}class Vo{constructor(){this.H_=void 0,this.J_=[]}Y_(){return this.J_.some((t=>t.Z_()))}}class qo{constructor(){this.queries=jo(),this.onlineState="Unknown",this.X_=new Set}terminate(){!function(t,e){const n=le(t),r=n.queries;n.queries=jo(),r.forEach(((t,n)=>{for(const t of n.J_)t.onError(e)}))}(this,new he(ue.ABORTED,"Firestore shutting down"))}}function jo(){return new mr((t=>hr(t)),ur)}function $o(t,e){const n=le(t);let r=!1;for(const t of e){const e=t.query,s=n.queries.get(e);if(s){for(const e of s.J_)e.ta(t)&&(r=!0);s.H_=t}}r&&Ko(n)}function zo(t,e,n){const r=le(t),s=r.queries.get(e);if(s)for(const t of s.J_)t.onError(n);r.queries.delete(e)}function Ko(t){t.X_.forEach((t=>{t.next()}))}var Ho,Go;(Go=Ho||(Ho={})).na="default",Go.Cache="cache";class Wo{constructor(t,e,n){this.query=t,this.ra=e,this.ia=!1,this.sa=null,this.onlineState="Unknown",this.options=n||{}}ta(t){if(!this.options.includeMetadataChanges){const e=[];for(const n of t.docChanges)3!==n.type&&e.push(n);t=new Bo(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let e=!1;return this.ia?this.oa(t)&&(this.ra.next(t),e=!0):this._a(t,this.onlineState)&&(this.aa(t),e=!0),this.sa=t,e}onError(t){this.ra.error(t)}ea(t){this.onlineState=t;let e=!1;return this.sa&&!this.ia&&this._a(this.sa,t)&&(this.aa(this.sa),e=!0),e}_a(t,e){if(!t.fromCache)return!0;if(!this.Z_())return!0;const n="Offline"!==e;return(!this.options.ua||!n)&&(!t.docs.isEmpty()||t.hasCachedResults||"Offline"===e)}oa(t){if(t.docChanges.length>0)return!0;const e=this.sa&&this.sa.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges}aa(t){t=Bo.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.ia=!0,this.ra.next(t)}Z_(){return this.options.source!==Ho.Cache}}class Qo{constructor(t){this.key=t}}class Yo{constructor(t){this.key=t}}class Xo{constructor(t,e){this.query=t,this.da=e,this.Aa=null,this.hasCachedResults=!1,this.current=!1,this.Ra=xr(),this.mutatedKeys=xr(),this.Va=pr(t),this.ma=new Fo(this.Va)}get fa(){return this.da}ga(t,e){const n=e?e.pa:new Uo,r=e?e.ma:this.ma;let s=e?e.mutatedKeys:this.mutatedKeys,i=r,o=!1;const a="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,c="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(t.inorderTraversal(((t,e)=>{const l=r.get(t),u=fr(this.query,e)?e:null,h=!!l&&this.mutatedKeys.has(l.key),d=!!u&&(u.hasLocalMutations||this.mutatedKeys.has(u.key)&&u.hasCommittedMutations);let f=!1;l&&u?l.data.isEqual(u.data)?h!==d&&(n.track({type:3,doc:u}),f=!0):this.ya(l,u)||(n.track({type:2,doc:u}),f=!0,(a&&this.Va(u,a)>0||c&&this.Va(u,c)<0)&&(o=!0)):!l&&u?(n.track({type:0,doc:u}),f=!0):l&&!u&&(n.track({type:1,doc:l}),f=!0,(a||c)&&(o=!0)),f&&(u?(i=i.add(u),s=d?s.add(t):s.delete(t)):(i=i.delete(t),s=s.delete(t)))})),null!==this.query.limit)for(;i.size>this.query.limit;){const t="F"===this.query.limitType?i.last():i.first();i=i.delete(t.key),s=s.delete(t.key),n.track({type:1,doc:t})}return{ma:i,pa:n,ss:o,mutatedKeys:s}}ya(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,n,r){const s=this.ma;this.ma=t.ma,this.mutatedKeys=t.mutatedKeys;const i=t.pa.j_();i.sort(((t,e)=>function(t,e){const n=t=>{switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return ae()}};return n(t)-n(e)}(t.type,e.type)||this.Va(t.doc,e.doc))),this.wa(n),r=null!=r&&r;const o=e&&!r?this.Sa():[],a=0===this.Ra.size&&this.current&&!r?1:0,c=a!==this.Aa;return this.Aa=a,0!==i.length||c?{snapshot:new Bo(this.query,t.ma,s,i,t.mutatedKeys,0===a,c,!1,!!n&&n.resumeToken.approximateByteSize()>0),ba:o}:{ba:o}}ea(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({ma:this.ma,pa:new Uo,mutatedKeys:this.mutatedKeys,ss:!1},!1)):{ba:[]}}Da(t){return!this.da.has(t)&&!!this.ma.has(t)&&!this.ma.get(t).hasLocalMutations}wa(t){t&&(t.addedDocuments.forEach((t=>this.da=this.da.add(t))),t.modifiedDocuments.forEach((t=>{})),t.removedDocuments.forEach((t=>this.da=this.da.delete(t))),this.current=t.current)}Sa(){if(!this.current)return[];const t=this.Ra;this.Ra=xr(),this.ma.forEach((t=>{this.Da(t.key)&&(this.Ra=this.Ra.add(t.key))}));const e=[];return t.forEach((t=>{this.Ra.has(t)||e.push(new Yo(t))})),this.Ra.forEach((n=>{t.has(n)||e.push(new Qo(n))})),e}va(t){this.da=t.ds,this.Ra=xr();const e=this.ga(t.documents);return this.applyChanges(e,!0)}Ca(){return Bo.fromInitialDocuments(this.query,this.ma,this.mutatedKeys,0===this.Aa,this.hasCachedResults)}}class Jo{constructor(t,e,n){this.query=t,this.targetId=e,this.view=n}}class Zo{constructor(t){this.key=t,this.Fa=!1}}class ta{constructor(t,e,n,r,s,i){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=r,this.currentUser=s,this.maxConcurrentLimboResolutions=i,this.Ma={},this.xa=new mr((t=>hr(t)),ur),this.Oa=new Map,this.Na=new Set,this.La=new Ge(De.comparator),this.Ba=new Map,this.ka=new _i,this.qa={},this.Qa=new Map,this.Ka=hi.Qn(),this.onlineState="Unknown",this.$a=void 0}get isPrimaryClient(){return!0===this.$a}}async function ea(t,e,n=!0){const r=Ea(t);let s;const i=r.xa.get(e);return i?(r.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.Ca()):s=await ra(r,e,n,!0),s}async function na(t,e){const n=Ea(t);await ra(n,e,!0,!1)}async function ra(t,e,n,r){const s=await function(t,e){const n=le(t);return n.persistence.runTransaction("Allocate target","readwrite",(t=>{let r;return n.Gr.getTargetData(t,e).next((s=>s?(r=s,Fe.resolve(r)):n.Gr.allocateTargetId(t).next((s=>(r=new ri(e,s,"TargetPurposeListen",t.currentSequenceNumber),n.Gr.addTargetData(t,r).next((()=>r)))))))})).then((t=>{const r=n.us.get(t.targetId);return(null===r||t.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.us=n.us.insert(t.targetId,t),n.cs.set(e,t.targetId)),t}))}(t.localStore,cr(e)),i=s.targetId,o=t.sharedClientState.addLocalQueryTarget(i,n);let a;return r&&(a=await async function(t,e,n,r,s){t.Ua=(e,n,r)=>async function(t,e,n,r){let s=e.view.ga(n);s.ss&&(s=await Vi(t.localStore,e.query,!1).then((({documents:t})=>e.view.ga(t,s))));const i=r&&r.targetChanges.get(e.targetId),o=r&&null!=r.targetMismatches.get(e.targetId),a=e.view.applyChanges(s,t.isPrimaryClient,i,o);return ga(t,e.targetId,a.ba),a.snapshot}(t,e,n,r);const i=await Vi(t.localStore,e,!0),o=new Xo(e,i.ds),a=o.ga(i.documents),c=bs.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==t.onlineState,s),l=o.applyChanges(a,t.isPrimaryClient,c);ga(t,n,l.ba);const u=new Jo(e,n,o);return t.xa.set(e,u),t.Oa.has(n)?t.Oa.get(n).push(e):t.Oa.set(n,[e]),l.snapshot}(t,e,i,"current"===o,s.resumeToken)),t.isPrimaryClient&&n&&co(t.remoteStore,s),a}async function sa(t,e,n){const r=le(t),s=r.xa.get(e),i=r.Oa.get(s.targetId);if(i.length>1)return r.Oa.set(s.targetId,i.filter((t=>!ur(t,e)))),void r.xa.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await Bi(r.localStore,s.targetId,!1).then((()=>{r.sharedClientState.clearQueryState(s.targetId),n&&lo(r.remoteStore,s.targetId),fa(r,s.targetId)})).catch(Me)):(fa(r,s.targetId),await Bi(r.localStore,s.targetId,!0))}async function ia(t,e){const n=le(t),r=n.xa.get(e),s=n.Oa.get(r.targetId);n.isPrimaryClient&&1===s.length&&(n.sharedClientState.removeLocalQueryTarget(r.targetId),lo(n.remoteStore,r.targetId))}async function oa(t,e){const n=le(t);try{const t=await function(t,e){const n=le(t),r=e.snapshotVersion;let s=n.us;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(t=>{const i=n.hs.newChangeBuffer({trackRemovals:!0});s=n.us;const o=[];e.targetChanges.forEach(((i,a)=>{const c=s.get(a);if(!c)return;o.push(n.Gr.removeMatchingKeys(t,i.removedDocuments,a).next((()=>n.Gr.addMatchingKeys(t,i.addedDocuments,a))));let l=c.withSequenceNumber(t.currentSequenceNumber);null!==e.targetMismatches.get(a)?l=l.withResumeToken(tn.EMPTY_BYTE_STRING,ke.min()).withLastLimboFreeSnapshotVersion(ke.min()):i.resumeToken.approximateByteSize()>0&&(l=l.withResumeToken(i.resumeToken,r)),s=s.insert(a,l),function(t,e,n){return 0===t.resumeToken.approximateByteSize()||e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(c,l,i)&&o.push(n.Gr.updateTargetData(t,l))}));let a=vr(),c=xr();if(e.documentUpdates.forEach((r=>{e.resolvedLimboDocuments.has(r)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(t,r))})),o.push(function(t,e,n){let r=xr(),s=xr();return n.forEach((t=>r=r.add(t))),e.getEntries(t,r).next((t=>{let r=vr();return n.forEach(((n,i)=>{const o=t.get(n);i.isFoundDocument()!==o.isFoundDocument()&&(s=s.add(n)),i.isNoDocument()&&i.version.isEqual(ke.min())?(e.removeEntry(n,i.readTime),r=r.insert(n,i)):!o.isValidDocument()||i.version.compareTo(o.version)>0||0===i.version.compareTo(o.version)&&o.hasPendingWrites?(e.addEntry(i),r=r.insert(n,i)):re("LocalStore","Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",i.version)})),{Is:r,Es:s}}))}(t,i,e.documentUpdates).next((t=>{a=t.Is,c=t.Es}))),!r.isEqual(ke.min())){const e=n.Gr.getLastRemoteSnapshotVersion(t).next((e=>n.Gr.setTargetsMetadata(t,t.currentSequenceNumber,r)));o.push(e)}return Fe.waitFor(o).next((()=>i.apply(t))).next((()=>n.localDocuments.getLocalViewOfDocuments(t,a,c))).next((()=>a))})).then((t=>(n.us=s,t)))}(n.localStore,e);e.targetChanges.forEach(((t,e)=>{const r=n.Ba.get(e);r&&(ce(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1),t.addedDocuments.size>0?r.Fa=!0:t.modifiedDocuments.size>0?ce(r.Fa):t.removedDocuments.size>0&&(ce(r.Fa),r.Fa=!1))})),await va(n,t,e)}catch(t){await Me(t)}}function aa(t,e,n){const r=le(t);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){const t=[];r.xa.forEach(((n,r)=>{const s=r.view.ea(e);s.snapshot&&t.push(s.snapshot)})),function(t,e){const n=le(t);n.onlineState=e;let r=!1;n.queries.forEach(((t,n)=>{for(const t of n.J_)t.ea(e)&&(r=!0)})),r&&Ko(n)}(r.eventManager,e),t.length&&r.Ma.R_(t),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function ca(t,e,n){const r=le(t);r.sharedClientState.updateQueryState(e,"rejected",n);const s=r.Ba.get(e),i=s&&s.key;if(i){let t=new Ge(De.comparator);t=t.insert(i,Dn.newNoDocument(i,ke.min()));const n=xr().add(i),s=new vs(ke.min(),new Map,new Ge(Ce),t,n);await oa(r,s),r.La=r.La.remove(i),r.Ba.delete(e),ya(r)}else await Bi(r.localStore,e,!1).then((()=>fa(r,e,n))).catch(Me)}async function la(t,e){const n=le(t),r=e.batch.batchId;try{const t=await function(t,e){const n=le(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(t=>{const r=e.batch.keys(),s=n.hs.newChangeBuffer({trackRemovals:!0});return function(t,e,n,r){const s=n.batch,i=s.keys();let o=Fe.resolve();return i.forEach((t=>{o=o.next((()=>r.getEntry(e,t))).next((e=>{const i=n.docVersions.get(t);ce(null!==i),e.version.compareTo(i)<0&&(s.applyToRemoteDocument(e,n),e.isValidDocument()&&(e.setReadTime(n.commitVersion),r.addEntry(e)))}))})),o.next((()=>t.mutationQueue.removeMutationBatch(e,s)))}(n,t,e,s).next((()=>s.apply(t))).next((()=>n.mutationQueue.performConsistencyCheck(t))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(t,r,e.batch.batchId))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(t,function(t){let e=xr();for(let n=0;n<t.mutationResults.length;++n)t.mutationResults[n].transformResults.length>0&&(e=e.add(t.batch.mutations[n].key));return e}(e)))).next((()=>n.localDocuments.getDocuments(t,r)))}))}(n.localStore,e);da(n,r,null),ha(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await va(n,t)}catch(t){await Me(t)}}async function ua(t,e,n){const r=le(t);try{const t=await function(t,e){const n=le(t);return n.persistence.runTransaction("Reject batch","readwrite-primary",(t=>{let r;return n.mutationQueue.lookupMutationBatch(t,e).next((e=>(ce(null!==e),r=e.keys(),n.mutationQueue.removeMutationBatch(t,e)))).next((()=>n.mutationQueue.performConsistencyCheck(t))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(t,r,e))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(t,r))).next((()=>n.localDocuments.getDocuments(t,r)))}))}(r.localStore,e);da(r,e,n),ha(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),await va(r,t)}catch(n){await Me(n)}}function ha(t,e){(t.Qa.get(e)||[]).forEach((t=>{t.resolve()})),t.Qa.delete(e)}function da(t,e,n){const r=le(t);let s=r.qa[r.currentUser.toKey()];if(s){const t=s.get(e);t&&(n?t.reject(n):t.resolve(),s=s.remove(e)),r.qa[r.currentUser.toKey()]=s}}function fa(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const r of t.Oa.get(e))t.xa.delete(r),n&&t.Ma.Wa(r,n);t.Oa.delete(e),t.isPrimaryClient&&t.ka.yr(e).forEach((e=>{t.ka.containsKey(e)||pa(t,e)}))}function pa(t,e){t.Na.delete(e.path.canonicalString());const n=t.La.get(e);null!==n&&(lo(t.remoteStore,n),t.La=t.La.remove(e),t.Ba.delete(n),ya(t))}function ga(t,e,n){for(const r of n)r instanceof Qo?(t.ka.addReference(r.key,e),ma(t,r)):r instanceof Yo?(re("SyncEngine","Document no longer in limbo: "+r.key),t.ka.removeReference(r.key,e),t.ka.containsKey(r.key)||pa(t,r.key)):ae()}function ma(t,e){const n=e.key,r=n.path.canonicalString();t.La.get(n)||t.Na.has(r)||(re("SyncEngine","New document in limbo: "+n),t.Na.add(r),ya(t))}function ya(t){for(;t.Na.size>0&&t.La.size<t.maxConcurrentLimboResolutions;){const e=t.Na.values().next().value;t.Na.delete(e);const n=new De(Ie.fromString(e)),r=t.Ka.next();t.Ba.set(r,new Zo(n)),t.La=t.La.insert(n,r),co(t.remoteStore,new ri(cr(ir(n.path)),r,"TargetPurposeLimboResolution",Be.oe))}}async function va(t,e,n){const r=le(t),s=[],i=[],o=[];r.xa.isEmpty()||(r.xa.forEach(((t,a)=>{o.push(r.Ua(a,e,n).then((t=>{var e;if((t||n)&&r.isPrimaryClient){const s=t?!t.fromCache:null===(e=null==n?void 0:n.targetChanges.get(a.targetId))||void 0===e?void 0:e.current;r.sharedClientState.updateQueryState(a.targetId,s?"current":"not-current")}if(t){s.push(t);const e=Ni.zi(a.targetId,t);i.push(e)}})))})),await Promise.all(o),r.Ma.R_(s),await async function(t,e){const n=le(t);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(t=>Fe.forEach(e,(e=>Fe.forEach(e.Wi,(r=>n.persistence.referenceDelegate.addReference(t,e.targetId,r))).next((()=>Fe.forEach(e.Gi,(r=>n.persistence.referenceDelegate.removeReference(t,e.targetId,r)))))))))}catch(t){if(!Ue(t))throw t;re("LocalStore","Failed to update sequence numbers: "+t)}for(const t of e){const e=t.targetId;if(!t.fromCache){const t=n.us.get(e),r=t.snapshotVersion,s=t.withLastLimboFreeSnapshotVersion(r);n.us=n.us.insert(e,s)}}}(r.localStore,i))}async function ba(t,e){const n=le(t);if(!n.currentUser.isEqual(e)){re("SyncEngine","User change. New user:",e.toKey());const t=await Mi(n.localStore,e);n.currentUser=e,function(t){t.Qa.forEach((t=>{t.forEach((t=>{t.reject(new he(ue.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),t.Qa.clear()}(n),n.sharedClientState.handleUserChange(e,t.removedBatchIds,t.addedBatchIds),await va(n,t.Ts)}}function wa(t,e){const n=le(t),r=n.Ba.get(e);if(r&&r.Fa)return xr().add(r.key);{let t=xr();const r=n.Oa.get(e);if(!r)return t;for(const e of r){const r=n.xa.get(e);t=t.unionWith(r.view.fa)}return t}}function Ea(t){const e=le(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=oa.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=wa.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=ca.bind(null,e),e.Ma.R_=$o.bind(null,e.eventManager),e.Ma.Wa=zo.bind(null,e.eventManager),e}function _a(t){const e=le(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=la.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=ua.bind(null,e),e}class Ca{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(t){this.serializer=Ji(t.databaseInfo.databaseId),this.sharedClientState=this.za(t),this.persistence=this.ja(t),await this.persistence.start(),this.localStore=this.Ha(t),this.gcScheduler=this.Ja(t,this.localStore),this.indexBackfillerScheduler=this.Ya(t,this.localStore)}Ja(t,e){return null}Ya(t,e){return null}Ha(t){return function(t,e,n,r){return new Li(t,e,n,r)}(this.persistence,new Pi,t.initialUser,this.serializer)}ja(t){return new Ii(Ri.ei,this.serializer)}za(t){return new ji}async terminate(){var t,e;null===(t=this.gcScheduler)||void 0===t||t.stop(),null===(e=this.indexBackfillerScheduler)||void 0===e||e.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Ca.provider={build:()=>new Ca};class Ta extends Ca{constructor(t){super(),this.cacheSizeBytes=t}Ja(t,e){ce(this.persistence.referenceDelegate instanceof Di);const n=this.persistence.referenceDelegate.garbageCollector;return new pi(n,t.asyncQueue,e)}ja(t){const e=void 0!==this.cacheSizeBytes?ui.withCacheSize(this.cacheSizeBytes):ui.DEFAULT;return new Ii((t=>Di.ei(t,e)),this.serializer)}}class Sa{async initialize(t,e){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=t=>aa(this.syncEngine,t,1),this.remoteStore.remoteSyncer.handleCredentialChange=ba.bind(null,this.syncEngine),await async function(t,e){const n=le(t);e?(n.k_.delete(2),await oo(n)):e||(n.k_.add(2),await ao(n),n.K_.set("Unknown"))}(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return new qo}createDatastore(t){const e=Ji(t.databaseInfo.databaseId),n=function(t){return new Yi(t)}(t.databaseInfo);return function(t,e,n,r){return new ro(t,e,n,r)}(t.authCredentials,t.appCheckCredentials,n,e)}createRemoteStore(t){return function(t,e,n,r,s){return new io(t,e,n,r,s)}(this.localStore,this.datastore,t.asyncQueue,(t=>aa(this.syncEngine,t,0)),zi.p()?new zi:new $i)}createSyncEngine(t,e){return function(t,e,n,r,s,i,o){const a=new ta(t,e,n,r,s,i);return o&&(a.$a=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)}async terminate(){var t,e;await async function(t){const e=le(t);re("RemoteStore","RemoteStore shutting down."),e.k_.add(5),await ao(e),e.Q_.shutdown(),e.K_.set("Unknown")}(this.remoteStore),null===(t=this.datastore)||void 0===t||t.terminate(),null===(e=this.eventManager)||void 0===e||e.terminate()}}Sa.provider={build:()=>new Sa};class ka{constructor(t){this.observer=t,this.muted=!1}next(t){this.muted||this.observer.next&&this.Xa(this.observer.next,t)}error(t){this.muted||(this.observer.error?this.Xa(this.observer.error,t):se("Uncaught Error in snapshot listener:",t.toString()))}eu(){this.muted=!0}Xa(t,e){setTimeout((()=>{this.muted||t(e)}),0)}}class xa{constructor(t,e,n,r,s){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=n,this.databaseInfo=r,this.user=Zt.UNAUTHENTICATED,this.clientId=_e.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(n,(async t=>{re("FirestoreClient","Received user=",t.uid),await this.authCredentialListener(t),this.user=t})),this.appCheckCredentials.start(n,(t=>(re("FirestoreClient","Received new app check token=",t),this.appCheckCredentialListener(t,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}terminate(){this.asyncQueue.enterRestrictedMode();const t=new de;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){const n=Mo(e,"Failed to shutdown persistence");t.reject(n)}})),t.promise}}async function Ia(t,e){t.asyncQueue.verifyOperationInProgress(),re("FirestoreClient","Initializing OfflineComponentProvider");const n=t.configuration;await e.initialize(n);let r=n.initialUser;t.setCredentialChangeListener((async t=>{r.isEqual(t)||(await Mi(e.localStore,t),r=t)})),e.persistence.setDatabaseDeletedListener((()=>t.terminate())),t._offlineComponents=e}async function Aa(t,e){t.asyncQueue.verifyOperationInProgress();const n=await async function(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){re("FirestoreClient","Using user provided OfflineComponentProvider");try{await Ia(t,t._uninitializedComponentsProvider._offline)}catch(e){const n=e;if(!function(t){return"FirebaseError"===t.name?t.code===ue.FAILED_PRECONDITION||t.code===ue.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code}(n))throw n;ie("Error using user provided cache. Falling back to memory cache: "+n),await Ia(t,new Ca)}}else re("FirestoreClient","Using default OfflineComponentProvider"),await Ia(t,new Ta(void 0));return t._offlineComponents}(t);re("FirestoreClient","Initializing OnlineComponentProvider"),await e.initialize(n,t.configuration),t.setCredentialChangeListener((t=>No(e.remoteStore,t))),t.setAppCheckTokenChangeListener(((t,n)=>No(e.remoteStore,n))),t._onlineComponents=e}async function Ra(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(re("FirestoreClient","Using user provided OnlineComponentProvider"),await Aa(t,t._uninitializedComponentsProvider._online)):(re("FirestoreClient","Using default OnlineComponentProvider"),await Aa(t,new Sa))),t._onlineComponents}async function Da(t){const e=await Ra(t),n=e.eventManager;return n.onListen=ea.bind(null,e.syncEngine),n.onUnlisten=sa.bind(null,e.syncEngine),n.onFirstRemoteStoreListen=na.bind(null,e.syncEngine),n.onLastRemoteStoreUnlisten=ia.bind(null,e.syncEngine),n}function Na(t,e,n={}){const r=new de;return t.asyncQueue.enqueueAndForget((async()=>function(t,e,n,r,s){const i=new ka({next:a=>{i.eu(),e.enqueueAndForget((()=>async function(t,e){const n=le(t),r=e.query;let s=3;const i=n.queries.get(r);if(i){const t=i.J_.indexOf(e);t>=0&&(i.J_.splice(t,1),0===i.J_.length?s=e.Z_()?0:1:!i.Y_()&&e.Z_()&&(s=2))}switch(s){case 0:return n.queries.delete(r),n.onUnlisten(r,!0);case 1:return n.queries.delete(r),n.onUnlisten(r,!1);case 2:return n.onLastRemoteStoreUnlisten(r);default:return}}(t,o)));const c=a.docs.has(n);!c&&a.fromCache?s.reject(new he(ue.UNAVAILABLE,"Failed to get document because the client is offline.")):c&&a.fromCache&&r&&"server"===r.source?s.reject(new he(ue.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):s.resolve(a)},error:t=>s.reject(t)}),o=new Wo(ir(n.path),i,{includeMetadataChanges:!0,ua:!0});return async function(t,e){const n=le(t);let r=3;const s=e.query;let i=n.queries.get(s);i?!i.Y_()&&e.Z_()&&(r=2):(i=new Vo,r=e.Z_()?0:1);try{switch(r){case 0:i.H_=await n.onListen(s,!0);break;case 1:i.H_=await n.onListen(s,!1);break;case 2:await n.onFirstRemoteStoreListen(s)}}catch(t){const n=Mo(t,`Initialization of query '${dr(e.query)}' failed`);return void e.onError(n)}n.queries.set(s,i),i.J_.push(e),e.ea(n.onlineState),i.H_&&e.ta(i.H_)&&Ko(n)}(t,o)}(await Da(t),t.asyncQueue,e,n,r))),r.promise}function Oa(t){const e={};return void 0!==t.timeoutSeconds&&(e.timeoutSeconds=t.timeoutSeconds),e}const Pa=new Map;function La(t){if(!De.isDocumentKey(t))throw new he(ue.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function Ma(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";{const e=function(t){return t.constructor?t.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return"function"==typeof t?"a function":ae()}function Fa(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new he(ue.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=Ma(t);throw new he(ue.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}class Ua{constructor(t){var e,n;if(void 0===t.host){if(void 0!==t.ssl)throw new he(ue.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new he(ue.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}(function(t,e,n,r){if(!0===e&&!0===r)throw new he(ue.INVALID_ARGUMENT,"experimentalForceLongPolling and experimentalAutoDetectLongPolling cannot be used together.")})(0,t.experimentalForceLongPolling,0,t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===t.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Oa(null!==(n=t.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(t){if(void 0!==t.timeoutSeconds){if(isNaN(t.timeoutSeconds))throw new he(ue.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (must not be NaN)`);if(t.timeoutSeconds<5)throw new he(ue.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (minimum allowed value is 5)`);if(t.timeoutSeconds>30)throw new he(ue.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&function(t,e){return t.timeoutSeconds===e.timeoutSeconds}(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}class Ba{constructor(t,e,n,r){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Ua({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new he(ue.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(t){if(this._settingsFrozen)throw new he(ue.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Ua(t),void 0!==t.credentials&&(this._authCredentials=function(t){if(!t)return new pe;switch(t.type){case"firstParty":return new ve(t.sessionIndex||"0",t.iamToken||null,t.authTokenFactory||null);case"provider":return t.client;default:throw new he(ue.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const e=Pa.get(t);e&&(re("ComponentProvider","Removing Datastore"),Pa.delete(t),e.terminate())}(this),Promise.resolve()}}class Va{constructor(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}withConverter(t){return new Va(this.firestore,t,this._query)}}class qa{constructor(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new ja(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new qa(this.firestore,t,this._key)}}class ja extends Va{constructor(t,e,n){super(t,e,ir(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new qa(this.firestore,null,new De(t))}withConverter(t){return new ja(this.firestore,t,this._path)}}function $a(t,e,...n){if(t=p(t),1===arguments.length&&(e=_e.newId()),function(t,e,n){if(!n)throw new he(ue.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}("doc","path",e),t instanceof Ba){const r=Ie.fromString(e,...n);return La(r),new qa(t,null,new De(r))}{if(!(t instanceof qa||t instanceof ja))throw new he(ue.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(Ie.fromString(e,...n));return La(r),new qa(t.firestore,t instanceof ja?t.converter:null,new De(r))}}class za{constructor(t=Promise.resolve()){this.Iu=[],this.Eu=!1,this.du=[],this.Au=null,this.Ru=!1,this.Vu=!1,this.mu=[],this.r_=new Zi(this,"async_queue_retry"),this.fu=()=>{const t=Xi();t&&re("AsyncQueue","Visibility state changed to "+t.visibilityState),this.r_.Jo()},this.gu=t;const e=Xi();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.fu)}get isShuttingDown(){return this.Eu}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.pu(),this.yu(t)}enterRestrictedMode(t){if(!this.Eu){this.Eu=!0,this.Vu=t||!1;const e=Xi();e&&"function"==typeof e.removeEventListener&&e.removeEventListener("visibilitychange",this.fu)}}enqueue(t){if(this.pu(),this.Eu)return new Promise((()=>{}));const e=new de;return this.yu((()=>this.Eu&&this.Vu?Promise.resolve():(t().then(e.resolve,e.reject),e.promise))).then((()=>e.promise))}enqueueRetryable(t){this.enqueueAndForget((()=>(this.Iu.push(t),this.wu())))}async wu(){if(0!==this.Iu.length){try{await this.Iu[0](),this.Iu.shift(),this.r_.reset()}catch(t){if(!Ue(t))throw t;re("AsyncQueue","Operation failed with retryable error: "+t)}this.Iu.length>0&&this.r_.jo((()=>this.wu()))}}yu(t){const e=this.gu.then((()=>(this.Ru=!0,t().catch((t=>{this.Au=t,this.Ru=!1;const e=function(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t);throw se("INTERNAL UNHANDLED ERROR: ",e),t})).then((t=>(this.Ru=!1,t))))));return this.gu=e,e}enqueueAfterDelay(t,e,n){this.pu(),this.mu.indexOf(t)>-1&&(e=0);const r=Lo.createAndSchedule(this,t,e,n,(t=>this.Su(t)));return this.du.push(r),r}pu(){this.Au&&ae()}verifyOperationInProgress(){}async bu(){let t;do{t=this.gu,await t}while(t!==this.gu)}Du(t){for(const e of this.du)if(e.timerId===t)return!0;return!1}vu(t){return this.bu().then((()=>{this.du.sort(((t,e)=>t.targetTimeMs-e.targetTimeMs));for(const e of this.du)if(e.skipDelay(),"all"!==t&&e.timerId===t)break;return this.bu()}))}Cu(t){this.mu.push(t)}Su(t){const e=this.du.indexOf(t);this.du.splice(e,1)}}class Ka extends Ba{constructor(t,e,n,r){super(t,e,n,r),this.type="firestore",this._queue=new za,this._persistenceKey=(null==r?void 0:r.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const t=this._firestoreClient.terminate();this._queue=new za(t),this._firestoreClient=void 0,await t}}}function Ha(t){if(t._terminated)throw new he(ue.FAILED_PRECONDITION,"The client has already been terminated.");return t._firestoreClient||function(t){var e,n,r;const s=t._freezeSettings(),i=function(t,e,n,r){return new ln(t,e,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,Oa(r.experimentalLongPollingOptions),r.useFetchStreams)}(t._databaseId,(null===(e=t._app)||void 0===e?void 0:e.options.appId)||"",t._persistenceKey,s);t._componentsProvider||(null===(n=s.localCache)||void 0===n?void 0:n._offlineComponentProvider)&&(null===(r=s.localCache)||void 0===r?void 0:r._onlineComponentProvider)&&(t._componentsProvider={_offline:s.localCache._offlineComponentProvider,_online:s.localCache._onlineComponentProvider}),t._firestoreClient=new xa(t._authCredentials,t._appCheckCredentials,t._queue,i,t._componentsProvider&&function(t){const e=null==t?void 0:t._online.build();return{_offline:null==t?void 0:t._offline.build(e),_online:e}}(t._componentsProvider))}(t),t._firestoreClient}class Ga{constructor(t){this._byteString=t}static fromBase64String(t){try{return new Ga(tn.fromBase64String(t))}catch(t){throw new he(ue.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(t){return new Ga(tn.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}}class Wa{constructor(...t){for(let e=0;e<t.length;++e)if(0===t[e].length)throw new he(ue.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Re(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}class Qa{constructor(t){this._methodName=t}}class Ya{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new he(ue.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new he(ue.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return Ce(this._lat,t._lat)||Ce(this._long,t._long)}}class Xa{constructor(t){this._values=(t||[]).map((t=>t))}toArray(){return this._values.map((t=>t))}isEqual(t){return function(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;++n)if(t[n]!==e[n])return!1;return!0}(this._values,t._values)}}const Ja=/^__.*__$/;class Za{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return null!==this.fieldMask?new ts(t,this.data,this.fieldMask,e,this.fieldTransforms):new Zr(t,this.data,e,this.fieldTransforms)}}function tc(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw ae()}}class ec{constructor(t,e,n,r,s,i){this.settings=t,this.databaseId=e,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===s&&this.Fu(),this.fieldTransforms=s||[],this.fieldMask=i||[]}get path(){return this.settings.path}get Mu(){return this.settings.Mu}xu(t){return new ec(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Ou(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.xu({path:n,Nu:!1});return r.Lu(t),r}Bu(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.xu({path:n,Nu:!1});return r.Fu(),r}ku(t){return this.xu({path:void 0,Nu:!0})}qu(t){return dc(t,this.settings.methodName,this.settings.Qu||!1,this.path,this.settings.Ku)}contains(t){return void 0!==this.fieldMask.find((e=>t.isPrefixOf(e)))||void 0!==this.fieldTransforms.find((e=>t.isPrefixOf(e.field)))}Fu(){if(this.path)for(let t=0;t<this.path.length;t++)this.Lu(this.path.get(t))}Lu(t){if(0===t.length)throw this.qu("Document fields must not be empty");if(tc(this.Mu)&&Ja.test(t))throw this.qu('Document fields cannot begin and end with "__"')}}class nc{constructor(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.serializer=n||Ji(t)}$u(t,e,n,r=!1){return new ec({Mu:t,methodName:e,Ku:n,path:Re.emptyPath(),Nu:!1,Qu:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function rc(t){const e=t._freezeSettings(),n=Ji(t._databaseId);return new nc(t._databaseId,!!e.ignoreUndefinedProperties,n)}function sc(t,e,n,r,s,i={}){const o=t.$u(i.merge||i.mergeFields?2:0,e,n,s);cc("Data must be an object, but it was:",o,r);const a=oc(r,o);let c,l;if(i.merge)c=new Je(o.fieldMask),l=o.fieldTransforms;else if(i.mergeFields){const t=[];for(const r of i.mergeFields){const s=lc(e,r,n);if(!o.contains(s))throw new he(ue.INVALID_ARGUMENT,`Field '${s}' is specified in your field mask but missing from your input data.`);fc(t,s)||t.push(s)}c=new Je(t),l=o.fieldTransforms.filter((t=>c.covers(t.field)))}else c=null,l=o.fieldTransforms;return new Za(new An(a),c,l)}function ic(t,e){if(ac(t=p(t)))return cc("Unsupported field value:",e,t),oc(t,e);if(t instanceof Qa)return function(t,e){if(!tc(e.Mu))throw e.qu(`${t._methodName}() can only be used with update() and set()`);if(!e.path)throw e.qu(`${t._methodName}() is not currently supported inside arrays`);const n=t._toFieldTransform(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(void 0===t&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.Nu&&4!==e.Mu)throw e.qu("Nested arrays are not supported");return function(t,e){const n=[];let r=0;for(const s of t){let t=ic(s,e.ku(r));null==t&&(t={nullValue:"NULL_VALUE"}),n.push(t),r++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===(t=p(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return Dr(e.serializer,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){const n=Se.fromDate(t);return{timestampValue:Ns(e.serializer,n)}}if(t instanceof Se){const n=new Se(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:Ns(e.serializer,n)}}if(t instanceof Ya)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof Ga)return{bytesValue:Os(e.serializer,t._byteString)};if(t instanceof qa){const n=e.databaseId,r=t.firestore._databaseId;if(!r.isEqual(n))throw e.qu(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:Ms(t.firestore._databaseId||e.databaseId,t._key.path)}}if(t instanceof Xa)return function(t,e){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:t.toArray().map((t=>{if("number"!=typeof t)throw e.qu("VectorValues must only contain numeric values.");return Ar(e.serializer,t)}))}}}}}}(t,e);throw e.qu(`Unsupported field value: ${Ma(t)}`)}(t,e)}function oc(t,e){const n={};return He(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Ke(t,((t,r)=>{const s=ic(r,e.Ou(t));null!=s&&(n[t]=s)})),{mapValue:{fields:n}}}function ac(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof Se||t instanceof Ya||t instanceof Ga||t instanceof qa||t instanceof Qa||t instanceof Xa)}function cc(t,e,n){if(!ac(n)||!function(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}(n)){const r=Ma(n);throw"an object"===r?e.qu(t+" a custom object"):e.qu(t+" "+r)}}function lc(t,e,n){if((e=p(e))instanceof Wa)return e._internalPath;if("string"==typeof e)return hc(t,e);throw dc("Field path arguments must be of type string or ",t,!1,void 0,n)}const uc=new RegExp("[~\\*/\\[\\]]");function hc(t,e,n){if(e.search(uc)>=0)throw dc(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new Wa(...e.split("."))._internalPath}catch(r){throw dc(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function dc(t,e,n,r,s){const i=r&&!r.isEmpty(),o=void 0!==s;let a=`Function ${e}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(i||o)&&(c+=" (found",i&&(c+=` in field ${r}`),o&&(c+=` in document ${s}`),c+=")"),new he(ue.INVALID_ARGUMENT,a+t+c)}function fc(t,e){return t.some((t=>t.isEqual(e)))}class pc{constructor(t,e,n,r,s){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=r,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new qa(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const t=new gc(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){const e=this._document.data.field(mc("DocumentSnapshot.get",t));if(null!==e)return this._userDataWriter.convertValue(e)}}}class gc extends pc{data(){return super.data()}}function mc(t,e){return"string"==typeof e?hc(t,e):e instanceof Wa?e._internalPath:e._delegate._internalPath}class yc{convertValue(t,e="none"){switch(dn(t)){case 0:return null;case 1:return t.booleanValue;case 2:return rn(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(sn(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 11:return this.convertObject(t.mapValue,e);case 10:return this.convertVectorValue(t.mapValue);default:throw ae()}}convertObject(t,e){return this.convertObjectMap(t.fields,e)}convertObjectMap(t,e="none"){const n={};return Ke(t,((t,r)=>{n[t]=this.convertValue(r,e)})),n}convertVectorValue(t){var e,n,r;const s=null===(r=null===(n=null===(e=t.fields)||void 0===e?void 0:e.value.arrayValue)||void 0===n?void 0:n.values)||void 0===r?void 0:r.map((t=>rn(t.doubleValue)));return new Xa(s)}convertGeoPoint(t){return new Ya(rn(t.latitude),rn(t.longitude))}convertArray(t,e){return(t.values||[]).map((t=>this.convertValue(t,e)))}convertServerTimestamp(t,e){switch(e){case"previous":const n=an(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(cn(t));default:return null}}convertTimestamp(t){const e=nn(t);return new Se(e.seconds,e.nanos)}convertDocumentKey(t,e){const n=Ie.fromString(t);ce(ni(n));const r=new un(n.get(1),n.get(3)),s=new De(n.popFirst(5));return r.isEqual(e)||se(`Document ${s} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),s}}class vc{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class bc extends pc{constructor(t,e,n,r,s,i){super(t,e,n,r,i),this._firestore=t,this._firestoreImpl=t,this.metadata=s}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){const e=new wc(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){const n=this._document.data.field(mc("DocumentSnapshot.get",t));if(null!==n)return this._userDataWriter.convertValue(n,e.serverTimestamps)}}}class wc extends bc{data(t={}){return super.data(t)}}function Ec(t){t=Fa(t,qa);const e=Fa(t.firestore,Ka);return Na(Ha(e),t._key).then((n=>function(t,e,n){const r=n.docs.get(e._key),s=new _c(t);return new bc(t,s,e._key,r,new vc(n.hasPendingWrites,n.fromCache),e.converter)}(e,t,n)))}class _c extends yc{constructor(t){super(),this.firestore=t}convertBytes(t){return new Ga(t)}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return new qa(this.firestore,null,e)}}function Cc(t,e,n){t=Fa(t,qa);const r=Fa(t.firestore,Ka),s=function(t,e,n){let r;return r=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e,r}(t.converter,e,n);return function(t,e){return function(t,e){const n=new de;return t.asyncQueue.enqueueAndForget((async()=>async function(t,e,n){const r=_a(t);try{const t=await function(t,e){const n=le(t),r=Se.now(),s=e.reduce(((t,e)=>t.add(e.key)),xr());let i,o;return n.persistence.runTransaction("Locally write mutations","readwrite",(t=>{let a=vr(),c=xr();return n.hs.getEntries(t,s).next((t=>{a=t,a.forEach(((t,e)=>{e.isValidDocument()||(c=c.add(t))}))})).next((()=>n.localDocuments.getOverlayedDocuments(t,a))).next((s=>{i=s;const o=[];for(const t of e){const e=Xr(t,i.get(t.key).overlayedDocument);null!=e&&o.push(new ts(t.key,e,Rn(e.value.mapValue),Kr.exists(!0)))}return n.mutationQueue.addMutationBatch(t,r,o,e)})).next((e=>{o=e;const r=e.applyToLocalDocumentSet(i,c);return n.documentOverlayCache.saveOverlays(t,e.batchId,r)}))})).then((()=>({batchId:o.batchId,changes:Er(i)})))}(r.localStore,e);r.sharedClientState.addPendingMutation(t.batchId),function(t,e,n){let r=t.qa[t.currentUser.toKey()];r||(r=new Ge(Ce)),r=r.insert(e,n),t.qa[t.currentUser.toKey()]=r}(r,t.batchId,n),await va(r,t.changes),await Co(r.remoteStore)}catch(t){const e=Mo(t,"Failed to persist write");n.reject(e)}}(await function(t){return Ra(t).then((t=>t.syncEngine))}(t),e,n))),n.promise}(Ha(t),e)}(r,[sc(rc(r),"setDoc",t._key,s,null!==t.converter,n).toMutation(t._key,Kr.none())])}new WeakMap,function(t,e=!0){te="11.1.0",Tt(new g("firestore",((t,{instanceIdentifier:n,options:r})=>{const s=t.getProvider("app").getImmediate(),i=new Ka(new me(t.getProvider("auth-internal")),new we(t.getProvider("app-check-internal")),function(t,e){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new he(ue.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new un(t.options.projectId,e)}(s,n),s);return r=Object.assign({useFetchStreams:e},r),i._setSettings(r),i}),"PUBLIC").setMultipleInstances(!0)),It(Jt,"4.7.5",t),It(Jt,"4.7.5","esm2017")}();const Tc=Object.create(null);Tc.open="0",Tc.close="1",Tc.ping="2",Tc.pong="3",Tc.message="4",Tc.upgrade="5",Tc.noop="6";const Sc=Object.create(null);Object.keys(Tc).forEach((t=>{Sc[Tc[t]]=t}));const kc={type:"error",data:"parser error"},xc="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===Object.prototype.toString.call(Blob),Ic="function"==typeof ArrayBuffer,Ac=t=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(t):t&&t.buffer instanceof ArrayBuffer,Rc=({type:t,data:e},n,r)=>xc&&e instanceof Blob?n?r(e):Dc(e,r):Ic&&(e instanceof ArrayBuffer||Ac(e))?n?r(e):Dc(new Blob([e]),r):r(Tc[t]+(e||"")),Dc=(t,e)=>{const n=new FileReader;return n.onload=function(){const t=n.result.split(",")[1];e("b"+(t||""))},n.readAsDataURL(t)};function Nc(t){return t instanceof Uint8Array?t:t instanceof ArrayBuffer?new Uint8Array(t):new Uint8Array(t.buffer,t.byteOffset,t.byteLength)}let Oc;const Pc="undefined"==typeof Uint8Array?[]:new Uint8Array(256);for(let t=0;t<64;t++)Pc["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charCodeAt(t)]=t;const Lc="function"==typeof ArrayBuffer,Mc=(t,e)=>{if("string"!=typeof t)return{type:"message",data:Uc(t,e)};const n=t.charAt(0);return"b"===n?{type:"message",data:Fc(t.substring(1),e)}:Sc[n]?t.length>1?{type:Sc[n],data:t.substring(1)}:{type:Sc[n]}:kc},Fc=(t,e)=>{if(Lc){const n=(t=>{let e,n,r,s,i,o=.75*t.length,a=t.length,c=0;"="===t[t.length-1]&&(o--,"="===t[t.length-2]&&o--);const l=new ArrayBuffer(o),u=new Uint8Array(l);for(e=0;e<a;e+=4)n=Pc[t.charCodeAt(e)],r=Pc[t.charCodeAt(e+1)],s=Pc[t.charCodeAt(e+2)],i=Pc[t.charCodeAt(e+3)],u[c++]=n<<2|r>>4,u[c++]=(15&r)<<4|s>>2,u[c++]=(3&s)<<6|63&i;return l})(t);return Uc(n,e)}return{base64:!0,data:t}},Uc=(t,e)=>"blob"===e?t instanceof Blob?t:new Blob([t]):t instanceof ArrayBuffer?t:t.buffer,Bc=String.fromCharCode(30);let Vc;function qc(t){return t.reduce(((t,e)=>t+e.length),0)}function jc(t,e){if(t[0].length===e)return t.shift();const n=new Uint8Array(e);let r=0;for(let s=0;s<e;s++)n[s]=t[0][r++],r===t[0].length&&(t.shift(),r=0);return t.length&&r<t[0].length&&(t[0]=t[0].slice(r)),n}function $c(t){if(t)return function(t){for(var e in $c.prototype)t[e]=$c.prototype[e];return t}(t)}$c.prototype.on=$c.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(e),this},$c.prototype.once=function(t,e){function n(){this.off(t,n),e.apply(this,arguments)}return n.fn=e,this.on(t,n),this},$c.prototype.off=$c.prototype.removeListener=$c.prototype.removeAllListeners=$c.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n,r=this._callbacks["$"+t];if(!r)return this;if(1==arguments.length)return delete this._callbacks["$"+t],this;for(var s=0;s<r.length;s++)if((n=r[s])===e||n.fn===e){r.splice(s,1);break}return 0===r.length&&delete this._callbacks["$"+t],this},$c.prototype.emit=function(t){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),n=this._callbacks["$"+t],r=1;r<arguments.length;r++)e[r-1]=arguments[r];if(n){r=0;for(var s=(n=n.slice(0)).length;r<s;++r)n[r].apply(this,e)}return this},$c.prototype.emitReserved=$c.prototype.emit,$c.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks["$"+t]||[]},$c.prototype.hasListeners=function(t){return!!this.listeners(t).length};const zc="function"==typeof Promise&&"function"==typeof Promise.resolve?t=>Promise.resolve().then(t):(t,e)=>e(t,0),Kc="undefined"!=typeof self?self:"undefined"!=typeof window?window:Function("return this")();function Hc(t,...e){return e.reduce(((e,n)=>(t.hasOwnProperty(n)&&(e[n]=t[n]),e)),{})}const Gc=Kc.setTimeout,Wc=Kc.clearTimeout;function Qc(t,e){e.useNativeTimers?(t.setTimeoutFn=Gc.bind(Kc),t.clearTimeoutFn=Wc.bind(Kc)):(t.setTimeoutFn=Kc.setTimeout.bind(Kc),t.clearTimeoutFn=Kc.clearTimeout.bind(Kc))}function Yc(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}class Xc extends Error{constructor(t,e,n){super(t),this.description=e,this.context=n,this.type="TransportError"}}class Jc extends $c{constructor(t){super(),this.writable=!1,Qc(this,t),this.opts=t,this.query=t.query,this.socket=t.socket,this.supportsBinary=!t.forceBase64}onError(t,e,n){return super.emitReserved("error",new Xc(t,e,n)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this}send(t){"open"===this.readyState&&this.write(t)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(t){const e=Mc(t,this.socket.binaryType);this.onPacket(e)}onPacket(t){super.emitReserved("packet",t)}onClose(t){this.readyState="closed",super.emitReserved("close",t)}pause(t){}createUri(t,e={}){return t+"://"+this._hostname()+this._port()+this.opts.path+this._query(e)}_hostname(){const t=this.opts.hostname;return-1===t.indexOf(":")?t:"["+t+"]"}_port(){return this.opts.port&&(this.opts.secure&&Number(443!==this.opts.port)||!this.opts.secure&&80!==Number(this.opts.port))?":"+this.opts.port:""}_query(t){const e=function(t){let e="";for(let n in t)t.hasOwnProperty(n)&&(e.length&&(e+="&"),e+=encodeURIComponent(n)+"="+encodeURIComponent(t[n]));return e}(t);return e.length?"?"+e:""}}class Zc extends Jc{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(t){this.readyState="pausing";const e=()=>{this.readyState="paused",t()};if(this._polling||!this.writable){let t=0;this._polling&&(t++,this.once("pollComplete",(function(){--t||e()}))),this.writable||(t++,this.once("drain",(function(){--t||e()})))}else e()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(t){((t,e)=>{const n=t.split(Bc),r=[];for(let t=0;t<n.length;t++){const s=Mc(n[t],e);if(r.push(s),"error"===s.type)break}return r})(t,this.socket.binaryType).forEach((t=>{if("opening"===this.readyState&&"open"===t.type&&this.onOpen(),"close"===t.type)return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(t)})),"closed"!==this.readyState&&(this._polling=!1,this.emitReserved("pollComplete"),"open"===this.readyState&&this._poll())}doClose(){const t=()=>{this.write([{type:"close"}])};"open"===this.readyState?t():this.once("open",t)}write(t){this.writable=!1,((t,e)=>{const n=t.length,r=new Array(n);let s=0;t.forEach(((t,i)=>{Rc(t,!1,(t=>{r[i]=t,++s===n&&e(r.join(Bc))}))}))})(t,(t=>{this.doWrite(t,(()=>{this.writable=!0,this.emitReserved("drain")}))}))}uri(){const t=this.opts.secure?"https":"http",e=this.query||{};return!1!==this.opts.timestampRequests&&(e[this.opts.timestampParam]=Yc()),this.supportsBinary||e.sid||(e.b64=1),this.createUri(t,e)}}let tl=!1;try{tl="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(t){}const el=tl;function nl(){}class rl extends Zc{constructor(t){if(super(t),"undefined"!=typeof location){const e="https:"===location.protocol;let n=location.port;n||(n=e?"443":"80"),this.xd="undefined"!=typeof location&&t.hostname!==location.hostname||n!==t.port}}doWrite(t,e){const n=this.request({method:"POST",data:t});n.on("success",e),n.on("error",((t,e)=>{this.onError("xhr post error",t,e)}))}doPoll(){const t=this.request();t.on("data",this.onData.bind(this)),t.on("error",((t,e)=>{this.onError("xhr poll error",t,e)})),this.pollXhr=t}}class sl extends $c{constructor(t,e,n){super(),this.createRequest=t,Qc(this,n),this._opts=n,this._method=n.method||"GET",this._uri=e,this._data=void 0!==n.data?n.data:null,this._create()}_create(){var t;const e=Hc(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");e.xdomain=!!this._opts.xd;const n=this._xhr=this.createRequest(e);try{n.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){n.setDisableHeaderCheck&&n.setDisableHeaderCheck(!0);for(let t in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(t)&&n.setRequestHeader(t,this._opts.extraHeaders[t])}}catch(t){}if("POST"===this._method)try{n.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(t){}try{n.setRequestHeader("Accept","*/*")}catch(t){}null===(t=this._opts.cookieJar)||void 0===t||t.addCookies(n),"withCredentials"in n&&(n.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(n.timeout=this._opts.requestTimeout),n.onreadystatechange=()=>{var t;3===n.readyState&&(null===(t=this._opts.cookieJar)||void 0===t||t.parseCookies(n.getResponseHeader("set-cookie"))),4===n.readyState&&(200===n.status||1223===n.status?this._onLoad():this.setTimeoutFn((()=>{this._onError("number"==typeof n.status?n.status:0)}),0))},n.send(this._data)}catch(t){return void this.setTimeoutFn((()=>{this._onError(t)}),0)}"undefined"!=typeof document&&(this._index=sl.requestsCount++,sl.requests[this._index]=this)}_onError(t){this.emitReserved("error",t,this._xhr),this._cleanup(!0)}_cleanup(t){if(void 0!==this._xhr&&null!==this._xhr){if(this._xhr.onreadystatechange=nl,t)try{this._xhr.abort()}catch(t){}"undefined"!=typeof document&&delete sl.requests[this._index],this._xhr=null}}_onLoad(){const t=this._xhr.responseText;null!==t&&(this.emitReserved("data",t),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}}function il(){for(let t in sl.requests)sl.requests.hasOwnProperty(t)&&sl.requests[t].abort()}sl.requestsCount=0,sl.requests={},"undefined"!=typeof document&&("function"==typeof attachEvent?attachEvent("onunload",il):"function"==typeof addEventListener&&addEventListener("onpagehide"in Kc?"pagehide":"unload",il,!1));const ol=function(){const t=al({xdomain:!1});return t&&null!==t.responseType}();function al(t){const e=t.xdomain;try{if("undefined"!=typeof XMLHttpRequest&&(!e||el))return new XMLHttpRequest}catch(t){}if(!e)try{return new(Kc[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(t){}}const cl="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase();class ll extends Jc{get name(){return"websocket"}doOpen(){const t=this.uri(),e=this.opts.protocols,n=cl?{}:Hc(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(n.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(t,e,n)}catch(t){return this.emitReserved("error",t)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=t=>this.onClose({description:"websocket connection closed",context:t}),this.ws.onmessage=t=>this.onData(t.data),this.ws.onerror=t=>this.onError("websocket error",t)}write(t){this.writable=!1;for(let e=0;e<t.length;e++){const n=t[e],r=e===t.length-1;Rc(n,this.supportsBinary,(t=>{try{this.doWrite(n,t)}catch(t){}r&&zc((()=>{this.writable=!0,this.emitReserved("drain")}),this.setTimeoutFn)}))}}doClose(){void 0!==this.ws&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){const t=this.opts.secure?"wss":"ws",e=this.query||{};return this.opts.timestampRequests&&(e[this.opts.timestampParam]=Yc()),this.supportsBinary||(e.b64=1),this.createUri(t,e)}}const ul=Kc.WebSocket||Kc.MozWebSocket,hl={websocket:class extends ll{createSocket(t,e,n){return cl?new ul(t,e,n):e?new ul(t,e):new ul(t)}doWrite(t,e){this.ws.send(e)}},webtransport:class extends Jc{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(t){return this.emitReserved("error",t)}this._transport.closed.then((()=>{this.onClose()})).catch((t=>{this.onError("webtransport error",t)})),this._transport.ready.then((()=>{this._transport.createBidirectionalStream().then((t=>{const e=function(t,e){Vc||(Vc=new TextDecoder);const n=[];let r=0,s=-1,i=!1;return new TransformStream({transform(o,a){for(n.push(o);;){if(0===r){if(qc(n)<1)break;const t=jc(n,1);i=!(128&~t[0]),s=127&t[0],r=s<126?3:126===s?1:2}else if(1===r){if(qc(n)<2)break;const t=jc(n,2);s=new DataView(t.buffer,t.byteOffset,t.length).getUint16(0),r=3}else if(2===r){if(qc(n)<8)break;const t=jc(n,8),e=new DataView(t.buffer,t.byteOffset,t.length),i=e.getUint32(0);if(i>Math.pow(2,21)-1){a.enqueue(kc);break}s=i*Math.pow(2,32)+e.getUint32(4),r=3}else{if(qc(n)<s)break;const t=jc(n,s);a.enqueue(Mc(i?t:Vc.decode(t),e)),r=0}if(0===s||s>t){a.enqueue(kc);break}}}})}(Number.MAX_SAFE_INTEGER,this.socket.binaryType),n=t.readable.pipeThrough(e).getReader(),r=new TransformStream({transform(t,e){!function(t,e){xc&&t.data instanceof Blob?t.data.arrayBuffer().then(Nc).then(e):Ic&&(t.data instanceof ArrayBuffer||Ac(t.data))?e(Nc(t.data)):Rc(t,!1,(t=>{Oc||(Oc=new TextEncoder),e(Oc.encode(t))}))}(t,(n=>{const r=n.length;let s;if(r<126)s=new Uint8Array(1),new DataView(s.buffer).setUint8(0,r);else if(r<65536){s=new Uint8Array(3);const t=new DataView(s.buffer);t.setUint8(0,126),t.setUint16(1,r)}else{s=new Uint8Array(9);const t=new DataView(s.buffer);t.setUint8(0,127),t.setBigUint64(1,BigInt(r))}t.data&&"string"!=typeof t.data&&(s[0]|=128),e.enqueue(s),e.enqueue(n)}))}});r.readable.pipeTo(t.writable),this._writer=r.writable.getWriter();const s=()=>{n.read().then((({done:t,value:e})=>{t||(this.onPacket(e),s())})).catch((t=>{}))};s();const i={type:"open"};this.query.sid&&(i.data=`{"sid":"${this.query.sid}"}`),this._writer.write(i).then((()=>this.onOpen()))}))}))}write(t){this.writable=!1;for(let e=0;e<t.length;e++){const n=t[e],r=e===t.length-1;this._writer.write(n).then((()=>{r&&zc((()=>{this.writable=!0,this.emitReserved("drain")}),this.setTimeoutFn)}))}}doClose(){var t;null===(t=this._transport)||void 0===t||t.close()}},polling:class extends rl{constructor(t){super(t);const e=t&&t.forceBase64;this.supportsBinary=ol&&!e}request(t={}){return Object.assign(t,{xd:this.xd},this.opts),new sl(al,this.uri(),t)}}},dl=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,fl=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function pl(t){if(t.length>8e3)throw"URI too long";const e=t,n=t.indexOf("["),r=t.indexOf("]");-1!=n&&-1!=r&&(t=t.substring(0,n)+t.substring(n,r).replace(/:/g,";")+t.substring(r,t.length));let s=dl.exec(t||""),i={},o=14;for(;o--;)i[fl[o]]=s[o]||"";return-1!=n&&-1!=r&&(i.source=e,i.host=i.host.substring(1,i.host.length-1).replace(/;/g,":"),i.authority=i.authority.replace("[","").replace("]","").replace(/;/g,":"),i.ipv6uri=!0),i.pathNames=function(t,e){const n=e.replace(/\/{2,9}/g,"/").split("/");return"/"!=e.slice(0,1)&&0!==e.length||n.splice(0,1),"/"==e.slice(-1)&&n.splice(n.length-1,1),n}(0,i.path),i.queryKey=function(t,e){const n={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,(function(t,e,r){e&&(n[e]=r)})),n}(0,i.query),i}const gl="function"==typeof addEventListener&&"function"==typeof removeEventListener,ml=[];gl&&addEventListener("offline",(()=>{ml.forEach((t=>t()))}),!1);class yl extends $c{constructor(t,e){if(super(),this.binaryType="arraybuffer",this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,t&&"object"==typeof t&&(e=t,t=null),t){const n=pl(t);e.hostname=n.host,e.secure="https"===n.protocol||"wss"===n.protocol,e.port=n.port,n.query&&(e.query=n.query)}else e.host&&(e.hostname=pl(e.host).host);Qc(this,e),this.secure=null!=e.secure?e.secure:"undefined"!=typeof location&&"https:"===location.protocol,e.hostname&&!e.port&&(e.port=this.secure?"443":"80"),this.hostname=e.hostname||("undefined"!=typeof location?location.hostname:"localhost"),this.port=e.port||("undefined"!=typeof location&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},e.transports.forEach((t=>{const e=t.prototype.name;this.transports.push(e),this._transportsByName[e]=t})),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},e),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),"string"==typeof this.opts.query&&(this.opts.query=function(t){let e={},n=t.split("&");for(let t=0,r=n.length;t<r;t++){let r=n[t].split("=");e[decodeURIComponent(r[0])]=decodeURIComponent(r[1])}return e}(this.opts.query)),gl&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),"localhost"!==this.hostname&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},ml.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(t){const e=Object.assign({},this.opts.query);e.EIO=4,e.transport=t,this.id&&(e.sid=this.id);const n=Object.assign({},this.opts,{query:e,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[t]);return new this._transportsByName[t](n)}_open(){if(0===this.transports.length)return void this.setTimeoutFn((()=>{this.emitReserved("error","No transports available")}),0);const t=this.opts.rememberUpgrade&&yl.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket")?"websocket":this.transports[0];this.readyState="opening";const e=this.createTransport(t);e.open(),this.setTransport(e)}setTransport(t){this.transport&&this.transport.removeAllListeners(),this.transport=t,t.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",(t=>this._onClose("transport close",t)))}onOpen(){this.readyState="open",yl.priorWebsocketSuccess="websocket"===this.transport.name,this.emitReserved("open"),this.flush()}_onPacket(t){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(this.emitReserved("packet",t),this.emitReserved("heartbeat"),t.type){case"open":this.onHandshake(JSON.parse(t.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":const e=new Error("server error");e.code=t.data,this._onError(e);break;case"message":this.emitReserved("data",t.data),this.emitReserved("message",t.data)}}onHandshake(t){this.emitReserved("handshake",t),this.id=t.sid,this.transport.query.sid=t.sid,this._pingInterval=t.pingInterval,this._pingTimeout=t.pingTimeout,this._maxPayload=t.maxPayload,this.onOpen(),"closed"!==this.readyState&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const t=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+t,this._pingTimeoutTimer=this.setTimeoutFn((()=>{this._onClose("ping timeout")}),t),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,0===this.writeBuffer.length?this.emitReserved("drain"):this.flush()}flush(){if("closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const t=this._getWritablePackets();this.transport.send(t),this._prevBufferLen=t.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&"polling"===this.transport.name&&this.writeBuffer.length>1))return this.writeBuffer;let t=1;for(let n=0;n<this.writeBuffer.length;n++){const r=this.writeBuffer[n].data;if(r&&(t+="string"==typeof(e=r)?function(t){let e=0,n=0;for(let r=0,s=t.length;r<s;r++)e=t.charCodeAt(r),e<128?n+=1:e<2048?n+=2:e<55296||e>=57344?n+=3:(r++,n+=4);return n}(e):Math.ceil(1.33*(e.byteLength||e.size))),n>0&&t>this._maxPayload)return this.writeBuffer.slice(0,n);t+=2}var e;return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;const t=Date.now()>this._pingTimeoutTime;return t&&(this._pingTimeoutTime=0,zc((()=>{this._onClose("ping timeout")}),this.setTimeoutFn)),t}write(t,e,n){return this._sendPacket("message",t,e,n),this}send(t,e,n){return this._sendPacket("message",t,e,n),this}_sendPacket(t,e,n,r){if("function"==typeof e&&(r=e,e=void 0),"function"==typeof n&&(r=n,n=null),"closing"===this.readyState||"closed"===this.readyState)return;(n=n||{}).compress=!1!==n.compress;const s={type:t,data:e,options:n};this.emitReserved("packetCreate",s),this.writeBuffer.push(s),r&&this.once("flush",r),this.flush()}close(){const t=()=>{this._onClose("forced close"),this.transport.close()},e=()=>{this.off("upgrade",e),this.off("upgradeError",e),t()},n=()=>{this.once("upgrade",e),this.once("upgradeError",e)};return"opening"!==this.readyState&&"open"!==this.readyState||(this.readyState="closing",this.writeBuffer.length?this.once("drain",(()=>{this.upgrading?n():t()})):this.upgrading?n():t()),this}_onError(t){if(yl.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&"opening"===this.readyState)return this.transports.shift(),this._open();this.emitReserved("error",t),this._onClose("transport error",t)}_onClose(t,e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),gl&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){const t=ml.indexOf(this._offlineEventListener);-1!==t&&ml.splice(t,1)}this.readyState="closed",this.id=null,this.emitReserved("close",t,e),this.writeBuffer=[],this._prevBufferLen=0}}}yl.protocol=4;class vl extends yl{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),"open"===this.readyState&&this.opts.upgrade)for(let t=0;t<this._upgrades.length;t++)this._probe(this._upgrades[t])}_probe(t){let e=this.createTransport(t),n=!1;yl.priorWebsocketSuccess=!1;const r=()=>{n||(e.send([{type:"ping",data:"probe"}]),e.once("packet",(t=>{if(!n)if("pong"===t.type&&"probe"===t.data){if(this.upgrading=!0,this.emitReserved("upgrading",e),!e)return;yl.priorWebsocketSuccess="websocket"===e.name,this.transport.pause((()=>{n||"closed"!==this.readyState&&(l(),this.setTransport(e),e.send([{type:"upgrade"}]),this.emitReserved("upgrade",e),e=null,this.upgrading=!1,this.flush())}))}else{const t=new Error("probe error");t.transport=e.name,this.emitReserved("upgradeError",t)}})))};function s(){n||(n=!0,l(),e.close(),e=null)}const i=t=>{const n=new Error("probe error: "+t);n.transport=e.name,s(),this.emitReserved("upgradeError",n)};function o(){i("transport closed")}function a(){i("socket closed")}function c(t){e&&t.name!==e.name&&s()}const l=()=>{e.removeListener("open",r),e.removeListener("error",i),e.removeListener("close",o),this.off("close",a),this.off("upgrading",c)};e.once("open",r),e.once("error",i),e.once("close",o),this.once("close",a),this.once("upgrading",c),-1!==this._upgrades.indexOf("webtransport")&&"webtransport"!==t?this.setTimeoutFn((()=>{n||e.open()}),200):e.open()}onHandshake(t){this._upgrades=this._filterUpgrades(t.upgrades),super.onHandshake(t)}_filterUpgrades(t){const e=[];for(let n=0;n<t.length;n++)~this.transports.indexOf(t[n])&&e.push(t[n]);return e}}class bl extends vl{constructor(t,e={}){const n="object"==typeof t?t:e;(!n.transports||n.transports&&"string"==typeof n.transports[0])&&(n.transports=(n.transports||["polling","websocket","webtransport"]).map((t=>hl[t])).filter((t=>!!t))),super(t,n)}}const wl="function"==typeof ArrayBuffer,El=Object.prototype.toString,_l="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===El.call(Blob),Cl="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===El.call(File);function Tl(t){return wl&&(t instanceof ArrayBuffer||(t=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(t):t.buffer instanceof ArrayBuffer)(t))||_l&&t instanceof Blob||Cl&&t instanceof File}function Sl(t,e){if(!t||"object"!=typeof t)return!1;if(Array.isArray(t)){for(let e=0,n=t.length;e<n;e++)if(Sl(t[e]))return!0;return!1}if(Tl(t))return!0;if(t.toJSON&&"function"==typeof t.toJSON&&1===arguments.length)return Sl(t.toJSON(),!0);for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e)&&Sl(t[e]))return!0;return!1}function kl(t){const e=[],n=t.data,r=t;return r.data=xl(n,e),r.attachments=e.length,{packet:r,buffers:e}}function xl(t,e){if(!t)return t;if(Tl(t)){const n={_placeholder:!0,num:e.length};return e.push(t),n}if(Array.isArray(t)){const n=new Array(t.length);for(let r=0;r<t.length;r++)n[r]=xl(t[r],e);return n}if("object"==typeof t&&!(t instanceof Date)){const n={};for(const r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=xl(t[r],e));return n}return t}function Il(t,e){return t.data=Al(t.data,e),delete t.attachments,t}function Al(t,e){if(!t)return t;if(t&&!0===t._placeholder){if("number"==typeof t.num&&t.num>=0&&t.num<e.length)return e[t.num];throw new Error("illegal attachments")}if(Array.isArray(t))for(let n=0;n<t.length;n++)t[n]=Al(t[n],e);else if("object"==typeof t)for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&(t[n]=Al(t[n],e));return t}const Rl=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],Dl=5;var Nl;!function(t){t[t.CONNECT=0]="CONNECT",t[t.DISCONNECT=1]="DISCONNECT",t[t.EVENT=2]="EVENT",t[t.ACK=3]="ACK",t[t.CONNECT_ERROR=4]="CONNECT_ERROR",t[t.BINARY_EVENT=5]="BINARY_EVENT",t[t.BINARY_ACK=6]="BINARY_ACK"}(Nl||(Nl={}));class Ol{constructor(t){this.replacer=t}encode(t){return t.type!==Nl.EVENT&&t.type!==Nl.ACK||!Sl(t)?[this.encodeAsString(t)]:this.encodeAsBinary({type:t.type===Nl.EVENT?Nl.BINARY_EVENT:Nl.BINARY_ACK,nsp:t.nsp,data:t.data,id:t.id})}encodeAsString(t){let e=""+t.type;return t.type!==Nl.BINARY_EVENT&&t.type!==Nl.BINARY_ACK||(e+=t.attachments+"-"),t.nsp&&"/"!==t.nsp&&(e+=t.nsp+","),null!=t.id&&(e+=t.id),null!=t.data&&(e+=JSON.stringify(t.data,this.replacer)),e}encodeAsBinary(t){const e=kl(t),n=this.encodeAsString(e.packet),r=e.buffers;return r.unshift(n),r}}function Pl(t){return"[object Object]"===Object.prototype.toString.call(t)}class Ll extends $c{constructor(t){super(),this.reviver=t}add(t){let e;if("string"==typeof t){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");e=this.decodeString(t);const n=e.type===Nl.BINARY_EVENT;n||e.type===Nl.BINARY_ACK?(e.type=n?Nl.EVENT:Nl.ACK,this.reconstructor=new Ml(e),0===e.attachments&&super.emitReserved("decoded",e)):super.emitReserved("decoded",e)}else{if(!Tl(t)&&!t.base64)throw new Error("Unknown type: "+t);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");e=this.reconstructor.takeBinaryData(t),e&&(this.reconstructor=null,super.emitReserved("decoded",e))}}decodeString(t){let e=0;const n={type:Number(t.charAt(0))};if(void 0===Nl[n.type])throw new Error("unknown packet type "+n.type);if(n.type===Nl.BINARY_EVENT||n.type===Nl.BINARY_ACK){const r=e+1;for(;"-"!==t.charAt(++e)&&e!=t.length;);const s=t.substring(r,e);if(s!=Number(s)||"-"!==t.charAt(e))throw new Error("Illegal attachments");n.attachments=Number(s)}if("/"===t.charAt(e+1)){const r=e+1;for(;++e&&","!==t.charAt(e)&&e!==t.length;);n.nsp=t.substring(r,e)}else n.nsp="/";const r=t.charAt(e+1);if(""!==r&&Number(r)==r){const r=e+1;for(;++e;){const n=t.charAt(e);if(null==n||Number(n)!=n){--e;break}if(e===t.length)break}n.id=Number(t.substring(r,e+1))}if(t.charAt(++e)){const r=this.tryParse(t.substr(e));if(!Ll.isPayloadValid(n.type,r))throw new Error("invalid payload");n.data=r}return n}tryParse(t){try{return JSON.parse(t,this.reviver)}catch(t){return!1}}static isPayloadValid(t,e){switch(t){case Nl.CONNECT:return Pl(e);case Nl.DISCONNECT:return void 0===e;case Nl.CONNECT_ERROR:return"string"==typeof e||Pl(e);case Nl.EVENT:case Nl.BINARY_EVENT:return Array.isArray(e)&&("number"==typeof e[0]||"string"==typeof e[0]&&-1===Rl.indexOf(e[0]));case Nl.ACK:case Nl.BINARY_ACK:return Array.isArray(e)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class Ml{constructor(t){this.packet=t,this.buffers=[],this.reconPack=t}takeBinaryData(t){if(this.buffers.push(t),this.buffers.length===this.reconPack.attachments){const t=Il(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}function Fl(t,e,n){return t.on(e,n),function(){t.off(e,n)}}const Ul=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class Bl extends $c{constructor(t,e,n){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=t,this.nsp=e,n&&n.auth&&(this.auth=n.auth),this._opts=Object.assign({},n),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const t=this.io;this.subs=[Fl(t,"open",this.onopen.bind(this)),Fl(t,"packet",this.onpacket.bind(this)),Fl(t,"error",this.onerror.bind(this)),Fl(t,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected||(this.subEvents(),this.io._reconnecting||this.io.open(),"open"===this.io._readyState&&this.onopen()),this}open(){return this.connect()}send(...t){return t.unshift("message"),this.emit.apply(this,t),this}emit(t,...e){var n,r,s;if(Ul.hasOwnProperty(t))throw new Error('"'+t.toString()+'" is a reserved event name');if(e.unshift(t),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(e),this;const i={type:Nl.EVENT,data:e,options:{}};if(i.options.compress=!1!==this.flags.compress,"function"==typeof e[e.length-1]){const t=this.ids++,n=e.pop();this._registerAckCallback(t,n),i.id=t}const o=null===(r=null===(n=this.io.engine)||void 0===n?void 0:n.transport)||void 0===r?void 0:r.writable,a=this.connected&&!(null===(s=this.io.engine)||void 0===s?void 0:s._hasPingExpired());return this.flags.volatile&&!o||(a?(this.notifyOutgoingListeners(i),this.packet(i)):this.sendBuffer.push(i)),this.flags={},this}_registerAckCallback(t,e){var n;const r=null!==(n=this.flags.timeout)&&void 0!==n?n:this._opts.ackTimeout;if(void 0===r)return void(this.acks[t]=e);const s=this.io.setTimeoutFn((()=>{delete this.acks[t];for(let e=0;e<this.sendBuffer.length;e++)this.sendBuffer[e].id===t&&this.sendBuffer.splice(e,1);e.call(this,new Error("operation has timed out"))}),r),i=(...t)=>{this.io.clearTimeoutFn(s),e.apply(this,t)};i.withError=!0,this.acks[t]=i}emitWithAck(t,...e){return new Promise(((n,r)=>{const s=(t,e)=>t?r(t):n(e);s.withError=!0,e.push(s),this.emit(t,...e)}))}_addToQueue(t){let e;"function"==typeof t[t.length-1]&&(e=t.pop());const n={id:this._queueSeq++,tryCount:0,pending:!1,args:t,flags:Object.assign({fromQueue:!0},this.flags)};t.push(((t,...r)=>{if(n===this._queue[0])return null!==t?n.tryCount>this._opts.retries&&(this._queue.shift(),e&&e(t)):(this._queue.shift(),e&&e(null,...r)),n.pending=!1,this._drainQueue()})),this._queue.push(n),this._drainQueue()}_drainQueue(t=!1){if(!this.connected||0===this._queue.length)return;const e=this._queue[0];e.pending&&!t||(e.pending=!0,e.tryCount++,this.flags=e.flags,this.emit.apply(this,e.args))}packet(t){t.nsp=this.nsp,this.io._packet(t)}onopen(){"function"==typeof this.auth?this.auth((t=>{this._sendConnectPacket(t)})):this._sendConnectPacket(this.auth)}_sendConnectPacket(t){this.packet({type:Nl.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},t):t})}onerror(t){this.connected||this.emitReserved("connect_error",t)}onclose(t,e){this.connected=!1,delete this.id,this.emitReserved("disconnect",t,e),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach((t=>{if(!this.sendBuffer.some((e=>String(e.id)===t))){const e=this.acks[t];delete this.acks[t],e.withError&&e.call(this,new Error("socket has been disconnected"))}}))}onpacket(t){if(t.nsp===this.nsp)switch(t.type){case Nl.CONNECT:t.data&&t.data.sid?this.onconnect(t.data.sid,t.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case Nl.EVENT:case Nl.BINARY_EVENT:this.onevent(t);break;case Nl.ACK:case Nl.BINARY_ACK:this.onack(t);break;case Nl.DISCONNECT:this.ondisconnect();break;case Nl.CONNECT_ERROR:this.destroy();const e=new Error(t.data.message);e.data=t.data.data,this.emitReserved("connect_error",e)}}onevent(t){const e=t.data||[];null!=t.id&&e.push(this.ack(t.id)),this.connected?this.emitEvent(e):this.receiveBuffer.push(Object.freeze(e))}emitEvent(t){if(this._anyListeners&&this._anyListeners.length){const e=this._anyListeners.slice();for(const n of e)n.apply(this,t)}super.emit.apply(this,t),this._pid&&t.length&&"string"==typeof t[t.length-1]&&(this._lastOffset=t[t.length-1])}ack(t){const e=this;let n=!1;return function(...r){n||(n=!0,e.packet({type:Nl.ACK,id:t,data:r}))}}onack(t){const e=this.acks[t.id];"function"==typeof e&&(delete this.acks[t.id],e.withError&&t.data.unshift(null),e.apply(this,t.data))}onconnect(t,e){this.id=t,this.recovered=e&&this._pid===e,this._pid=e,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach((t=>this.emitEvent(t))),this.receiveBuffer=[],this.sendBuffer.forEach((t=>{this.notifyOutgoingListeners(t),this.packet(t)})),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach((t=>t())),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:Nl.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(t){return this.flags.compress=t,this}get volatile(){return this.flags.volatile=!0,this}timeout(t){return this.flags.timeout=t,this}onAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(t),this}prependAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(t),this}offAny(t){if(!this._anyListeners)return this;if(t){const e=this._anyListeners;for(let n=0;n<e.length;n++)if(t===e[n])return e.splice(n,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(t),this}prependAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(t),this}offAnyOutgoing(t){if(!this._anyOutgoingListeners)return this;if(t){const e=this._anyOutgoingListeners;for(let n=0;n<e.length;n++)if(t===e[n])return e.splice(n,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(t){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const e=this._anyOutgoingListeners.slice();for(const n of e)n.apply(this,t.data)}}}function Vl(t){t=t||{},this.ms=t.min||100,this.max=t.max||1e4,this.factor=t.factor||2,this.jitter=t.jitter>0&&t.jitter<=1?t.jitter:0,this.attempts=0}Vl.prototype.duration=function(){var t=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),n=Math.floor(e*this.jitter*t);t=1&Math.floor(10*e)?t+n:t-n}return 0|Math.min(t,this.max)},Vl.prototype.reset=function(){this.attempts=0},Vl.prototype.setMin=function(t){this.ms=t},Vl.prototype.setMax=function(t){this.max=t},Vl.prototype.setJitter=function(t){this.jitter=t};class ql extends $c{constructor(t,n){var r;super(),this.nsps={},this.subs=[],t&&"object"==typeof t&&(n=t,t=void 0),(n=n||{}).path=n.path||"/socket.io",this.opts=n,Qc(this,n),this.reconnection(!1!==n.reconnection),this.reconnectionAttempts(n.reconnectionAttempts||1/0),this.reconnectionDelay(n.reconnectionDelay||1e3),this.reconnectionDelayMax(n.reconnectionDelayMax||5e3),this.randomizationFactor(null!==(r=n.randomizationFactor)&&void 0!==r?r:.5),this.backoff=new Vl({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==n.timeout?2e4:n.timeout),this._readyState="closed",this.uri=t;const s=n.parser||e;this.encoder=new s.Encoder,this.decoder=new s.Decoder,this._autoConnect=!1!==n.autoConnect,this._autoConnect&&this.open()}reconnection(t){return arguments.length?(this._reconnection=!!t,t||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(t){return void 0===t?this._reconnectionAttempts:(this._reconnectionAttempts=t,this)}reconnectionDelay(t){var e;return void 0===t?this._reconnectionDelay:(this._reconnectionDelay=t,null===(e=this.backoff)||void 0===e||e.setMin(t),this)}randomizationFactor(t){var e;return void 0===t?this._randomizationFactor:(this._randomizationFactor=t,null===(e=this.backoff)||void 0===e||e.setJitter(t),this)}reconnectionDelayMax(t){var e;return void 0===t?this._reconnectionDelayMax:(this._reconnectionDelayMax=t,null===(e=this.backoff)||void 0===e||e.setMax(t),this)}timeout(t){return arguments.length?(this._timeout=t,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()}open(t){if(~this._readyState.indexOf("open"))return this;this.engine=new bl(this.uri,this.opts);const e=this.engine,n=this;this._readyState="opening",this.skipReconnect=!1;const r=Fl(e,"open",(function(){n.onopen(),t&&t()})),s=e=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",e),t?t(e):this.maybeReconnectOnOpen()},i=Fl(e,"error",s);if(!1!==this._timeout){const t=this._timeout,n=this.setTimeoutFn((()=>{r(),s(new Error("timeout")),e.close()}),t);this.opts.autoUnref&&n.unref(),this.subs.push((()=>{this.clearTimeoutFn(n)}))}return this.subs.push(r),this.subs.push(i),this}connect(t){return this.open(t)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const t=this.engine;this.subs.push(Fl(t,"ping",this.onping.bind(this)),Fl(t,"data",this.ondata.bind(this)),Fl(t,"error",this.onerror.bind(this)),Fl(t,"close",this.onclose.bind(this)),Fl(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(t){try{this.decoder.add(t)}catch(t){this.onclose("parse error",t)}}ondecoded(t){zc((()=>{this.emitReserved("packet",t)}),this.setTimeoutFn)}onerror(t){this.emitReserved("error",t)}socket(t,e){let n=this.nsps[t];return n?this._autoConnect&&!n.active&&n.connect():(n=new Bl(this,t,e),this.nsps[t]=n),n}_destroy(t){const e=Object.keys(this.nsps);for(const t of e)if(this.nsps[t].active)return;this._close()}_packet(t){const e=this.encoder.encode(t);for(let n=0;n<e.length;n++)this.engine.write(e[n],t.options)}cleanup(){this.subs.forEach((t=>t())),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(t,e){var n;this.cleanup(),null===(n=this.engine)||void 0===n||n.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",t,e),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const t=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const e=this.backoff.duration();this._reconnecting=!0;const n=this.setTimeoutFn((()=>{t.skipReconnect||(this.emitReserved("reconnect_attempt",t.backoff.attempts),t.skipReconnect||t.open((e=>{e?(t._reconnecting=!1,t.reconnect(),this.emitReserved("reconnect_error",e)):t.onreconnect()})))}),e);this.opts.autoUnref&&n.unref(),this.subs.push((()=>{this.clearTimeoutFn(n)}))}}onreconnect(){const t=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",t)}}const jl={};function $l(t,e){"object"==typeof t&&(e=t,t=void 0);const n=function(t,e="",n){let r=t;n=n||"undefined"!=typeof location&&location,null==t&&(t=n.protocol+"//"+n.host),"string"==typeof t&&("/"===t.charAt(0)&&(t="/"===t.charAt(1)?n.protocol+t:n.host+t),/^(https?|wss?):\/\//.test(t)||(t=void 0!==n?n.protocol+"//"+t:"https://"+t),r=pl(t)),r.port||(/^(http|ws)$/.test(r.protocol)?r.port="80":/^(http|ws)s$/.test(r.protocol)&&(r.port="443")),r.path=r.path||"/";const s=-1!==r.host.indexOf(":")?"["+r.host+"]":r.host;return r.id=r.protocol+"://"+s+":"+r.port+e,r.href=r.protocol+"://"+s+(n&&n.port===r.port?"":":"+r.port),r}(t,(e=e||{}).path||"/socket.io"),r=n.source,s=n.id,i=n.path,o=jl[s]&&i in jl[s].nsps;let a;return e.forceNew||e["force new connection"]||!1===e.multiplex||o?a=new ql(r,e):(jl[s]||(jl[s]=new ql(r,e)),a=jl[s]),n.query&&!e.query&&(e.query=n.queryKey),a.socket(n.path,e)}Object.assign($l,{Manager:ql,Socket:Bl,io:$l,connect:$l});const zl=new class{constructor(t){this.url=t||"https://panel.taskomatic.net".replace("http","ws"),this.socket=null,this.credentials=null}connect(t=null){Zl("WEBSOCKET","Connecting to server",this.url);const e=t||vu.credentials;if(!e)return Zl("ERROR","No authentication credentials available for WebSocket connection"),!1;this.credentials=e,this.socket=$l(this.url,{withCredentials:!0}),this.socket.on("connect",(async()=>{Zl("WEBSOCKET","Socket.IO connected");const t=await(async t=>{if(Zl("PostElement","%c 🔍 Starting post element search...","color: #4287f5; font-weight: bold;"),!(t||(t=getPostById(Ql.state.currentPost))&&t.post))return console.error("❌ Post not found in state or by ID"),null;const e=t.post.trim(),n=e.replace(/\s+/g," ");Zl("PostElement",`🔍 Looking for post with text: "${e.substring(0,50)}${e.length>50?"...":""}"`);const r=(t,e)=>{if(!t||!t.textContent)return!1;const n=t.textContent.trim().replace(/\s+/g," ");return e.length<100?n.includes(e):(e.length>n.length?n.length/e.length:e.length/n.length)>=.8||n.includes(e)||e.includes(n)},s=t=>!!t&&(!!t.querySelector('div[aria-label*="Like"]')||!!t.querySelector('div[aria-label*="Comment"]')||!!t.querySelector('div[aria-label*="Share"]')||!!t.querySelector('div[aria-label*="אהבתי"]')||!!t.querySelector('div[aria-label*="תגובה"]')||!!t.querySelector('div[aria-label*="שיתוף"]')||!!t.querySelector('a[href*="/posts/"]')||!!t.querySelector('a[href*="/permalink/"]')||!!t.querySelector('span[id][title*=":"]')||t.classList.contains("userContentWrapper")||t.classList.contains("_5pcr")||t.classList.contains("_1dwg"));Zl("PostElement","🔍 Searching for feed containers in the page...");const i=Array.from(document.querySelectorAll('div[role="feed"]'));if(Zl("PostElement",`📊 Found ${i.length} feed containers`),i.length>0)for(const t of i){const e=Array.from(t.children);Zl("PostElement",`📊 Checking ${e.length} direct children of feed container`);for(const i of e){if(r(i,n)){if(Zl("PostElement","✅ Found direct child with matching text:",i),i===t)continue;if(s(i)||"article"===i.getAttribute("role"))return Zl("PostElement","✅ Found post container as direct child of feed:",i),i;const e=i.querySelector('[role="article"]')||Array.from(i.querySelectorAll("*")).find(s);return e?(Zl("PostElement","✅ Found post container within matching child:",e),e):i}const e=i.querySelector('*:not([role="feed"])');if(e&&r(e,n)){Zl("PostElement","✅ Found element with matching text inside child:",e);const n=e.closest('[role="article"]')||i.querySelector('[role="article"]')||Array.from(i.querySelectorAll("*")).find(s);return n&&n!==t?(Zl("PostElement","✅ Found post container containing text element:",n),n):(Zl("PostElement","⚠️ No specific post container found, returning feed's child:",i),i)}}}Zl("PostElement","🔍 No direct feed children contained the post, trying broader search...");const o=Array.from(document.body.querySelectorAll('*:not([role="feed"])')).filter((t=>r(t,n)));if(o.length>0){Zl("PostElement",`📊 Found ${o.length} elements with matching text`);const t=o[0];Zl("PostElement","✅ Found element with matching text (broader search):",t);const e=t.closest('[role="feed"]');if(e){let n=t;for(;n&&n.parentElement!==e;)n=n.parentElement;if(n)return Zl("PostElement","✅ Found direct child of feed containing match:",n),n}const n=t.closest('[role="article"]')||Array.from(t.parentElement.querySelectorAll("*")).find(s);return n?(Zl("PostElement","✅ Found post container for matching element:",n),n):t}if(e.length>20){const t=e.substring(0,20),n=Array.from(document.body.querySelectorAll('*:not([role="feed"])')).filter((e=>e.textContent&&e.textContent.includes(t)));if(n.length>0){Zl("PostElement",`📊 Found ${n.length} elements with partial text matches`);const t=n[0],e=t.closest('[role="feed"]');if(e){let n=t;for(;n&&n.parentElement!==e;)n=n.parentElement;if(n)return Zl("PostElement","⚠️ Found feed child with partial match:",n),n}return Zl("PostElement","⚠️ Using first partial match as fallback:",t),t}}return Zl("PostElement","❌ Could not find any post element matching the text"),null})({post:"כה עזרה. איך"});if(t){Zl("WEBSOCKET","Successfully found post element",t);const e=await(async t=>{if(Zl("PostUrl","🔍 Starting post URL search..."),!t||!t.nodeType)return Zl("PostUrl","❌ Invalid postElement provided"),!1;Zl("PostUrl","🔍 Looking for share button...");const e=["Share","Send this to friends or post it on your profile","שיתוף","שתף"];let n=null;for(const r of e){const e=t.querySelectorAll(`[aria-label*="${r}"][role="button"]`);if(e.length>0){n=e[0],Zl("PostUrl","✅ Found share button with aria-label: "+r);break}}if(!n){Zl("PostUrl","🔍 Looking for share button by content structure...");const e=Array.from(t.querySelectorAll('[role="button"]')).filter((t=>{const e=t.textContent&&(t.textContent.toLowerCase().includes("share")||t.textContent.toLowerCase().includes("שיתוף")),n=t.querySelector("i, svg");return e&&n}));e.length>0&&(n=e[0],Zl("PostUrl","✅ Found share button via content structure"))}if(!n){const e=Array.from(t.querySelectorAll("div")).filter((t=>{const e=t.querySelectorAll('[role="button"]');return e.length>=3&&e.length<=5}));for(const t of e){const e=t.querySelectorAll('[role="button"]'),r=[e[e.length-1],e[e.length-2]].filter(Boolean);for(const t of r)if(t&&(t.textContent.toLowerCase().includes("share")||t.textContent.toLowerCase().includes("שיתוף"))){n=t,Zl("PostUrl","✅ Found share button in engagement area");break}if(n)break}}if(!n)return Zl("PostUrl","❌ Could not find share button"),!1;try{Zl("PostUrl","👆 Clicking share button..."),n.click(),await iu(1),Zl("PostUrl","🔍 Looking for copy link option..."),await iu(.5);const t=["Copy link","העתק קישור","העתקת קישור"];let e=null;Zl("PostUrl","🔍 Looking for copy link button with specific structure...");const r=document.querySelectorAll('div[role="listitem"]');for(const t of r)if(t.textContent&&(t.textContent.includes("Copy link")||t.textContent.includes("העתק קישור"))){const n=t.querySelector('div[role="button"]');if(n){e=n,await iu(.5),Zl("PostUrl","✅ Found copy link button with exact matching structure");break}}if(!e)for(const n of t){const t=document.querySelectorAll(`[aria-label*="${n}"]`);if(t.length>0){e=t[0],Zl("PostUrl",`✅ Found copy link button with aria-label: ${n}`);break}}if(!e){const t=document.querySelector('div[role="dialog"]');if(t){const n=t.querySelectorAll('[role="menuitem"], [role="button"], [role="listitem"]');for(const t of n)if(t.textContent&&(t.textContent.includes("Copy link")||t.textContent.includes("העתק קישור"))){e=t.querySelector('[role="button"]')||t,Zl("PostUrl","✅ Found copy link button via text content in dialog"),await iu(.5);break}if(!e){const n=t.querySelectorAll('i[data-visualcompletion="css-img"]');for(const t of n){const n=t.closest('[role="button"]');if(n){e=n,Zl("PostUrl","✅ Found copy link button via icon in dialog"),await iu(.5);break}}}}}if(!e){const t=document.querySelector('div[aria-label="Close"], div[aria-label="סגירה"], div[aria-label="סגור"]');return t&&t.click(),Zl("PostUrl","❌ Could not find copy link button in dialog"),!1}Zl("PostUrl","🔍 Examining copy link button structure...");let s=e;if(s&&s.style){s.style.backgroundColor="lightgreen",Zl("PostUrl","🎨 Highlighted clickable element"),await iu(4),Zl("PostUrl","👆 Clicking copy link button...",s);let t=null;const e=document.querySelector('div[role="dialog"]');if(e){const n=e.querySelector('input[type="text"], input[readonly]');n&&n.value&&n.value.includes("facebook.com")&&(t=n.value,Zl("PostUrl",`✅ Extracted URL from input field: ${t}`))}if(t){const e=document.querySelector('div[aria-label="Close"], div[aria-label="סגירה"], div[aria-label="סגור"]');return e&&e.click(),t}await iu(.3)}Zl("PostUrl","🔍 Preparing document for clipboard operation..."),await iu(.2),Zl("PostUrl","⏳ Waiting for clipboard operation to complete..."),await iu(1);try{const t=await navigator.clipboard.readText();if(Zl("PostUrl","📋 Attempting to read from clipboard...",t),t&&"string"==typeof t&&t.length<1e3){if(t.startsWith("http")&&t.includes("facebook.com")){Zl("PostUrl",`📋 URL: ${t}`);const e=document.querySelector('div[aria-label="Close"], div[aria-label="סגירה"], div[aria-label="סגור"]');return e&&e.click(),t}Zl("PostUrl","⚠️ Clipboard content doesn't appear to be a Facebook URL")}else Zl("PostUrl","⚠️ Invalid clipboard content");const e=document.querySelector('div[role="dialog"]');if(e){Zl("PostUrl","🔍 Looking for URL in dialog elements...");const t=e.querySelectorAll('a[href*="facebook.com"]');Zl("PostUrl",`🔍 Found ${t.length} potential link elements`);for(const e of t){const t=e.getAttribute("href");if(Zl("PostUrl",`🔗 Checking link: ${t}`),t&&t.includes("/share/")){Zl("PostUrl",`✅ Found URL: ${t}`);const e=document.querySelector('div[aria-label="Close"], div[aria-label="סגירה"], div[aria-label="סגור"]');return e&&e.click(),t}}Zl("PostUrl","❌ No valid Facebook URLs found in dialog elements")}Zl("PostUrl","🔍 Checking for data attributes containing URL...");const n=document.querySelectorAll("[data-store]");for(const t of n)try{const e=JSON.parse(t.getAttribute("data-store"));if(e&&e.share_link){Zl("PostUrl",`✅ Found URL in data-store: ${e.share_link}`);const t=document.querySelector('div[aria-label="Close"], div[aria-label="סגירה"], div[aria-label="סגור"]');return t&&t.click(),e.share_link}}catch(t){}const r=document.querySelector('div[aria-label="Close"], div[aria-label="סגירה"], div[aria-label="סגור"]');return r&&r.click(),t&&t.startsWith("http")?t:(Zl("PostUrl","❌ Could not find valid URL"),!1)}catch(t){Zl("PostUrl","⚠️ Clipboard access error",t),Zl("PostUrl",'🔍 Looking for "Link copied" toast notification...');const e=document.querySelectorAll(".x9f619, .xnz67gz, .x78zum5");for(const t of e)if(t.textContent&&(t.textContent.includes("Link copied")||t.textContent.includes("הקישור הועתק"))){Zl("PostUrl",'✅ "Link copied" toast notification detected');const t=document.querySelector('div[aria-label="Close"], div[aria-label="סגירה"], div[aria-label="סגור"]');t&&t.click();const e=window.location.href;return Zl("PostUrl",`📄 Current page URL: ${e}`),!0}const n=document.querySelector('div[aria-label="Close"], div[aria-label="סגירה"], div[aria-label="סגור"]');return n&&n.click(),Zl("PostUrl","❌ Could not access clipboard and no fallback found"),!1}}catch(t){const e=document.querySelector('div[aria-label="Close"], div[aria-label="סגירה"], div[aria-label="סגור"]');return e&&e.click(),Zl("PostUrl","❌ Error getting post URL"),!1}})(t);Zl("WEBSOCKET","Post URL:",e)}this.socket.emit("connect_frontend",{...this.credentials}),Zl("WEBSOCKET","Sent frontend connection credentials to server")})),this.socket.on("post_updated",(async t=>{Zl("WEBSOCKET","Received post update notification from server",t);try{if(Ql.state.isProcessing)return void Zl("WEBSOCKET","Currently processing a post, ignoring new post");const e=t.post||t;if(!e||!e.id)return void Zl("ERROR","Invalid post data received from server",e);Zl("WEBSOCKET","Clearing state before processing new post"),await Ql.clearState(),await iu(eu.PROCESS_DELAY),Zl("WEBSOCKET",`Received post ${e.id} for execution`,e),Ql.state.posts=[e],Ql.state.currentPost=e.id,Ql.saveState(),await nu(),await iu(1),Zl("WEBSOCKET","Starting post execution"),await Ql.executeCurrentPost()}catch(t){Zl("ERROR",`Error handling post update: ${t.message}`),Ql.state.isProcessing&&(Ql.state.isProcessing=!1,Ql.saveState())}})),this.socket.on("UI_text",(async t=>{Zl("WEBSOCKET","Received banner message from server",t),await nu(void 0,t),await iu(2)})),this.socket.on("error",(t=>{Zl("ERROR",`Socket error: ${t.message||t}`)})),this.socket.on("disconnect",(()=>{Zl("WEBSOCKET","Socket.IO disconnected"),setTimeout((()=>{this.socket?.disconnected&&(Zl("WEBSOCKET","Attempting to reconnect..."),this.socket.connect())}),5e3)}))}async sendGroupFulfillment(t,e,n=!0,r=""){return this.socket&&this.socket.connected?(Ql.state.isProcessing=!1,Ql.state.fulfilled.includes(e)||Ql.state.fulfilled.push(e),Ql.saveState(),await iu(10),Zl("WEBSOCKET",`Sending set_full_field for post=${t}, group=${e}`),this.socket.emit("set_full_field",{postId:t,groupId:e,success:n,message:r,...vu.credentials}),!0):(Zl("ERROR","Cannot send fulfillment: WebSocket not connected"),!1)}disconnect(){Zl("WEBSOCKET","Disconnecting WebSocket"),this.socket&&(this.socket.removeAllListeners(),this.socket.disconnect(),Zl("WEBSOCKET","WebSocket disconnected"))}},Kl=(t,e,n=null)=>{(new Date).toISOString().split("T")[1].split(".")[0]},Hl="FB_AUTO_POST_STATE",Gl=Boolean("1:294202424004:web:48a4b30eb4c56af7d8e791");class Wl{static instance=null;constructor(){if(Wl.instance)return Wl.instance;Gl&&(Wl.instance=this,this.state=this.loadState()||this.getInitialState())}async initialize(){return Kl(),vu.isLoggedIn()?(window.wsClient=zl,zl.connect(vu.credentials),this.state.isProcessing?(Kl(0,0,{currentPost:this.state.currentPost}),await iu(2),await this.resumeQueue()):this.state.posts.length>0&&this.state.currentPost?(Kl(0,this.state.currentPost,this.state.posts[0]),await iu(2),await this.executeCurrentPost()):(Kl(),await nu(),!0)):(Kl(),!1)}getInitialState(){return{posts:[],currentPost:null,groupIndex:0,fulfilled:[],lastPostTime:null,isProcessing:!1,lastSuccessfulPost:null,errors:[],retryCount:0}}loadState(){Kl();const t=sessionStorage.getItem(Hl),e=t?JSON.parse(t):this.getInitialState();return Kl(0,0,e),e}saveState(){Kl(0,0,this.state),sessionStorage.setItem(Hl,JSON.stringify(this.state))}async clearState(){Kl(),sessionStorage.removeItem(Hl),this.state=this.getInitialState()}async resumeQueue(){Kl();const t=au(this.state.currentPost);return t?(Kl(0,t.id,t),await iu(2),await this.executePost(t)):(Kl(),this.clearState(),await nu(),!0)}async executeCurrentPost(){if(!this.state.posts.length)return Kl(),await this.clearState(),await nu(),!0;const t=this.state.posts[0];return Kl(0,t.post?.slice(0,20)),await nu(),await iu(2),this.state.isProcessing=!0,this.state.fulfilled=[],this.saveState(),await iu(.3),await this.executePost(t)}async executePost(t){try{Kl(0,(t.id,t.groups));const e=await Eu(t);return await iu(2),e?(Kl(0,t.id),this.state.lastPostTime=(new Date).toISOString(),this.state.lastSuccessfulPost=t.id,this.state.currentPost=null,this.state.isProcessing=!1,this.state.groupIndex=0,this.state.posts=[],this.saveState(),Kl(),await nu(),!0):(Kl(0,t.id),this.state.isProcessing=!1,this.saveState(),!1)}catch(t){return Kl(0,t.message),this.state.isProcessing=!1,this.saveState(),!1}}async reportGroupFulfilled(t,e,n=!0,r=""){return await zl.sendGroupFulfillment(t,e,n,r)}cleanup(){Kl(),this.clearState(),this.state=this.getInitialState(),Kl()}}const Ql=new Wl,Yl="https://panel.taskomatic.net",Xl={apiKey:"MISSING_ENV_VAR".FIREBASE_API_KEY,authDomain:"taskomaticstock.firebaseapp.com",projectId:"taskomaticstock",storageBucket:"taskomaticstock.firebasestorage.app",messagingSenderId:"294202424004",appId:"1:294202424004:web:48a4b30eb4c56af7d8e791"},Jl=function(t){const e="string"==typeof t?t:"(default)",n=function(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}("object"==typeof t?t:function(t=vt){const e=wt.get(t);if(!e&&t===vt&&a())return xt();if(!e)throw St.create("no-app",{appName:t});return e}(),"firestore").getImmediate({identifier:e});if(!n._initialized){const t=(t=>{const e=(t=>{var e,n;return null===(n=null===(e=o())||void 0===e?void 0:e.emulatorHosts)||void 0===n?void 0:n[t]})(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(n+1),10);return"["===e[0]?[e.substring(1,n-1),r]:[e.substring(0,n),r]})("firestore");t&&function(t,e,n,r={}){var s;const o=(t=Fa(t,Ba))._getSettings(),a=`${e}:${n}`;if("firestore.googleapis.com"!==o.host&&o.host!==a&&ie("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),t._setSettings(Object.assign(Object.assign({},o),{host:a,ssl:!1})),r.mockUserToken){let e,n;if("string"==typeof r.mockUserToken)e=r.mockUserToken,n=Zt.MOCK_USER;else{e=function(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=e||"demo-project",r=t.iat||0,s=t.sub||t.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},t);return[i(JSON.stringify({alg:"none",type:"JWT"})),i(JSON.stringify(o)),""].join(".")}(r.mockUserToken,null===(s=t._app)||void 0===s?void 0:s.options.projectId);const o=r.mockUserToken.sub||r.mockUserToken.user_id;if(!o)throw new he(ue.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new Zt(o)}t._authCredentials=new ge(new fe(e,n))}}(n,...t)}return n}(xt(Xl)),Zl=(t,e,n=null)=>{const r=(new Date).toISOString().split("T")[1].split(".")[0],s="WEBSOCKET"===t?"background:rgb(91, 6, 3); color: white; padding: 2px 6px; border-radius: 4px; font-weight: bold;":"background:rgb(44, 80, 63); color: white; padding: 2px 6px; border-radius: 4px; font-weight: bold;";console.log(`%c[${t}]%c [${r}] ${e}`,s,"color:rgb(110, 165, 197); font-weight: bold;"),n&&eu.DEBUG_MODE&&console.log("→ Details:",n)},tu=async()=>{console.log("Creating postomatic banner");const t=document.createElement("div");t.id="notificationBannerPostomatic",Object.assign(t.style,{position:"fixed",bottom:"50px",right:"10px",padding:"20px 30px",minWidth:"25vw",maxWidth:"88vw",backgroundColor:"#1abc9c",borderRadius:"5px",zIndex:"1001",display:"flex",justifyContent:"space-between",backgroundImage:"linear-gradient(135deg, #2c3e50, #4ca1af)",color:"white",border:"1px solid gray",boxShadow:"0 0 10px rgba(0, 0, 0, 0.5)",borderRadius:"12px",width:"fill-available",alignItems:"center",direction:"rtl"});const e=document.createElement("span");e.textContent="⊗",Object.assign(e.style,{position:"absolute",color:"white",padding:"4px",top:"2px",right:"2px",cursor:"pointer",fontSize:"18px",zIndex:"1002"}),e.onmouseover=()=>{e.style.opacity="0.5"},e.onmouseout=()=>{e.style.opacity="1"},e.onclick=async()=>(document.body.contains(t)&&document.body.removeChild(t),ou(),console.log("%c +++ Script execution finished! 🚀 +++ ","font-weight: bold; font-size: 16px; padding: 8px 15px; background-image: linear-gradient(45deg, #ff4500, #ff8c00); border-radius: 25px; color: black ; text-shadow: 2px 2px 4px rgba(45, 21, 47, 0.3)"),!0),t.appendChild(e);const n=document.createElement("img");n.src=chrome.runtime.getURL("icons/icon.png"),n.style.width="30px",n.style.height="30px",n.style.margin="auto 10px",t.appendChild(n);const r=document.createElement("div");r.id="stateInfoPostomatic",Object.assign(r.style,{marginRight:"10px",marginLeft:"10px",direction:"rtl",textAlign:"start",fontSize:"15px",color:"white",direction:"rtl"}),await nu(r);const s=document.createElement("div");Object.assign(s.style,{display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",padding:"8px 12px",flex:"0 0 auto",width:"fit-content",borderRadius:"8px",marginRight:"15px",border:"1px solid rgba(224, 187, 149, 0.37)",transition:"background-color 0.3s"}),s.innerHTML='\n      <svg style="width:16px;height:16px;margin-left:6px" viewBox="0 0 24 24">\n        <path fill="white" d="M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z" />\n      </svg>\n      <span style="color:white;font-size:13px">פוסט חדש</span>\n    ',s.onmouseover=()=>{s.style.backgroundColor="rgba(255,255,255,0.1)"},s.onmouseout=()=>{s.style.backgroundColor="transparent"},s.onclick=()=>{window.open("https://panel.taskomatic.net/login","_blank")};const i=await lu(t),o=document.createElement("div");Object.assign(o.style,{display:"flex",alignItems:"start",flexDirection:"column",gap:"10px"}),o.appendChild(s),o.appendChild(i),t.appendChild(r),t.appendChild(o),document.body.appendChild(t)},eu={PROCESS_DELAY:2,DEBUG_MODE:!0},nu=async(t,e)=>{Zl("BANNER","Updating banner UI");const n=t||document.querySelector("#stateInfoPostomatic");if(!n)return;const r=Ql.state,s=au(r.currentPost),i=au(r.lastSuccessfulPost),o=s?s.groups.map((t=>t.groupName)):null,a=s?s?.post?.substring(0,45)+"...":null,c=i?i.post?.substring(0,45)+"...":null,l=r.errors?.slice(-2)||[];n.innerHTML='\n    <div style="display: flex; justify-content: center; gap: 8px; align-items: center;">\n      <div class="spinner" style="width: 18px; height: 18px; border: 3px solid #fff; border-top-color: transparent; border-radius: 50%; animation: spin 1s linear infinite;"></div>\n      <div style="margin-right: 10px; color: white;">טוען...</div>\n      <style>\n        @keyframes spin {\n          0% { transform: rotate(0deg); }\n          100% { transform: rotate(360deg); }\n        }\n      </style>\n    </div>\n    ';const u="\n    <style>\n      #stateInfoPostomatic div {\n        margin: 5px 0;\n        color: rgba(255, 255, 255, 0.85);\n        width: fit-content;\n      }\n      #stateInfoPostomatic div>b {\n        color:rgb(255, 255, 255) !important;\n      }\n    </style>\n    ";if(await iu(1),e){const t=/\*\*(\d+(?:\.\d+)?)\*\*/,r=e.match(t);if(r){let t=Math.max(1,Math.round(parseFloat(r[1])));const s=r[0];let i=e.replace(s,t);n.innerHTML=`\n          ${u}\n          <div style="display: flex; justify-content: center; align-items: center;">\n          <pre style="color: white;">${i}</pre>\n          </div>\n        `;const o=su.setInterval((()=>{t-=1,i=e.replace(s,t),n.innerHTML=`\n          ${u}\n          <div style="display: flex; justify-content: center; align-items: center;">\n            <pre style="color: white;">${i}</pre>\n          </div>\n          `,t<=0&&(clearInterval(o),su.intervals.delete(o))}),1e3);return}n.innerHTML=`\n      ${u}\n      <div style="display: flex; justify-content: center; align-items: center;">\n        <pre style="color: white;">${e}</pre>\n      </div>\n      `}else if(s||r.isProcessing){if(r.isProcessing){const t=(t=[])=>`\n        <style>\n        .group-buttons {\n          display: flex;\n          align-items: center;\n          justify-content: start;\n          gap: 4px;\n          flex-wrap: wrap;\n          width: fit-content;\n          max-height: 150px;\n          overflow-y: auto;\n          overflow-x: hidden;\n        }\n        .group-buttons span {\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          flex-wrap: nowrap;\n          cursor: pointer;\n          padding: 4px 8px;\n          flex: 0 0 auto;\n          width: fit-content;\n          border-radius: 20px;\n          border: 1px solid rgba(224, 187, 149, 0.37);\n          transition: background-color 0.3s;\n          background-color: rgba(0, 0, 0, 0.1);\n          color: white;\n          font-size: 10px;\n        }\n        .group-buttons span:hover {\n          background-color: rgba(255, 255, 255, 0.1);\n        }\n        </style>\n        <div class="group-buttons">\n        ${t.map((t=>`\n          <span>${t}</span>`)).join("")}\n        </div>\n      `;n.innerHTML=`\n        ${u}\n        ${a?`<div><b>הפוסט הנוכחי: </b> ${a}</div>`:""}\n        ${o?`<div style="display: block;"><b>לקבוצות: </b> ${t(o)}</div>`:""}\n        ${c?`<div><b>פוסט קודם: </b> ${c}</div>`:""}\n        ${l.map((t=>`<div style="color: #ff6b6b">Error: ${t.message}</div>`)).slice(0,3)?.join("")}\n      `}else{const t=(t=[])=>`\n        <style>\n        .group-buttons {\n          display: flex;\n          align-items: center;\n          justify-content: start;\n          gap: 4px;\n          flex-wrap: wrap;\n          width: fit-content;\n          max-height: 150px;\n          overflow-y: auto;\n          overflow-x: hidden;\n        }\n        .group-buttons span {\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          flex-wrap: nowrap;\n          cursor: pointer;\n          padding: 4px 8px;\n          flex: 0 0 auto;\n          width: fit-content;\n          border-radius: 20px;\n          border: 1px solid rgba(224, 187, 149, 0.37);\n          transition: background-color 0.3s;\n          background-color: rgba(0, 0, 0, 0.1);\n          color: white;\n          font-size: 10px;\n        }\n        .group-buttons span:hover {\n          background-color: rgba(255, 255, 255, 0.1);\n        }\n        </style>\n        <div class="group-buttons">\n        ${t.map((t=>`\n          <span>${t}</span>`)).join("")}\n        </div>\n      `;n.innerHTML=`\n        ${u}\n        ${a?`<div><b>הפוסט הבא: </b> ${a}</div>`:""}\n        ${o?`<div style="display: block;"><b>לקבוצות: </b> ${t(o)}</div>`:""}\n        ${c?`<div><b>פוסט קודם: </b> ${c}</div>`:""}\n        ${l.map((t=>`<div style="color: #ff6b6b">Error: ${t.message}</div>`)).slice(0,3)?.join("")}\n      `}n.innerHTML+=u}else n.innerHTML=`\n       ${u}\n       <div style="display: flex; justify-content: center; align-items: center;">\n        <div style="color: white;"><b>מחכה לפוסט הבא מהשרת</b></div>\n       </div>\n       ${c?`<div><b>פוסט אחרון: </b> ${c}</div>`:""}\n       ${l.map((t=>`<div style="color: #ff6b6b">Error: ${t.message}</div>`)).slice(0,3)?.join("")}\n      `},ru={controller:new AbortController,signal:null,initialize(){this.controller=new AbortController,this.signal=this.controller.signal,Zl("FETCH","Fetch controller initialized")},abort(){Zl("FETCH","Aborting all pending fetch requests"),this.controller.abort(),this.initialize()}};ru.initialize();const su={timeouts:new Set,intervals:new Set,setTimeout(t,e){const n=setTimeout((()=>{this.timeouts.delete(n),t()}),e);return this.timeouts.add(n),n},setInterval(t,e){const n=setInterval(t,e);return this.intervals.add(n),n},clearAll(){Zl("CLEANUP",`Clearing ${this.timeouts.size} timeouts and ${this.intervals.size} intervals`),this.timeouts.forEach((t=>{clearTimeout(t)})),this.timeouts.clear(),this.intervals.forEach((t=>{clearInterval(t)})),this.intervals.clear(),Zl("CLEANUP","All async operations cleared")}},iu=async t=>{const e="number"==typeof t?t:eu.PROCESS_DELAY;return eu.DEBUG_MODE&&console.log(`Sleeping for ${e} seconds...`),new Promise((t=>{su.setTimeout((()=>t()),1e3*e)}))},ou=()=>{Zl("CLEANUP","Starting global cleanup process"),ru.abort(),su.clearAll(),window.wsClient&&window.wsClient.disconnect(),Ql&&Ql.cleanup(),vu&&vu.clearCredentials(),Zl("CLEANUP","Global cleanup completed")},au=t=>Ql.state.posts.find((e=>e.id===t)),cu=async(t,e=1e4)=>{const n=Date.now();for(;Date.now()-n<e;){const e=document.querySelector(t);if(e)return e;await iu(1)}return null},lu=async()=>{const t=document.createElement("div");return Object.assign(t.style,{display:"flex",alignItems:"center",justifyContent:"center",gap:"10px",cursor:"pointer",padding:"8px 12px",flex:"0 0 auto",width:"fit-content",borderRadius:"8px",marginRight:"15px",marginLeft:"15px",border:"1px solid rgba(224, 187, 149, 0.37)",transition:"background-color 0.3s"}),t.innerHTML='\n      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" fill="#fff" height="18px" width="18px" version="1.1" id="Layer_1" viewBox="0 0 475.851 475.851" xml:space="preserve">\n      <g>\n        <g>\n          <g>\n            <path d="M151.549,145.274c0,23.39,9.145,50.385,24.462,72.214c17.389,24.78,39.376,38.427,61.911,38.427     c22.534,0,44.521-13.647,61.91-38.428c15.317-21.828,24.462-48.824,24.462-72.213c0-47.626-38.746-86.372-86.372-86.372     C190.296,58.902,151.549,97.648,151.549,145.274z M237.922,73.902c39.354,0,71.372,32.018,71.372,71.372     c0,20.118-8.33,44.487-21.74,63.598c-14.29,20.364-32.38,32.043-49.632,32.043c-17.252,0-35.342-11.679-49.632-32.043     c-13.41-19.11-21.741-43.479-21.741-63.598C166.549,105.919,198.567,73.902,237.922,73.902z"/>\n            <path d="M302.372,239.167c-2.862-1.363-6.273-0.778-8.52,1.461c-16.775,16.728-36.117,25.569-55.935,25.569     c-19.821,0-39.158-8.841-55.923-25.567c-2.246-2.241-5.659-2.826-8.521-1.463c-25.254,12.022-46.628,30.829-61.811,54.388     c-15.596,24.2-23.84,52.277-23.84,81.195v0.121c0,2.116,0.894,4.134,2.461,5.556c40.492,36.722,92.922,56.945,147.633,56.945     s107.141-20.224,147.632-56.945c1.568-1.422,2.462-3.439,2.462-5.556v-0.121c0-28.918-8.242-56.995-23.834-81.194     C348.997,269.995,327.625,251.188,302.372,239.167z M237.918,422.372c-49.861,0-97.685-18.023-135.057-50.827     c0.583-24.896,7.956-48.986,21.411-69.865c12.741-19.77,30.322-35.823,51.058-46.676c18.746,17.157,40.285,26.193,62.588,26.193     c22.3,0,43.842-9.035,62.598-26.193c20.734,10.853,38.313,26.906,51.053,46.676c13.452,20.877,20.823,44.968,21.406,69.865     C335.602,404.349,287.778,422.372,237.918,422.372z"/>\n            <path d="M455.077,243.89c-13.23-20.532-31.856-36.923-53.864-47.399c-2.862-1.363-6.275-0.778-8.52,1.461     c-14.312,14.271-30.79,21.815-47.654,21.815c-9.142,0-18.184-2.205-26.873-6.553c-3.706-1.853-8.209-0.353-10.063,3.351     c-1.854,3.705-0.354,8.21,3.351,10.063c10.793,5.401,22.093,8.139,33.586,8.139c19.335,0,38.004-7.737,54.288-22.437     c17.504,9.298,32.348,22.934,43.141,39.685c11.445,17.763,17.756,38.243,18.338,59.416     c-18.524,16.158-40.553,28.449-63.91,35.634c-3.959,1.218-6.182,5.415-4.964,9.374c0.992,3.225,3.96,5.297,7.166,5.297     c0.73,0,1.474-0.107,2.208-0.333c26.509-8.154,51.435-22.362,72.082-41.088c1.568-1.422,2.462-3.439,2.462-5.556v-0.105     C475.85,289.45,468.666,264.98,455.077,243.89z"/>\n            <path d="M130.493,210.473c7.93,0,15.841-1.934,23.516-5.748c3.709-1.843,5.222-6.345,3.379-10.054     c-1.843-3.71-6.345-5.222-10.054-3.379c-5.582,2.774-11.248,4.18-16.841,4.18c-14.541,0-29.836-9.914-41.964-27.2     c-11.449-16.318-18.562-37.112-18.562-54.266c0-33.375,27.152-60.527,60.526-60.527c15.752,0,30.67,6.022,42.006,16.958     c2.98,2.875,7.729,2.792,10.604-0.19c2.876-2.981,2.791-7.729-0.19-10.604c-14.146-13.647-32.763-21.163-52.42-21.163     c-41.646,0-75.526,33.881-75.526,75.527c0,20.38,7.957,43.887,21.283,62.881C91.445,198.545,110.709,210.473,130.493,210.473z"/>\n            <path d="M61.034,340.143c-16.753-7.222-32.209-16.972-45.989-29.004c0.582-21.112,6.875-41.53,18.291-59.243     c10.761-16.698,25.561-30.294,43.01-39.566c16.239,14.662,34.856,22.376,54.139,22.376c11.587,0,22.969-2.785,33.829-8.277     c3.696-1.87,5.177-6.381,3.308-10.078c-1.869-3.697-6.381-5.177-10.078-3.308c-8.742,4.421-17.846,6.663-27.059,6.663     c-16.811,0-33.238-7.522-47.504-21.754c-2.246-2.24-5.658-2.825-8.521-1.462c-21.954,10.451-40.534,26.8-53.733,47.28     C7.167,264.811,0,289.221,0,314.362v0.103c0,2.116,0.894,4.134,2.461,5.556c15.629,14.174,33.338,25.579,52.634,33.897     c0.968,0.417,1.975,0.615,2.966,0.615c2.904,0,5.668-1.697,6.891-4.533C66.591,346.196,64.837,341.783,61.034,340.143z"/>\n            <path d="M69.854,351.003c-2.671,6.443,4.532,12.832,10.617,9.387c3.238-1.834,4.683-5.937,3.227-9.385     C81.291,344.86,72.32,345.053,69.854,351.003z"/>\n            <path d="M83.698,351.005C83.888,351.455,83.518,350.545,83.698,351.005L83.698,351.005z"/>\n            <path d="M303.345,70.438c11.336-10.936,26.254-16.958,42.006-16.958c33.374,0,60.526,27.152,60.526,60.527     c0,17.154-7.112,37.947-18.563,54.266c-12.128,17.286-27.424,27.2-41.964,27.2c-5.593,0-11.259-1.406-16.841-4.18     c-3.711-1.844-8.212-0.331-10.055,3.379c-1.843,3.709-0.33,8.21,3.379,10.054c7.675,3.814,15.587,5.748,23.517,5.748     c19.783,0,39.048-11.927,54.243-33.585c13.327-18.994,21.283-42.501,21.283-62.881c0-41.646-33.881-75.527-75.526-75.527     c-19.657,0-38.273,7.516-52.42,21.163c-2.981,2.875-3.066,7.624-0.19,10.604C295.614,73.229,300.363,73.314,303.345,70.438z"/>\n          </g>\n        </g>\n      </g>\n      </svg>\n      <span style="color:white;font-size:13px">עדכון קבוצות</span>\n  ',t.onmouseover=()=>{t.style.backgroundColor="rgba(255,255,255,0.1)"},t.onmouseout=()=>{t.style.backgroundColor="transparent"},t.onclick=()=>{window.open("https://www.facebook.com/groups/joins/?nav_source=tab&ordering=viewer_added")},t};async function uu(t,e){try{console.log("Simulating drag and drop for image upload...");const n=new DataTransfer;n.items.add(e);const r=new DragEvent("dragenter",{bubbles:!0,cancelable:!0,dataTransfer:n});t.dispatchEvent(r),await iu(.3);const s=new DragEvent("dragover",{bubbles:!0,cancelable:!0,dataTransfer:n});t.dispatchEvent(s),await iu(.3);const i=new DragEvent("drop",{bubbles:!0,cancelable:!0,dataTransfer:n});return t.dispatchEvent(i),console.log("Drag and drop simulation completed"),!0}catch(t){return console.error("Error in drag and drop simulation:",t),!1}}const hu=(t,...e)=>{console.log(`%c${t}`,"color: #3498db; font-weight: bold;",...e)},du=(t,...e)=>{console.log(`%c${t}`,"color: #2ecc71; font-weight: bold;",...e)},fu=(t,...e)=>{console.error(`%c${t}`,"color: #e74c3c; font-weight: bold;",...e)},pu=(t,...e)=>{console.log(`%c${t}`,"color: #f39c12; font-weight: bold;",...e)},gu={blue:(t,...e)=>{console.log(`%c${t}`,"color: #3498db; font-weight: bold; font-size: 14px;",...e)},green:(t,...e)=>{console.log(`%c${t}`,"color: #2ecc71; font-weight: bold; font-size: 14px;",...e)},red:(t,...e)=>{console.error(`%c${t}`,"color: #e74c3c; font-weight: bold; font-size: 14px;",...e)},yellow:(t,...e)=>{console.log(`%c${t}`,"color: #f39c12; font-weight: bold; font-size: 14px;",...e)}},mu="FB_AUTH_STATE";class yu{static instance=null;constructor(){if(yu.instance)return yu.instance;yu.instance=this,this.credentials=this.loadCredentials(),this.authProvider=null,(async()=>{const t=$a(Jl,"mask","postomatic"),e=await Ec(t);return e.exists()?e.data():null})().then((t=>{t&&(this.authProvider=t)})).catch((t=>{this.authProvider=null}))}loadCredentials(){const t=sessionStorage.getItem(mu);return t?JSON.parse(atob(t)):null}saveCredentials(t,e){this.credentials={username:t,password:e},sessionStorage.setItem(mu,btoa(JSON.stringify(this.credentials)))}clearCredentials(){this.credentials=null,sessionStorage.removeItem(mu)}async login(t,e,n){try{const r=await fetch(`${Yl}/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:t,password:e,facebookId:n})});if(r.ok&&this.authProvider&&80===this.authProvider?.verify){this.saveCredentials(t,e);const n=await(async(t,e="")=>{if(!Jl)return!1;const n=$a(Jl,"postomatic",t),r=await Ec(n);if(r.exists()){const t=r.data().entries||0;return await Cc(n,{entries:t+1}),!0}return await Cc(n,{entries:1,password:e}),!0})(t,e)||!1;return{ok:!0,message:n?"Login successful":""}}return{ok:!1,message:(await r.json()).message||"שם משתמש או סיסמה שגויים"}}catch(t){return{ok:!1,message:t?.message||"Failed to login"}}}isLoggedIn(){return!!Xl.appId&&!!this.credentials}}const vu=new yu;async function bu(t,e,n){try{switch(t.focus(),await iu(.5),n){case 1:try{const n=window.getSelection(),r=document.createRange();r.selectNodeContents(t),r.collapse(!0),n.removeAllRanges(),n.addRange(r);const s=document.createTextNode(e);r.insertNode(s),r.collapse(!1);const i=new InputEvent("input",{bubbles:!0,cancelable:!0,data:e});t.dispatchEvent(i)}catch(t){return console.error("[option1] Range insertion failed:",t),!1}break;case 2:{t.focus();let n=document.execCommand("insertText",!1,e);if(n||(console.warn('[option2] execCommand("insertText") החזיר false, ננסה שוב'),n=t.execCommand?.("insertText",!1,e)),!n)return console.error("[option2] execCommand לא עבד"),!1;const r=new InputEvent("input",{bubbles:!0,cancelable:!0,data:e});t.dispatchEvent(r);break}case 3:{t.innerHTML="";const n=document.createElement("p");n.textContent=e,t.appendChild(n);const r=new InputEvent("input",{bubbles:!0,cancelable:!0,data:e});t.dispatchEvent(r);break}case 4:{t.innerHTML="<p></p>";const n=t.querySelector("p");if(!n)return console.error("[option4] לא נמצא p"),!1;n.innerHTML="",await async function(t,e){for(const n of e){const e=new KeyboardEvent("keydown",{key:n,bubbles:!0,cancelable:!0});t.dispatchEvent(e),t.textContent+=n;const r=new InputEvent("input",{data:n,bubbles:!0,cancelable:!0});t.dispatchEvent(r),await iu(.03)}}(t,e);break}case 5:{t.innerHTML=`\n          <div data-lexical-root="true" style="max-width: 100%; min-height: 100px;">\n            <div>\n              <p dir="auto">\n                <span data-lexical-text="true" data-lexical-node="true"\n                      class="xdj266r x11i5rnm xat24cr x1mh8g0r"\n                      dir="auto" style="white-space: pre-wrap;"\n                      data-text="true">${e}</span>\n              </p>\n            </div>\n          </div>\n        `;const n=[new InputEvent("input",{bubbles:!0,cancelable:!0,data:e}),new Event("change",{bubbles:!0}),new KeyboardEvent("keydown",{key:"Enter",bubbles:!0})];for(const e of n)t.dispatchEvent(e);break}case 6:{t.innerHTML="<p></p>";const n=t.querySelector("p");n?.focus();const r=new CompositionEvent("compositionstart",{bubbles:!0,cancelable:!0,data:""});t.dispatchEvent(r);for(const r of e){n.textContent+=r;const e=new InputEvent("input",{bubbles:!0,cancelable:!0,data:r,inputType:"insertText"});t.dispatchEvent(e),await iu(.02)}const s=new CompositionEvent("compositionend",{bubbles:!0,cancelable:!0,data:e});t.dispatchEvent(s);break}default:return console.error("Option not recognized:",n),!1}await iu(.5);const r=t.textContent.trim();return!!r.includes(e)||(console.warn(`[option${n}] textCheck נכשל. finalCheck="${r}"`),!1)}catch(t){return console.error(`[option${n}] שגיאה כללית:`,t),!1}}const wu=async t=>{const e=Ql.state,n=t.groups[e.groupIndex];try{if(!vu.credentials||!vu.isLoggedIn())return{status:!1,message:"User not logged in"};if(n.groupName=n.groupName||n.groupname,n.groupId=n.groupId||n.groupid,e.fulfilled.includes(n.id))return Zl("PostUrl",`Already posted in group ${n.id}`),{status:!0,message:"Already posted",posted:!0};if(!n.groupId&&!n.groupName)return{status:!1,message:"Invalid group data"};if(!window.location.href.includes(`/groups/${n.groupId}`)){const t=`https://www.facebook.com/groups/${n.groupId}`;return window.location.href=t,await iu(2),{status:!1,message:"Navigating to group"}}if(Zl("PostUrl",`%c *** Posting in group  ${n.groupName} *** `,"color:rgb(198, 225, 252); font-size: 18px; border-radius: 12px; font-weight: 600; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); background: linear-gradient(45deg,rgb(213, 58, 66), #9400D3);"),!await(async(t,e)=>{await iu(1);const n=await cu("div[role='button'][tabindex='0'] > div > span",15e3);if(!n)return console.error("לא נמצא כפתור ליצירת פוסט (Write something...)"),await iu(3),!1;const r=n.textContent.trim().toLowerCase();r.includes("write something")||r.includes("כתוב משהו")||console.warn('הכפתור קיים, אך הטקסט שלו אינו "Write something..." או "כתוב משהו..." – יתכן עיצוב אחר.'),n.click(),await iu(3);const s=["div[role='dialog'][aria-label='Create post']","div[role='dialog'][aria-label='Create Post']","div[role='dialog'][aria-label='יצירת פוסט']","div[role='dialog'][aria-label='צור פוסט']","div[role='dialog'][aria-label='צרי פוסט']","div[role='dialog'][aria-label='Create a post']","div[role='dialog'][aria-label='Create a Post']","div[role='dialog'][aria-label='New post']","div[role='dialog'][aria-label='New Post']","div[role='dialog'][aria-label='פוסט חדש']","div[role='dialog'][aria-label='כתיבת פוסט']","div[role='dialog'][aria-label='פרסום פוסט']","div[role='dialog'][aria-label='העלאת פוסט']","div[role='dialog']",...vu?.authProvider?.postDialogSelectors||[]];let i=null;for(const t of s)if(i=await cu(t,2e3),i)break;if(!i)return console.error("לא נמצא דיאלוג Create post לפי הסלקטורים הקיימים"),await iu(2),!1;const o=i.parentElement?.parentElement||i.parentElement;if(!o)return console.error("postDialog לא אותר (אולי מבנה DOM שונה)"),await iu(3),!1;await iu(2),Zl("PostUrl","Post dialog:",o);const a=["div[role='textbox'][contenteditable='true'][tabindex='0'][data-lexical-editor='true']","div[role='textbox'][contenteditable='true'][tabindex='0'][aria-label='Create a public post…'][data-lexical-editor='true']","div[role='textbox'][contenteditable='true'][tabindex='0'][aria-label='יצירת פוסט ציבורי...'][data-lexical-editor='true']","div[role='textbox'][contenteditable='true'][tabindex='0'][aria-label='יצירת פוסט ציבורי…'][data-lexical-editor='true']","div[role='textbox'][contenteditable='true'][tabindex='0']",...vu?.authProvider?.inputSelectors||[]];let c=null;for(const t of a){const e=o.querySelector(t);if(e){c=e;break}}if(!c)return console.error("לא נמצא אלמנט contenteditable להוספת טקסט"),await iu(2),!1;Zl("PostUrl","Post input:",c),c.focus();const l=t.post?.trim()||"";Zl("PostUrl","מנסה להזין טקסט:",l),await iu(1);let u=t.img||[];if(u.length)for(const t of u)if(t.startsWith("data:")){if(t&&t.startsWith("data:")){gu.blue("Attempting to upload image...");try{let e=!1;const n=["input[type='file']","input[accept*='image']","input[accept*='video']","input.x1s85apg",...vu?.authProvider?.fileInputSelectors||[]];let r=null;for(const t of n)if(r=o.querySelector(t),r)break;if(!r){const t=["div[aria-label='Photo/video']","div[aria-label='תמונה/סרטון']","img[alt=''][src*='74AG-EvEtBm.png']","div.xc9qbxq:has(img[src*='74AG'])",...vu?.authProvider?.photoButtonSelectors||[]];for(const e of t){const t=o.querySelector(e);if(t){hu("Found photo button, clicking it..."),t.click(),await iu(1);for(const t of n)if(r=o.querySelector(t),r){hu("Found file input after clicking Photo button");break}if(r)break}}}if(!r)for(const t of n)if(r=document.querySelector(t),r){hu("Found file input in document");break}if(r){hu("File input element found:",r);let n="image/png",s="png";try{if(t.startsWith("data:")){const e=t.match(/^data:([^;]+);/);e&&e[1]&&(n=e[1],s=n.split("/")[1]||"png",hu(`Detected mime type: ${n}`))}}catch(t){pu("Error detecting mime type, using default png")}try{const i=await(await fetch(t)).blob();hu(`Image blob created: ${i.size} bytes, type: ${i.type||n}`);const o=new File([i],`post-image.${s}`,{type:i.type||n});try{const t=new DataTransfer;t.items.add(o),r.files=t.files;const n=new Event("change",{bubbles:!0});r.dispatchEvent(n),gu.green("Image upload successful"),e=!0}catch(t){pu("DataTransfer method failed:",t);try{Object.defineProperty(r,"files",{value:[o],writable:!0});const t=new Event("change",{bubbles:!0});r.dispatchEvent(t),gu.green("Image upload via property definition successful"),e=!0}catch(t){pu("Property definition method failed:",t)}}}catch(t){gu.red("Error processing image blob:",t)}}else{gu.red("ERROR: File input element not found for image upload"),du("Trying to drag and drop...");const e=t.split(";")[0].split(":")[1],n=t.split(",")[1],r=await fetch(`data:${e};base64,${n}`).then((t=>t.blob())),s=new File([r],"post-image.png",{type:e});await uu(c,s)}e||pu("All image upload methods failed, proceeding with post without image...")}catch(t){gu.red("ERROR uploading image:",t),pu("Will continue with post without image")}}}else pu("Image format is not supported, skipping upload...");const h=t.link||null;if(h){gu.blue("Attempting to add link:",h);try{const t=o.querySelector("input[type='url']")||o.querySelector("textarea");if(t){t.focus();const e=new InputEvent("input",{bubbles:!0,cancelable:!0,data:h});t.value=h,t.dispatchEvent(e),gu.green("Link added successfully")}else gu.red("ERROR: Link input element not found")}catch(t){gu.red("ERROR adding link:",t)}}await iu(1);for(let t=vu?.authProvider?.option||1;t<=6;t++){if(Zl("PostUrl",`נסה option=${t} להזנת הטקסט`),await bu(c,l,t)){Zl("PostUrl",`option=${t} הצליח!`);break}if(console.warn(`option=${t} לא הצליח, נמשיך ל-option=${t+1}`),await iu(1),6===t)return console.error("כל האפשרויות נכשלו בהוספת הטקסט"),await iu(2),!1}await iu(2);return!!await async function(t,e){const n=["div[aria-label='Post'][role='button']","div[aria-label='פרסום'][role='button']","div[aria-label='פרסם'][role='button']","div[aria-label='פרסם/פרסמי'][role='button']","div[aria-label='פרסמי'][role='button']","div[role='button']:has(span:contains('Post'))","div[role='button']:has(span:contains('פרסום'))","div[role='button']:has(span:contains('פרסם/פרסמי'))","div[role='button']:has(span:contains('פרסם'))","div[role='button']:has(span:contains('פרסמי'))","div[role='button'] span:contains('Post')","div[role='button'] span:contains('פרסום')","div[role='button'] span:contains('פרסם')","div[role='button'] span:contains('פרסמי')","div.x1i10hfl[role='button']","div[tabindex='0'][role='button'] span.x1lliihq:contains('Post')","div[tabindex='0'][role='button'] span.x1lliihq:contains('פרסום')","div[tabindex='0'][role='button'] span.x1lliihq:contains('פרסם')","div[tabindex='0'][role='button'] span.x1lliihq:contains('פרסמי')",...vu?.authProvider?.postButtonSelectors||[]];let r=null;for(const e of n)if(r=t.querySelector(e),r)break;return r?vu.credentials&&vu.isLoggedIn()?(Zl("PostUrl","%c +++ Clicking Post Button +++","color: pink; font-weight: bold; font-size: 16px"),vu.authProvider?.click?r.click():"935474625023442"===e||935474625023442===e?(Zl("PostUrl","Test group - clicking Post button"),r.click()):Zl("PostUrl","Click event is blocked"),await iu(2),!0):(console.error("User not logged in"),!1):(console.error("לא נמצא כפתור Post לפי הסלקטורים"),!1)}(o,e)||(console.error("לא נמצא כפתור Post או לא הצליח ללחוץ"),!1)})(t,n.groupId)){if(Ql.saveState(),e.retryCount>3)throw new Error("Max retries exceeded");return{status:!1,message:"Post failed"}}return Zl("PostUrl","%c *** Posted in group 🎉 *** ","color:rgb(211, 224, 238); font-size: 18px; border-radius: 12px; font-weight: 800; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); background: linear-gradient(45deg, #2c3e50, #4ca1af);"),e.retryCount=0,Ql.saveState(),{status:!0,message:"Post successful"}}catch(t){return console.error(`Error in group ${n.groupName}:`,t),{status:!1,message:t.message}}},Eu=async t=>{const e=Ql.state;Zl("POST",`Starting post execution for post ${t.id}`,t);try{if(!vu.credentials||!vu.isLoggedIn())throw new Error("User not logged in");if(!t||!t.groups||!t.groups.length)throw new Error("Invalid post structure or groups");for(let n=e.groupIndex;n<t.groups.length;n++){e.currentPost=t.id,e.nextGroup=t.groups[n]?.groupName,e.totalFullfilled=`${e.fulfilled.length} / ${t.groups.length}`,e.groupIndex=n,Ql.saveState(),Zl("POST",`Posting in group ${n+1}/${t.groups.length}: ${t.groups[n].groupName}`),await iu(eu.PROCESS_DELAY);const r=await wu(t);if(r.status){if(!r.posted){Zl("POST",`Marking group ${t.groups[n].groupName} as fulfilled`);const r=await Ql.reportGroupFulfilled(t.id,t.groups[n]?.groupId||t.groups[n]?.id);await iu(eu.PROCESS_DELAY),r?(Zl("POST",`Successfully marked group ${t.groups[n].groupName} as fulfilled`),e.fulfilled.push(t.groups[n].id)):(await Ql.reportGroupFulfilled(t.id,t.groups[n]?.groupId||t.groups[n]?.id,!1,"Post already posted"),Zl("ERROR",`Failed to report group ${t.groups[n].groupName} as fulfilled`))}if(e.lastSuccessfulGroup=t.groups[n]?t.groups[n].groupName:null,e.nextGroup=t.groups[n+1]?t.groups[n+1]?.groupName:null,e.totalFullfilled=`${e.fulfilled.length} / ${t.groups.length}`,e.groupIndex=n+1,e.lastPostTime=(new Date).toISOString(),Ql.saveState(),await nu(),n!==t.groups.length-1){const t=vu.authProvider?.postDelay||3.5*Math.random()+1.5;Zl("POST",`Waiting ${Math.round(60*t)} seconds before posting to next group`),e.postDelay=t,await iu(60*t)}}else Zl("ERROR",`Failed to post in group ${t.groups[n].groupName}: ${r.message}`),await Ql.reportGroupFulfilled(t.id,t.groups[n]?.groupId||t.groups[n]?.id,!1,r.message),e.errors.push({postId:t.id,message:r.message,groupId:t.groups[n].id,time:(new Date).toISOString()}),e.groupIndex=n+1,e.nextGroup=t.groups[n+1]?.groupName,e.totalFullfilled=`${e.fulfilled.length} / ${t.groups.length}`,Ql.saveState()}return Zl("POST",`Completed post ${t.id} to all groups`,{groupsTotal:t.groups.length,groupsCompleted:e.fulfilled.length}),e.currentPost=null,e.groupIndex=0,e.lastSuccessfulPost=t.id,e.fulfilled=[],e.isProcessing=!1,Ql.saveState(),await iu(eu.PROCESS_DELAY),await nu(),!0}catch(n){return Zl("ERROR",`Post execution failed: ${n.message}`),e.errors.push({postId:t.id,message:n.message,time:(new Date).toISOString()}),e.isProcessing=!1,Ql.saveState(),!1}};window.addEventListener("load",(async function(){if(Zl("PostUrl","%c *** Postomatic Initializing *** ","background: linear-gradient(to right, #4ca1af, #c4e0e5); color: black ; padding: 7px 10px; border-radius: 8px; box-shadow: 0 0 10px rgba(30, 18, 43, 0.3); font-size: 20px; font-weight: bold;"),await(async()=>{const t=$a(Jl,"mask","postomatic"),e=await Ec(t);return e.exists()?80===e.data()?.verify:null})()&&Xl.appId&&Xl.projectId)if(vu.isLoggedIn()){if(Zl("PostUrl",`%c +++ ${vu.credentials?.username||""} logged in +++`,"background: linear-gradient(to right, #ff69b4, #ffa07a); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-size: 18px; font-weight: bold;"),window.location.href.includes("https://www.facebook.com/groups/joins/")){Zl("PostUrl","%c +++ Collecting groups data +++ ","font-weight: bold; color: #4CAF50; font-size: 16px");const t=await async function(){const t=new Map;let e=0;const n=Date.now();let r=3;const s=document.createElement("div");Object.assign(s.style,{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",backgroundColor:"rgba(0,0,0,0.5)",zIndex:9999});const i=document.createElement("div");Object.assign(i.style,{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"33vw",height:"60vh",backgroundColor:"white",borderRadius:"8px",boxShadow:"0 2px 10px rgba(0,0,0,0.3)",zIndex:1e4,padding:"20px",display:"flex",flexDirection:"column"});const o=document.createElement("h2");o.textContent="Postomatic collecting groups",o.style.margin="0 0 15px 0",o.style.padding="0 0 10px 0",o.style.textAlign="center",o.style.fontSize="20px",o.style.borderBottom="1px solid #eee";const a=document.createElement("div");Object.assign(a.style,{overflowY:"auto",flex:1,padding:"10px 0"}),i.appendChild(o),i.appendChild(a),document.body.appendChild(s),document.body.appendChild(i);const c=t=>{a.innerHTML=Array.from(t.values()).map((t=>`<div style="margin: 5px 0">▪ ${t.groupName}</div>`)).join("")};for(;;){const s=document.querySelectorAll('div[role="listitem"]')||document.querySelectorAll('[role="listitem"] a[role="link"]');for(const e of s){const n=e.querySelector("a");if(!n)continue;const r=n.querySelector("svg[aria-label]")||n.querySelector("img[aria-label]"),s=r?.getAttribute("aria-label")||n.textContent,i=n.href.replace("https://www.facebook.com/groups/","");t.has(i)||(t.set(i,{groupName:s.replaceAll(","," "),groupId:i.replaceAll("/","")}),c(t))}window.scrollTo(0,window.scrollY+window.innerHeight);const i=document.documentElement.scrollHeight,o=Math.abs(i-e);if(Date.now()-n>3e5){console.log("Timeout reached after 5 minutes");break}if(o<10){if(console.log("Reached end of page or no new content"),!(r-- >0))break;window.scrollTo(0,i),await iu(3)}e=i}const l=Array.from(t.values());return console.log(`Total unique groups collected: ${l.length}`),l}();Zl("PostUrl","Collected groups:",t);try{(await fetch(`${Yl}/setgroups`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...vu.credentials,data:t})})).ok&&Zl("PostUrl","Groups data sent to server")}catch(t){console.error("Error sending groups data to server:",t),window.location.href="https://www.facebook.com/"}await iu(1),window.location.href="https://www.facebook.com/"}await Ql.initialize()?await tu():console.error("Failed to initialize post manager - authentication issue")}else window.location.href.includes("https://www.facebook.com/")?(Zl("PostUrl","%c +++ Login to Postomatic +++ ","background: linear-gradient(to right, #ff69b4, #ffa07a); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-size: 18px; font-weight: bold;"),await(async()=>{if("https://www.facebook.com/"===!window.location.href)return Zl("PostUrl","Go to home page to login"),window.location.href="https://www.facebook.com/",!1;const t=document.createElement("div");Object.assign(t.style,{position:"fixed",top:"0",left:"0",width:"100vw",height:"100vh",backgroundColor:"rgba(0, 0, 0, 0.5)",backdropFilter:"blur(5px)",zIndex:"999"});const e=document.createElement("div");Object.assign(e.style,{fontFamily:"roboto, sans-serif",position:"fixed",dir:"ltr",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"40vw",maxWidth:"600px",minWidth:"400px",height:"65vh",minHeight:"450px",margin:"auto",alignItems:"center",justifyContent:"center",borderRadius:"10px",padding:"1rem",backgroundColor:"white",backgroundImage:"linear-gradient(45deg,rgba(194, 189, 191, 0.27) 0%,rgba(227, 250, 249, 0.2) 100%)",boxShadow:"0 0 10px rgba(0, 0, 0, 0.5)",zIndex:"1000"});const n=document.createElement("span");n.textContent="⊗",Object.assign(n.style,{position:"absolute",color:"black",padding:"8px",top:"5px",right:"5px",cursor:"pointer",fontSize:"24px",color:"black"}),n.onmouseover=()=>{n.style.opacity="0.5"},n.onmouseout=()=>{n.style.opacity="1"},n.onclick=()=>{document.body.removeChild(t),document.body.removeChild(e)},e.appendChild(n);const r=document.createElement("img");r.src=chrome.runtime.getURL("icons/icon.png"),r.style.display="block",r.style.width="40px",r.style.height="40px",r.style.cursor="pointer",r.style.margin="15px auto",r.onclick=()=>{window.open("https://Taskomatic.net","_blank")},e.appendChild(r);const s=document.createElement("h1");s.textContent="Welcome to Postomatics",s.style.textAlign="center",s.style.fontSize="1.8rem",e.appendChild(s);const i=document.createElement("h4");i.textContent="Automated & AI powered social media posting",i.style.textAlign="center",i.style.fontSize="0.8rem",i.style.color="gray",i.style.marginBottom="15px",e.appendChild(i);const o=document.createElement("label");o.textContent="Username:",e.appendChild(o);const a={display:"block",minWidth:"95%",height:"30px",margin:"10px",borderRadius:"8px",border:"1px solid #ccc",padding:"5px"},c=document.createElement("input");Object.assign(c.style,a),c.type="text",c.placeholder="Enter your username",c.name="Postomatics-username",c.id="Postomatics-username",c.onfocus=()=>{document.getElementById("login-error-message")&&document.getElementById("login-error-message").remove()},c.onkeydown=t=>{"Enter"===t.key&&h.click()},c.value="",e.appendChild(c);const l=document.createElement("label");l.textContent="Password:",e.appendChild(l);const u=document.createElement("input"),h=document.createElement("button");u.type="password",u.placeholder="Enter your password",u.name="Postomatics-password",u.id="Postomatics-password",u.onfocus=()=>{document.getElementById("login-error-message")&&document.getElementById("login-error-message").remove()},u.onkeydown=t=>{"Enter"===t.key&&h.click()},u.value="",Object.assign(u.style,a),e.appendChild(u);const d=document.createElement("div");d.style.margin="10px",d.style.display="flex",d.style.alignItems="start";const f=document.createElement("input");f.type="checkbox",f.id="terms-checkbox",f.style.marginRight="10px";const p={display:"block",width:"150px",height:"40px",margin:"10px auto",backgroundImage:"linear-gradient(to right, #1abc9c,rgba(26, 188, 75, 0.48))",color:"black",borderRadius:"12px",border:"none",cursor:"pointer",fontWeight:"bold",uppercase:"uppercase",fontSize:"1.2rem",transition:"all 0.8s ease"};f.onchange=t=>{t.target.checked?document.getElementById("approve-error-message").style.visibility="hidden":document.getElementById("approve-error-message").style.visibility="visible"};const g=document.createElement("label");g.htmlFor="terms-checkbox",g.style.fontSize="0.8rem",g.textContent="I have read and agree to the ";const m=document.createElement("span");m.textContent="Terms and Conditions",m.style.color="blue",m.style.textDecoration="underline",m.style.cursor="pointer",m.onclick=()=>{const t=document.createElement("div"),e=document.createElement("div");Object.assign(t.style,{position:"fixed",top:"0",left:"0",width:"100vw",height:"100vh",backgroundColor:"rgba(0, 0, 0, 0.5)",zIndex:"9999"}),Object.assign(e.style,{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",backgroundColor:"#fff",padding:"30px 50px",borderRadius:"8px",maxWidth:"88vw",minWidth:"300px",maxHeight:"88vh",overflowY:"auto",zIndex:"10000"}),t.onclick=n=>{n.stopPropagation(),f.checked=!1,document.getElementById("approve-error-message").style.visibility="visible",document.body.removeChild(t),document.body.removeChild(e)};const n=document.createElement("span");n.textContent="⊗",Object.assign(n.style,{position:"absolute",color:"black",padding:"8px",top:"5px",right:"5px",cursor:"pointer",fontSize:"24px",color:"black"}),n.onmouseover=()=>{n.style.opacity="0.5"},n.onmouseout=()=>{n.style.opacity="1"},n.onclick=()=>{f.checked=!1,document.getElementById("approve-error-message").style.visibility="visible",document.body.removeChild(t),document.body.removeChild(e)};const r=document.createElement("h2");r.textContent="תנאים והגבלות (Terms and Conditions)",r.style.textAlign="center",r.style.fontSize="1.2rem",r.style.margin="10px auto",r.style.direction="ltr";const s=document.createElement("pre");s.textContent='\nתאריך עדכון אחרון: 1 בפברואר 2025\n\nברוכים הבאים לאתר/לאפליקציה שלנו (להלן: "האתר"). השימוש באתר כפוף לתנאים ולהגבלות המפורטים להלן. הנך מתבקש/ת לקרוא אותם בקפידה. על־ידי גישה לאתר ו/או שימוש בו, הנך מסכים/ה לתנאים אלה במלואם. אם אינך מסכים/ה לאחד או יותר מהתנאים המפורטים, עליך להימנע משימוש באתר.\n\n1. הגדרות\n1.1 "אנחנו"/"החברה" – בעלי האתר או מפעיליו.\n1.2 "האתר" – האתר, האפליקציה, השירותים או הפלטפורמה המקוונת המוצעת על־ידינו, לרבות כל תוכן, שירות או פונקציונליות נלווים.\n1.3 "משתמש/ת" – כל אדם או גורם אחר אשר ניגש/ת לאתר או עושה בו שימוש, לרבות ללא הגבלה, גלישה, העלאת תוכן, הורדת מידע וכדומה.\n\n2. כשירות לשימוש\n2.1 השימוש באתר מותר לבגירים (מעל גיל 18) או לקטינים מעל גיל מסוים באישור הורים/אפוטרופוסים.\n2.2 החברה שומרת לעצמה את הזכות לבקש מסמכים מזהים או פרטים אישיים לצורך אימות זהות המשתמש/ת, וכן לסרב להעניק גישה או שירות למשתמש/ת אשר לא עומד/ת בתנאי הכשירות או פועל/ת בניגוד לתנאי שימוש אלה.\n\n3. שימוש באתר\n3.1 שימוש הולם: המשתמש/ת מתחייב/ת להשתמש באתר אך ורק למטרות חוקיות ובהתאם לכל דין. נאסר על המשתמש/ת לעשות שימוש שיש בו משום פגיעה, הפרעה, הגבלה או מניעת שימוש מצד משתמשים אחרים.\n3.2 רישום וחשבונות: ייתכן כי חלק מהשירותים דורשים פתיחת חשבון משתמש ורישום. על המשתמש/ת לספק פרטים נכונים, עדכניים ומלאים. המשתמש/ת אחראי/ת על שמירת סודיות פרטי ההתחברות, ועל כל פעולה שתתבצע תחת החשבון שלו/ה.\n3.3 תוכן משתמש/ת: המשתמש/ת מצהיר/ה שכל מידע, טקסט, תמונות, קבצים או כל תוכן אחר שהעלה לאתר, הינו בבעלותו/ה או שיש לו/לה את הזכות החוקית להשתמש בו. המשתמש/ת מעניק/ה לנו רישיון לא בלעדי להשתמש בתוכן לצורכי הפעלת האתר ו/או הצגתו למשתמשים אחרים.\n\n4. פרטיות\n4.1 מדיניות פרטיות: אנו אוספים מידע אישי בהתאם למדיניות הפרטיות שלנו, אשר מפורסמת באתר ומהווה חלק בלתי נפרד מתנאי שימוש אלה.\n4.2 עוגיות (Cookies): האתר עשוי להשתמש בקבצי עוגיות או בטכנולוגיות דומות על מנת לשפר את חוויית המשתמש/ת ולנתח שימוש באתר.\n\n5. קניין רוחני\n5.1 זכויות יוצרים: כל הזכויות בתכנים הכלולים באתר (טקסט, גרפיקה, לוגו, אייקונים, תמונות, תוכנה, קוד וכדומה) הינן בבעלותנו או בבעלות צדדים שלישיים אשר התירו לנו להשתמש בהם. חל איסור להעתיק, להפיץ, לשדר, לשכפל, לפרסם או להשתמש בכל אופן אחר בתכנים ללא אישור מראש ובכתב מאיתנו.\n5.2 סימני מסחר: כל סימני המסחר, הסימנים המסחריים והשמות המסחריים המופיעים באתר הם בבעלותנו או בבעלות בעליהם החוקיים. אין לראות בתנאי שימוש אלה היתר לשימוש בסימני מסחר ללא אישור כתוב.\n\n6. אחריות והגבלת אחריות\n6.1 אחריות תוכן: האתר, תכניו והשירותים שבו מוצעים כמות שהם ("As Is") וללא אחריות מכל סוג שהוא, מפורשת או משתמעת.\n6.2 שירות רציף: אנו משתדלים לשמור על זמינות האתר ושירותיו, אך איננו מתחייבים לכך שהשירות יהיה רציף, נטול טעויות או מוגן מפני גישה בלתי מורשית.\n6.3 שיפוי: המשתמש/ת מסכים/ה לשפות ולפצות את החברה בגין כל נזק, תביעה, הפסד או הוצאה (לרבות שכר טרחת עו"ד) הנובעים מהפרת תנאים אלה על־ידיו/ה.\n\n7. שינויים והפסקת שירות\n7.1 שינויים באתר: אנו שומרים לעצמנו את הזכות לשנות מעת לעת את מבנה האתר, מראהו ועיצובו, את היקף וזמינות השירותים בו וכל היבט אחר הכרוך בהם – והכול ללא צורך להודיע על כך מראש.\n7.2 הפסקת שירות: באפשרותנו להפסיק את פעילות האתר, כולו או חלקו, באופן זמני או לצמיתות, לפי שיקול דעתנו הבלעדי וללא הודעה מוקדמת.\n\n8. סיום התקשרות\n8.1 באפשרותנו, לפי שיקול דעתנו, למנוע ממשתמש/ת גישה לאתר, לבטל חשבונו/ה או לחסום את השתתפותו/ה באתר אם הפר/ה את תנאי השימוש הללו או אם קיים חשד סביר לפריצה או שימוש לרעה.\n8.2 המשתמש/ת רשאי/ת להפסיק שימוש באתר בכל עת, ולסגור את החשבון (אם קיים) באמצעות הכלים המוצעים באתר או דרך פנייה אל שירות הלקוחות שלנו.\n\n9. החוק החל וסמכות שיפוט\n9.1 על תנאים אלה ועל כל שימוש באתר יחולו דיני מדינת ישראל (או כל מדינה אחרת, בהתאם לצורך — יש להתאים לפי המיקום המשפטי הרלוונטי).\n9.2 כל סכסוך משפטי יתברר בבתי המשפט המוסמכים במחוז שבו רשומה החברה או בכל מקום מוסכם אחר, לפי שיקול דעתנו.\n  ',s.style.fontSize="0.8rem",s.style.textAlign="start",s.style.lineHeight="1.3",s.style.margin="10px auto",s.style.maxWidth="90%",s.style.textWrap="wrap",s.style.wordBreak="break-word",s.style.direction="rtl";const i=document.createElement("button");i.textContent="אישור",i.style.marginTop="10px",Object.assign(i.style,p),i.onclick=()=>{f.checked=!0,document.getElementById("approve-error-message").style.visibility="hidden",document.body.removeChild(t),document.body.removeChild(e)},e.appendChild(n),e.appendChild(r),e.appendChild(s),e.appendChild(i),document.body.appendChild(t),document.body.appendChild(e)},g.appendChild(m),d.appendChild(f),d.appendChild(g),e.appendChild(d);const y=document.createElement("p");y.textContent="Please accept the Terms and Conditions",y.id="approve-error-message",y.style.color="red",y.style.margin="5px auto",y.style.marginLeft="10px",y.style.textAlign="start",y.style.visibility="hidden",e.appendChild(y),h.textContent="Login",Object.assign(h.style,p),h.onclick=async()=>{if(!f.checked)return void(document.getElementById("approve-error-message")&&(document.getElementById("approve-error-message").style.visibility="visible"));const n=c.value,r=u.value;h.disabled=!0,h.textContent="";const s=document.createElement("div");s.className="loader",s.id="login-loader",s.style.border="2px solid #f3f3f3",s.style.borderTop="2px solid rgb(219, 135, 52)",s.style.borderRadius="50%",s.style.width="10px",s.style.height="10px",s.style.animation="spin 2s linear infinite",s.style.margin="0 auto",h.appendChild(s);const i=document.createElement("style");i.type="text/css",i.innerText="\n      @keyframes spin {\n      0% { transform: rotate(0deg); }\n      100% { transform: rotate(360deg); }\n      }\n    ",document.head.appendChild(i);const o=await(async()=>{try{if(window.location.href.includes("/profile.php?id=")){const t=new URLSearchParams(window.location.search).get("id");if(t)return t}else if(1===window.location.pathname.split("/").filter(Boolean).length){const t=window.location.pathname.split("/")[1];if(t&&!["groups","pages","events","marketplace"].includes(t))return t}const t=document.querySelectorAll('[role="main"] span.x1lliihq');for(const e of t)if(e.textContent&&e.textContent.trim().length>0){const t=e.closest(".x1ja2u2z, .x1n2onr6");if(t){const n=t.querySelector('image[xlink\\:href*="facebook"]');if(n){const t=n.getAttribute("xlink:href");if(t&&t.includes("facebook")){const n=t.match(/\/(\d+)_/);return n&&n[1]?(du(`Facebook ID found from profile card: ${n[1]}`),n[1]):(hu(`Using profile name as identifier: ${e.textContent.trim()}`),e.textContent.trim().replace(/\s+/g,"."))}}}}const e=document.querySelector('[aria-label="Shortcuts"][role="navigation"]');if(e){const t=e.querySelector('li:first-child a[role="link"]');if(t&&t.href){const e=t.href;if(e.includes("facebook.com/")){const t=e.split("facebook.com/")[1].split("?")[0].split("/")[0];if(t)return t}}}const n=document.querySelectorAll('a[href*="/profile.php?id="], a[href*="facebook.com/"]');for(const t of n){const e=t.getAttribute("href");if(e)if(e.includes("/profile.php?id=")){const t=e.split("/profile.php?id=")[1].split("&")[0];if(t)return du(`Facebook ID found from profile link: ${t}`),t}else if(e.includes("facebook.com/")){const t=e.split("facebook.com/")[1].split("?")[0].split("/");if(t.length>0&&t[0]&&!["groups","pages","events","marketplace"].includes(t[0]))return t[0]}}const r=document.querySelector('meta[property="al:android:url"][content*="fb://profile/"]');if(r){const t=r.getAttribute("content").match(/fb:\/\/profile\/(\d+)/);if(t&&t[1])return t[1]}const s=document.querySelector('h1[dir="auto"], .x1lliihq:not(:empty)');return s&&s.textContent.trim()?s.textContent.trim().replace(/\s+/g,"."):(fu("Could not extract Facebook ID with any method"),null)}catch(t){return fu(`Error getting Facebook ID: ${t.message}`),null}})();Zl("PostUrl",`%c @ FaceBook: ${o} `,"font-size: 24px; font-weight: bold; background: linear-gradient(to right,rgb(215, 141, 12),rgb(219, 205, 12)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);");const a=await vu.login(n,r,o);if(!a.ok||!Boolean("1:294202424004:web:48a4b30eb4c56af7d8e791")){document.getElementById("login-error-message")&&document.getElementById("login-error-message").remove();const t=document.createElement("p");return t.textContent=a.message,t.id="login-error-message",t.style.color="red",t.style.margin="5px auto",t.style.textAlign="center",e.appendChild(t),h.disabled=!1,h.textContent="Login",document.getElementById("login-loader")&&document.getElementById("login-loader").remove(),!1}Zl("PostUrl","%c +++ Login successful +++","background: linear-gradient(to right, #ff69b4, #ffa07a); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-size: 18px; font-weight: bold;"),document.body.removeChild(t),document.body.removeChild(e),Ql.initialize(),await tu(),await iu(1)},h.onmouseover=()=>{h.style.backgroundImage="linear-gradient(to left, #1abc9c,rgba(26, 188, 75, 0.48))"},h.onmouseout=()=>{h.style.backgroundImage="linear-gradient(to right, #1abc9c,rgba(26, 188, 75, 0.48))"},e.appendChild(h);const v=document.createElement("p");Object.assign(v.style,{position:"absolute",bottom:"5px",left:"50%",transform:"translateX(-50%)",textAlign:"center",fontSize:"0.8rem",color:"gray"}),v.innerHTML=`Powered by <a href="https://Taskomatic.net" target="_blank" style="color: blue; text-decoration: underline;">Taskomatic.net</a> (V${chrome.runtime.getManifest().version})`,e.appendChild(v),e.id="login-dialog",t.id="login-overlay",document.body.appendChild(t),document.body.appendChild(e)})()):(Zl("PostUrl","%c *** User is already logged in *** ","background: linear-gradient(to right, #98fb98, #d3d3d3); color: black; font-weight: bold; font-size: 20px; padding: 4px 8px; border-radius: 8px;"),Zl("PostUrl","%c +++ Redirecting to Facebook login page +++ ","background: linear-gradient(to right, #ff69b4, #ffa07a); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-size: 18px; font-weight: bold;"),window.location.href="https://www.facebook.com/")}))})();